<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script></script><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3"><link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222"><meta name="keywords" content="Python,Django,在线教育平台,"><link rel="alternate" href="/atom.xml" title="mtianyan's blog" type="application/atom+xml"><meta name="description" content="总之，我们要拿来。我们要或使用，或存放，或毁灭。 - 鲁迅    既然有django提供的强大admin,我们便要拿来用喽。  使用xadmin，通过adminx,将已有model注册进后台。快速搭建可用的后台系统。"><meta name="keywords" content="Python,Django,在线教育平台"><meta property="og:type" content="article"><meta property="og:title" content="强力Django+杀手级Xadmin打造在线教育平台(五)"><meta property="og:url" content="http://blog.mtianyan.cn/post/507fe3bf.html"><meta property="og:site_name" content="mtianyan&#39;s blog"><meta property="og:description" content="总之，我们要拿来。我们要或使用，或存放，或毁灭。 - 鲁迅    既然有django提供的强大admin,我们便要拿来用喽。  使用xadmin，通过adminx,将已有model注册进后台。快速搭建可用的后台系统。"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/97kgi66hBJ.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/BdL32DBc99.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/ggemFK9lAJ.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/ie29f0bI0a.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/C0h63A68F5.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/L3fGhdb7C6.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/c58F6dg549.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/Fk7G3EkDC4.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/761bBAhbJl.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/l4mGKFaGm4.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/2c3el2afjg.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/bgleKlg6kJ.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/Al734ikfA4.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/7ccm6L5BG7.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/KFaKi4gC3C.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/FbJeCbijh4.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/kmCI61m81H.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/I3F7K6KhLf.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/KiBgGKCgLI.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/22J8la5G8c.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/3LEG0j7e2h.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/BL45eAhd66.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/8A5cED00eC.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/GG009ClkEE.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/F45LiKCF16.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/gb0kBFIJKH.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/0mbjJe5ImK.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/aj9gJbeJJJ.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/fDclFJl6el.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/8lLa4IIadB.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/FcAJjJcAAm.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/am4cLCB69D.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/HcG0a8g2Ef.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/FhLLheAi2f.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/0L58d277Ba.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/H8eLIc73d9.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/ICGm5c3acB.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/9mcfFD7kml.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/dH8Kblkmaj.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/cIe1LjK7gC.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/E6il5E9j86.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/14kIeC7dbA.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/KGcFbA85d9.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/314L2DdfGB.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/34EdEDHgac.png?imageslim"><meta property="og:updated_time" content="2018-02-02T12:40:13.960Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="强力Django+杀手级Xadmin打造在线教育平台(五)"><meta name="twitter:description" content="总之，我们要拿来。我们要或使用，或存放，或毁灭。 - 鲁迅    既然有django提供的强大admin,我们便要拿来用喽。  使用xadmin，通过adminx,将已有model注册进后台。快速搭建可用的后台系统。"><meta name="twitter:image" content="http://myphoto.mtianyan.cn/blog/180109/97kgi66hBJ.png?imageslim"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.3",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://blog.mtianyan.cn/post/507fe3bf.html"><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement("script"),n=t.getElementsByTagName("script")[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,0,("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/0f81ff2f.js","daovoice"),daovoice("init",{app_id:"e28768be"}),daovoice("update")</script><title>强力Django+杀手级Xadmin打造在线教育平台(五) | mtianyan's blog</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?415372bd35fec36f7558dd96b48ec03f";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/mtianyan" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">mtianyan's blog</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">天涯明月笙的博客小站(Github托管)</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br> 公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://blog.mtianyan.cn/post/507fe3bf.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="mtianyan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="mtianyan's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">强力Django+杀手级Xadmin打造在线教育平台(五)</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-10T22:09:17+08:00">2018-01-10</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Django-Xadmin打造在线教育平台/" itemprop="url" rel="index"><span itemprop="name">Django+Xadmin打造在线教育平台</span></a></span></span> <span id="/post/507fe3bf.html" class="leancloud_visitors" data-flag-title="强力Django+杀手级Xadmin打造在线教育平台(五)"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">热度&#58;</span><span class="leancloud-visitors-count"></span> <span>℃</span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">4,487</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">20</span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote class="blockquote-center"><p>总之，我们要拿来。我们要或使用，或存放，或毁灭。 - 鲁迅</p></blockquote><div class="note"><p> 既然有django提供的强大admin,我们便要拿来用喽。</p><ul><li>使用xadmin，通过adminx,将已有model注册进后台。快速搭建可用的后台系统。</li></ul></div><a id="more"></a><h2 id="django-admin介绍"><a href="#django-admin介绍" class="headerlink" title="django admin介绍"></a>django admin介绍</h2><p>上一章我们进行了需求分析和数据库设计。本章我们来快速搭建一个可用的后台管理系统。</p><p>后台管理系统特点：</p><ul><li>权限管理</li><li>少前端样式。(样式一般不是很看重)，</li><li>快速开发</li></ul><p>django的后台管理系统是一套智能的管理系统。<br>django的杀手锏之一就是admin管理系统。</p><p>admin在项目新建时就已经为我们生成好了。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/97kgi66hBJ.png?imageslim" alt="mark"></p><p>Django的admin也是一个app，在我们新建项目时就创建好了。<br>而且会自动在url中配置好了链接。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/BdL32DBc99.png?imageslim" alt="mark"></p><p>访问:<a href="http://127.0.0.1:8000/admin/" target="_blank" rel="noopener">http://127.0.0.1:8000/admin/</a></p><p>可以看到admin的登录窗口。</p><p>Django是不会自动生成admin的用户的，需要我们自己去命令生成。</p><h3 id="createsuperuser"><a href="#createsuperuser" class="headerlink" title="createsuperuser"></a>createsuperuser</h3><p>点击<code>Tools 菜单下 Run manage.py Task</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createsuperuser</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180109/ggemFK9lAJ.png?imageslim" alt="mark"></p><p>输入自己的用户名密码。</p><p>报错:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django.db.utils.DataError: (1406, &quot;Data too long for column &apos;gender&apos; at row 1&quot;)</span><br></pre></td></tr></table></figure><blockquote><p>gender中female是6位。而我们最大长度只有5.</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180109/ie29f0bI0a.png?imageslim" alt="mark"></p><p>修改后</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makemigrations users</span><br><span class="line">migrate users</span><br></pre></td></tr></table></figure><p>然后重新<code>createsuperuser</code></p><p>使用自己定义的用户名密码可以登进系统。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/C0h63A68F5.png?imageslim" alt="mark"></p><blockquote><p>默认是用户名 + 密码。后面会讲到如何实现用户名 或 邮箱和密码登录。</p></blockquote><h3 id="修改setting中对应语言，时区，以及数据库写入时间。"><a href="#修改setting中对应语言，时区，以及数据库写入时间。" class="headerlink" title="修改setting中对应语言，时区，以及数据库写入时间。"></a>修改setting中对应语言，时区，以及数据库写入时间。</h3><p>修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 语言改为中文</span><br><span class="line">LANGUAGE_CODE = &apos;zh-hans&apos;</span><br><span class="line"></span><br><span class="line"># 时区改为上海</span><br><span class="line">TIME_ZONE = &apos;Asia/Shanghai&apos;</span><br><span class="line"># 数据库存储使用时间，True时间会被存为UTC的时间</span><br><span class="line">USE_TZ = False</span><br></pre></td></tr></table></figure><p>点击运行可以看到如下图被换成汉语的效果:</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/L3fGhdb7C6.png?imageslim" alt="mark"></p><p>注意: django 2.0.1 并不会看到汉化后的默认页面。只有admin被汉化了。</p><p>组对应数据表: auth_group</p><p>在Django的admin中可以把上章的表都注册进来。对于表进行任意的增删改查。</p><p>默认其实会把user也注册进来的，但是因为我们通过userProfile覆盖了user。所以没有显示。</p><h3 id="注册UserProfile进来"><a href="#注册UserProfile进来" class="headerlink" title="注册UserProfile进来"></a>注册UserProfile进来</h3><p>users/admin.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 因为同一个目录，所以可以直接.models</span></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> UserProfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写一个管理器:命名, model+Admin</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfileAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将UserProfile注册进我们的admin中, 并为它选择管理器</span></span><br><span class="line">admin.site.register(UserProfile,UserProfileAdmin)</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180109/c58F6dg549.png?imageslim" alt="mark"></p><blockquote><p>可以看到我们的用户信息就注册进来了。</p></blockquote><p><code>USERS</code> 是用户所在表名称。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/Fk7G3EkDC4.png?imageslim" alt="mark"></p><p>进入页面可以看到Django为我们把每个不同类型的字段生成了不同的前端样式。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/761bBAhbJl.png?imageslim" alt="mark"></p><blockquote><p>Django会自动帮我们把密码加密，而且不能反解。单向性。</p></blockquote><p>如果出现错误, 可能是<code>initial</code>文件在我们拖入apps时路径被改变。之后我们添加了环境变量, 前面再加上apps就会报错。</p><p>这时把<code>initial.py</code> 中路径进行修改。</p><p>错误2：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">新增用户信息提示：</span><br><span class="line">Cannot add or update a child row: a foreign key constraint fails</span><br><span class="line">(1452, &apos;Cannot add or update a child row: a foreign key constraint fails </span><br><span class="line">`mxonline`.`django_admin_log`, CONSTRAINT `django_admin_log_user_id_c564eba6_fk_auth_user_id` </span><br><span class="line">FOREIGN KEY (`user_id`) REFERENCES `auth_user` (`id`))&apos;)</span><br></pre></td></tr></table></figure><blockquote><p>解决方案1: 不用解决，之后换Xadmin就好了。</p></blockquote><p>解决方案2: 在setting的databases中添加以下代码取消外键检查</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    &apos;default&apos;: &#123;</span><br><span class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,</span><br><span class="line">        &apos;NAME&apos;: &apos;mxonline2&apos;,</span><br><span class="line">        &apos;USER&apos;: &apos;root&apos;,</span><br><span class="line">        &apos;PASSWORD&apos;: &apos;你的密码&apos;,</span><br><span class="line">        &apos;HOST&apos;:&apos;127.0.0.1&apos;,</span><br><span class="line">        &apos;OPTIONS&apos;: &#123;</span><br><span class="line">          &quot;init_command&quot;: &quot;SET foreign_key_checks=0;&quot;,</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180109/l4mGKFaGm4.png?imageslim" alt="mark"></p><p>实验成功为了不影响后面，把options删除</p><p>本小节结束对应commit:</p><blockquote><p>admin中添加管理器&amp;注册。时区,语言,utc(False).数据库中选项参数。female的长度修改, createsuperuser.对应5-1</p></blockquote><h2 id="xadmin的安装"><a href="#xadmin的安装" class="headerlink" title="xadmin的安装"></a>xadmin的安装</h2><p>一套基于admin, 比admin更强大的系统。</p><ol><li>通过pip安装</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install xadmin</span><br></pre></td></tr></table></figure><h3 id="Python3-amp-Django2-0-1安装官方适配Django2-0的包"><a href="#Python3-amp-Django2-0-1安装官方适配Django2-0的包" class="headerlink" title="Python3 &amp; Django2.0.1安装官方适配Django2.0的包"></a>Python3 &amp; Django2.0.1安装官方适配Django2.0的包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install git+git://github.com/sshwsfc/xadmin.git@django2</span><br></pre></td></tr></table></figure><p>xadmin可以把我们的后台做的很强大，可扩展。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/2c3el2afjg.png?imageslim" alt="mark"></p><p>可以看到它同时下载了很多其他依赖包。</p><h3 id="注册Xadmin-与-crispy-forms"><a href="#注册Xadmin-与-crispy-forms" class="headerlink" title="注册Xadmin 与 crispy-forms"></a>注册Xadmin 与 crispy-forms</h3><p>Mxonline2/settings.py的INSTALLED_APPS中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&apos;xadmin&apos;,</span><br><span class="line">&apos;crispy_forms&apos;</span><br></pre></td></tr></table></figure><p>然后把urls中默认admin指向Xadmin</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入x admin，替换admin</span></span><br><span class="line"><span class="keyword">import</span> xadmin</span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^xadmin/'</span>, xadmin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>Python3 Django2.0.1 的url的配置中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(&apos;xadmin/&apos;, xadmin.site.urls),</span><br></pre></td></tr></table></figure><p><strong>注意：Django 2.0.1中不需要加<code>r</code>也不需要加<code>^</code></strong></p><p>将我们原来写的user/admin.py中代码注释掉。</p><p>此时直接运行项目会报错，因为我们Xadmin的默认数据表并没有migarte</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ProgrammingError: (1146, &quot;Table &apos;mxonline2.xadmin_usersettings&apos; doesn&apos;t exist&quot;)</span><br><span class="line">[09/Jan/2018 06:40:27] &quot;GET /xadmin/ HTTP/1.1&quot; 500 150414</span><br></pre></td></tr></table></figure><p>点击<code>Tools 菜单下 Run manage.py Task</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makemigrations</span><br><span class="line">migrate</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180109/bgleKlg6kJ.png?imageslim" alt="mark"></p><blockquote><p>可以看到已经被应用成功。</p></blockquote><p>前往Navicat进行验证。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/Al734ikfA4.png?imageslim" alt="mark"></p><blockquote><p>可以看到新增的表。</p></blockquote><p>Xadmin的后台采用的是bootstrap。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/7ccm6L5BG7.png?imageslim" alt="mark"></p><blockquote><p>后面我们会介绍如何制作插件</p></blockquote><h3 id="源码安装："><a href="#源码安装：" class="headerlink" title="源码安装："></a>源码安装：</h3><p>github: <a href="https://github.com/sshwsfc/xadmin" target="_blank" rel="noopener">https://github.com/sshwsfc/xadmin</a></p><p>下载或<code>git clone</code>将源码下载到本地。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/KFaKi4gC3C.png?imageslim" alt="mark"></p><blockquote><p>解压后将Xadmin文件夹复制到我们的项目中。</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180109/FbJeCbijh4.png?imageslim" alt="mark"></p><h4 id="Python3版本源码安装-与url配置不同"><a href="#Python3版本源码安装-与url配置不同" class="headerlink" title="Python3版本源码安装:与url配置不同"></a>Python3版本源码安装:与url配置不同</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b django2 https://github.com/sshwsfc/xadmin.git</span><br></pre></td></tr></table></figure><p>其余操作一样。</p><h3 id="新建extra-apps，并在setting中注册地址"><a href="#新建extra-apps，并在setting中注册地址" class="headerlink" title="新建extra_apps，并在setting中注册地址"></a>新建extra_apps，并在setting中注册地址</h3><p>新建new package: extra_apps</p><blockquote><p>使用该目录存放我们的第三方插件，将Xadmin移入。<br>右键mark为SourceRoot, 但是这时候cmd下回报错。</p></blockquote><p>所以在setting.py中加入。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sys.path.insert(<span class="number">0</span>,os.path.join(BASE_DIR, <span class="string">'extra_apps'</span>))</span><br></pre></td></tr></table></figure><blockquote><p>因为我们的source目录已经有Xadmin了，就不会再去系统环境中找了。这时候卸载我们的Xadmin。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">workon mxonline2</span><br><span class="line">pip uninstall xadmin</span><br></pre></td></tr></table></figure><p>但是他的依赖包我们还需要，所以只需要卸载Xadmin。此时我们运行会报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">    from future.utils import iteritems</span><br><span class="line">ImportError: No module named future.utils</span><br></pre></td></tr></table></figure><p>安装必要的包:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip install future</span><br><span class="line">pip install six</span><br><span class="line">pip install httplib2</span><br><span class="line">pip install django-import-export</span><br></pre></td></tr></table></figure><p>此时又可以成功运行了</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/kmCI61m81H.png?imageslim" alt="mark"></p><p>日志记录：后台管理人员做的操作都会生成一条记录。</p><p>源码安装优点:</p><ul><li>xadmin新特性</li><li>对于源码进行自己的修改。</li></ul><p>本小节结束对应commit:</p><blockquote><p>Xadmin的安装与源码安装，配置setting中extra_apps. 对应5-2</p></blockquote><h2 id="users-app-的model注册"><a href="#users-app-的model注册" class="headerlink" title="users app 的model注册"></a>users app 的model注册</h2><h3 id="遗留问题-django2-0-1使用xadmin时。如验证码等带dateTimefield区域出错。"><a href="#遗留问题-django2-0-1使用xadmin时。如验证码等带dateTimefield区域出错。" class="headerlink" title="遗留问题: django2.0.1使用xadmin时。如验证码等带dateTimefield区域出错。"></a>遗留问题: django2.0.1使用xadmin时。如验证码等带dateTimefield区域出错。</h3><p>xadmin/widgets.py</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/I3F7K6KhLf.png?imageslim" alt="mark"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">input_html = [ht <span class="keyword">for</span> ht <span class="keyword">in</span> super(AdminSplitDateTime, self).render(</span><br><span class="line">    name, value, attrs).split(<span class="string">'/&gt;&lt;'</span>) <span class="keyword">if</span> ht != <span class="string">''</span>]</span><br><span class="line">        <span class="keyword">if</span> (len(input_html) &gt; <span class="number">1</span>):</span><br><span class="line">            input_html[<span class="number">0</span>] = input_html[<span class="number">0</span>] + <span class="string">"/&gt;"</span></span><br><span class="line">            input_html[<span class="number">1</span>] = <span class="string">"&lt;"</span> + input_html[<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180109/KiBgGKCgLI.png?imageslim" alt="mark"></p><blockquote><p>此时可以看到已经运行正常</p></blockquote><h3 id="真正开始"><a href="#真正开始" class="headerlink" title="真正开始"></a>真正开始</h3><p>Xadmin是基于Django的admin来开发的，所以Xadmin也继承了许多admin的用法。</p><ul><li>比如: models的注册。</li></ul><p>UserProfile已经被自动注册进去了，我们从验证码开始注册。</p><p>我们需要新建一个<code>adminx.py</code>文件，Xadmin会自动搜寻这种命名的文件。</p><h3 id="新建py文件的初始化模板"><a href="#新建py文件的初始化模板" class="headerlink" title="新建py文件的初始化模板"></a>新建py文件的初始化模板</h3><p><img src="http://myphoto.mtianyan.cn/blog/180109/22J8la5G8c.png?imageslim" alt="mark"></p><p>新建users/adminx.py：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># encoding: utf-8</span><br><span class="line">__author__ = &apos;mtianyan&apos;</span><br><span class="line">__date__ = &apos;2018/1/9 0009 08:02&apos;</span><br><span class="line"></span><br><span class="line">import xadmin</span><br><span class="line"></span><br><span class="line">from .models import EmailVerifyRecord</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建admin的管理类,这里不再是继承admin，而是继承object</span><br><span class="line">class EmailVerifyRecordAdmin(object):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xadmin.site.register(EmailVerifyRecord, EmailVerifyRecordAdmin)</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180109/3LEG0j7e2h.png?imageslim" alt="mark"></p><blockquote><p>可以看到这时候访问已经有邮箱验证码了。</p></blockquote><p>邮箱验证码这几个字就是我们代码中Meta中verbose_name定义的:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    verbose_name = <span class="string">"邮箱验证码"</span></span><br><span class="line">    verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure><p><code>verbose_name_plural</code>是<code>verbose_name</code>的复数形式。</p><p>字段的verbose_name会直接显示在后台。<code>sendtype</code>和<code>sendtime</code>没有设置所以直接显示了英文。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/BL45eAhd66.png?imageslim" alt="mark"></p><blockquote><p>可以看到我们添加验证码成功。注意:上节版本中我们进行了: makemigaration &amp; migrate。<br>但是它是pip安装的Xadmin的数据表生成。我们卸载之后，源码安装需要重新运行进行数据迁移。(django需要通过app文件夹下的init文件来记录表的更改记录，pip的都卸了，所以就没法找到了)</p></blockquote><p>会报错:</p><blockquote><p>Xadmin_log不存在错误。只需要运行这两条命令即可。</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180109/8A5cED00eC.png?imageslim" alt="mark"></p><h4 id="解决后台部分英文显示"><a href="#解决后台部分英文显示" class="headerlink" title="解决后台部分英文显示"></a>解决后台部分英文显示</h4><blockquote><p>全部models中字段自行添加verbose_name</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180109/GG009ClkEE.png?imageslim" alt="mark"></p><p>这里就不贴出来了，自行检查都加上(没写出的请自行修改全部加上verbose_name)。</p><h4 id="解决EmailVerifyRecord-object显示"><a href="#解决EmailVerifyRecord-object显示" class="headerlink" title="解决EmailVerifyRecord object显示"></a>解决EmailVerifyRecord object显示</h4><blockquote><p><strong>全部</strong>(没写出的请自行修改)model，py2:重载<code>__unicode</code> py3:重载<code>__str__</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重载Unicode方法使后台不再直接显示object</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&#123;0&#125;(&#123;1&#125;)'</span>.format(self.code,self.email)</span><br></pre></td></tr></table></figure><blockquote><p>上面代码是python的自身基础语法。</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180109/F45LiKCF16.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180109/gb0kBFIJKH.png?imageslim" alt="mark"></p><h4 id="配置显示列"><a href="#配置显示列" class="headerlink" title="配置显示列"></a>配置显示列</h4><p><img src="http://myphoto.mtianyan.cn/blog/180109/0mbjJe5ImK.png?imageslim" alt="mark"></p><p>users/adminx.py的管理器中设置list_display:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 创建admin的管理类,这里不再是继承admin，而是继承object</span><br><span class="line">class EmailVerifyRecordAdmin(object):</span><br><span class="line">    # 配置后台我们需要显示的列</span><br><span class="line">    list_display = [&apos;code&apos;, &apos;email&apos;,&apos;send_type&apos;, &apos;send_time&apos;]</span><br></pre></td></tr></table></figure><blockquote><p>list_display可以使用列表或元祖，建议使用列表。否则元组只有一个元素，忘记加逗号就会报错。</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180109/aj9gJbeJJJ.png?imageslim" alt="mark"></p><p>选择框的生成是因为我们加上了<code>choices</code></p><h4 id="配置搜索searchfield"><a href="#配置搜索searchfield" class="headerlink" title="配置搜索searchfield"></a>配置搜索searchfield</h4><p>users/adminx.py的管理器中EmailVerifyRecordAdmin添加</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置搜索字段,不做时间搜索</span></span><br><span class="line">search_fields =  [<span class="string">'code'</span>, <span class="string">'email'</span>,<span class="string">'send_type'</span>]</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180109/fDclFJl6el.png?imageslim" alt="mark"></p><p>再添加一条数据验证搜索功能</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/8lLa4IIadB.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180109/FcAJjJcAAm.png?imageslim" alt="mark"></p><h4 id="xadmin导出csv中文乱码解决"><a href="#xadmin导出csv中文乱码解决" class="headerlink" title="xadmin导出csv中文乱码解决"></a>xadmin导出csv中文乱码解决</h4><p><img src="http://myphoto.mtianyan.cn/blog/180109/am4cLCB69D.png?imageslim" alt="mark"></p><blockquote><p>将<code>charset=utf-8</code> 改为<code>charset=gbk</code></p></blockquote><h4 id="xadmin导出xml报错"><a href="#xadmin导出xml报错" class="headerlink" title="xadmin导出xml报错"></a>xadmin导出xml报错</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TypeError at /xadmin/users/emailverifyrecord/</span><br><span class="line">unicode argument expected, got &apos;str&apos;</span><br></pre></td></tr></table></figure><blockquote><p>io.StringIO这个库新版本的python3直接往这个库中加入了一些新的内容，使得该库在Python2.7中较为混乱。</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180109/HcG0a8g2Ef.png?imageslim" alt="mark"></p><blockquote><p>将StringIo变为BytesIO</p></blockquote><h4 id="通过时间筛选字段。"><a href="#通过时间筛选字段。" class="headerlink" title="通过时间筛选字段。"></a>通过时间筛选字段。</h4><p>users/adminx.py的管理器中EmailVerifyRecordAdmin添加</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 配置筛选字段</span><br><span class="line">list_filter =  [&apos;code&apos;, &apos;email&apos;,&apos;send_type&apos;, &apos;send_time&apos;]</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180109/FhLLheAi2f.png?imageslim" alt="mark"></p><h3 id="Django的admin-Xadmin和其他系统区别"><a href="#Django的admin-Xadmin和其他系统区别" class="headerlink" title="Django的admin, Xadmin和其他系统区别"></a>Django的admin, Xadmin和其他系统区别</h3><blockquote><p>不像php等其他语言是一个功能模块一个功能设计的。<br>Django是对于每张表增删改查的管理器，我们可以在增删改成的基础上加上我们自己的后台逻辑。<br>因此某种程度可以说他是不依赖于具体业务的。不管啥系统后台都是由表组成。</p></blockquote><p>不依赖于后台逻辑，又可以加上逻辑。</p><h3 id="user-models的注册"><a href="#user-models的注册" class="headerlink" title="user/models的注册"></a>user/models的注册</h3><p>users/adminx.py中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 创建banner的管理类</span><br><span class="line">class BannerAdmin(object):</span><br><span class="line">    list_display = [&apos;title&apos;, &apos;image&apos;, &apos;url&apos;,&apos;index&apos;, &apos;add_time&apos;]</span><br><span class="line">    search_fields = [&apos;title&apos;, &apos;image&apos;, &apos;url&apos;,&apos;index&apos;]</span><br><span class="line">    list_filter = [&apos;title&apos;, &apos;image&apos;, &apos;url&apos;,&apos;index&apos;, &apos;add_time&apos;]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 将model与admin管理器进行关联注册</span><br><span class="line">xadmin.site.register(Banner, BannerAdmin)</span><br></pre></td></tr></table></figure><p>此时后台页面。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/0L58d277Ba.png?imageslim" alt="mark"></p><blockquote><p>可以自行测试轮播图是否可以新建成功。</p></blockquote><p>本小节结束对应commit:</p><blockquote><p>usersmodels三张表注册进xadmin, 配置搜索过滤展示字段，修复xadmin导出xml错误,导出csv乱码，Unicode重载。对应5-3</p></blockquote><p>py3(django2.0.1):</p><blockquote><p>usersmodels三张表注册进xadmin, 配置搜索过滤展示字段，修复xadmin导出csv乱码，修复django2.0.1的indexError, str重载。对应5-3</p></blockquote><h2 id="剩余app-model注册"><a href="#剩余app-model注册" class="headerlink" title="剩余app model注册"></a>剩余app model注册</h2><h3 id="courses注册"><a href="#courses注册" class="headerlink" title="courses注册"></a>courses注册</h3><p>新建courses/adminx.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line">__author__ = <span class="string">'mtianyan'</span></span><br><span class="line">__date__ = <span class="string">'2018/1/9 0009 20:10'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Course, Lesson, Video, CourseResource</span><br><span class="line"><span class="keyword">import</span> xadmin</span><br><span class="line"></span><br><span class="line"><span class="comment"># Course的admin管理器</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [</span><br><span class="line">        <span class="string">'name'</span>,</span><br><span class="line">        <span class="string">'desc'</span>,</span><br><span class="line">        <span class="string">'detail'</span>,</span><br><span class="line">        <span class="string">'degree'</span>,</span><br><span class="line">        <span class="string">'learn_times'</span>,</span><br><span class="line">        <span class="string">'students'</span>]</span><br><span class="line">    search_fields = [<span class="string">'name'</span>, <span class="string">'desc'</span>, <span class="string">'detail'</span>, <span class="string">'degree'</span>, <span class="string">'students'</span>]</span><br><span class="line">    list_filter = [</span><br><span class="line">        <span class="string">'name'</span>,</span><br><span class="line">        <span class="string">'desc'</span>,</span><br><span class="line">        <span class="string">'detail'</span>,</span><br><span class="line">        <span class="string">'degree'</span>,</span><br><span class="line">        <span class="string">'learn_times'</span>,</span><br><span class="line">        <span class="string">'students'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LessonAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'course'</span>, <span class="string">'name'</span>, <span class="string">'add_time'</span>]</span><br><span class="line">    search_fields = [<span class="string">'course'</span>, <span class="string">'name'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># __name代表使用外键中name字段</span></span><br><span class="line">    list_filter = [<span class="string">'course__name'</span>, <span class="string">'name'</span>, <span class="string">'add_time'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VideoAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'lesson'</span>, <span class="string">'name'</span>, <span class="string">'add_time'</span>]</span><br><span class="line">    search_fields = [<span class="string">'lesson'</span>, <span class="string">'name'</span>]</span><br><span class="line">    list_filter = [<span class="string">'lesson'</span>, <span class="string">'name'</span>, <span class="string">'add_time'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseResourceAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'course'</span>, <span class="string">'name'</span>, <span class="string">'download'</span>, <span class="string">'add_time'</span>]</span><br><span class="line">    search_fields = [<span class="string">'course'</span>, <span class="string">'name'</span>, <span class="string">'download'</span>]</span><br><span class="line">    <span class="comment"># __name代表使用外键中name字段</span></span><br><span class="line">    list_filter = [<span class="string">'course__name'</span>, <span class="string">'name'</span>, <span class="string">'download'</span>, <span class="string">'add_time'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将管理器与model进行注册关联</span></span><br><span class="line">xadmin.site.register(Course, CourseAdmin)</span><br><span class="line">xadmin.site.register(Lesson, LessonAdmin)</span><br><span class="line">xadmin.site.register(Video, VideoAdmin)</span><br><span class="line">xadmin.site.register(CourseResource, CourseResourceAdmin)</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180109/H8eLIc73d9.png?imageslim" alt="mark"></p><blockquote><p>注意：对应后台显示英文的字段自行检查<code>verbosename</code>，自行加上。<br>注意: py2下重载<code>__unicode__</code>方法，py3下重载<code>__str__</code>方法</p></blockquote><p>如(注意缩进):</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'《&#123;0&#125;》课程的章节 &gt;&gt; &#123;1&#125;'</span>.format(self.course,self.name)</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180109/ICGm5c3acB.png?imageslim" alt="mark"></p><p><code>int</code>类型后台会生成如下图区间取值:</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/9mcfFD7kml.png?imageslim" alt="mark"></p><p>可以看到有外键关系的会有一个小符号。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/dH8Kblkmaj.png?imageslim" alt="mark"></p><h3 id="注册机构app的adminx"><a href="#注册机构app的adminx" class="headerlink" title="注册机构app的adminx"></a>注册机构app的adminx</h3><p>新建<code>organization/adminx.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line">__author__ = <span class="string">'mtianyan'</span></span><br><span class="line">__date__ = <span class="string">'2018/1/9 0009 21:01'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> xadmin</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> CityDict, CourseOrg, Teacher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 机构所属城市名后台管理器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CityDictAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'name'</span>, <span class="string">'desc'</span>, <span class="string">'add_time'</span>]</span><br><span class="line">    search_fields = [<span class="string">'name'</span>, <span class="string">'desc'</span>]</span><br><span class="line">    list_filter = [<span class="string">'name'</span>, <span class="string">'desc'</span>, <span class="string">'add_time'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 机构课程信息管理器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseOrgAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'name'</span>, <span class="string">'desc'</span>, <span class="string">'click_nums'</span>, <span class="string">'fav_nums'</span>,<span class="string">'add_time'</span> ]</span><br><span class="line">    search_fields = [<span class="string">'name'</span>, <span class="string">'desc'</span>, <span class="string">'click_nums'</span>, <span class="string">'fav_nums'</span>]</span><br><span class="line">    list_filter = [<span class="string">'name'</span>, <span class="string">'desc'</span>, <span class="string">'click_nums'</span>, <span class="string">'fav_nums'</span>,<span class="string">'city__name'</span>,<span class="string">'address'</span>,<span class="string">'add_time'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TeacherAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [ <span class="string">'name'</span>,<span class="string">'org'</span>, <span class="string">'work_years'</span>, <span class="string">'work_company'</span>,<span class="string">'add_time'</span>]</span><br><span class="line">    search_fields = [<span class="string">'org'</span>, <span class="string">'name'</span>, <span class="string">'work_years'</span>, <span class="string">'work_company'</span>]</span><br><span class="line">    list_filter = [<span class="string">'org__name'</span>, <span class="string">'name'</span>, <span class="string">'work_years'</span>, <span class="string">'work_company'</span>,<span class="string">'click_nums'</span>, <span class="string">'fav_nums'</span>, <span class="string">'add_time'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xadmin.site.register(CityDict, CityDictAdmin)</span><br><span class="line">xadmin.site.register(CourseOrg, CourseOrgAdmin)</span><br><span class="line">xadmin.site.register(Teacher, TeacherAdmin)</span><br></pre></td></tr></table></figure><blockquote><p>注意：对应后台显示英文的字段自行检查verbosename，自行加上。<br>注意: py2下重载<code>__unicode__</code>方法，py3下重载<code>__str__</code>方法</p></blockquote><p>如(注意缩进):</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">"[&#123;0&#125;]的教师: &#123;1&#125;"</span>.format(self.org, self.name)</span><br></pre></td></tr></table></figure><p>如果注册后没有显示： 重新登录，或重启项目</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/cIe1LjK7gC.png?imageslim" alt="mark"></p><h3 id="operation-app注册xadmin"><a href="#operation-app注册xadmin" class="headerlink" title="operation app注册xadmin"></a>operation app注册xadmin</h3><p>新建<code>operation/adminx.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line">__author__ = <span class="string">'mtianyan'</span></span><br><span class="line">__date__ = <span class="string">'2018/1/9 0009 22:12'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> xadmin</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> UserAsk, UserCourse, UserMessage, CourseComments, UserFavorite</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户表单我要学习后台管理器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserAskAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'name'</span>, <span class="string">'mobile'</span>, <span class="string">'course_name'</span>, <span class="string">'add_time'</span>]</span><br><span class="line">    search_fields = [<span class="string">'name'</span>, <span class="string">'mobile'</span>, <span class="string">'course_name'</span>]</span><br><span class="line">    list_filter = [<span class="string">'name'</span>, <span class="string">'mobile'</span>, <span class="string">'course_name'</span>, <span class="string">'add_time'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户课程学习后台管理器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserCourseAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'user'</span>, <span class="string">'course'</span>, <span class="string">'add_time'</span>]</span><br><span class="line">    search_fields = [<span class="string">'user'</span>, <span class="string">'course'</span>]</span><br><span class="line">    list_filter = [<span class="string">'user'</span>, <span class="string">'course'</span>, <span class="string">'add_time'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户消息后台管理器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserMessageAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'user'</span>, <span class="string">'message'</span>, <span class="string">'has_read'</span>, <span class="string">'add_time'</span>]</span><br><span class="line">    search_fields = [<span class="string">'user'</span>, <span class="string">'message'</span>, <span class="string">'has_read'</span>]</span><br><span class="line">    list_filter = [<span class="string">'user'</span>, <span class="string">'message'</span>, <span class="string">'has_read'</span>, <span class="string">'add_time'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户评论后台管理器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseCommentsAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'user'</span>, <span class="string">'course'</span>, <span class="string">'comments'</span>, <span class="string">'add_time'</span>]</span><br><span class="line">    search_fields = [<span class="string">'user'</span>, <span class="string">'course'</span>, <span class="string">'comments'</span>]</span><br><span class="line">    list_filter = [<span class="string">'user'</span>, <span class="string">'course'</span>, <span class="string">'comments'</span>, <span class="string">'add_time'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户收藏后台管理器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserFavoriteAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'user'</span>, <span class="string">'fav_id'</span>, <span class="string">'fav_type'</span>, <span class="string">'add_time'</span>]</span><br><span class="line">    search_fields = [<span class="string">'user'</span>, <span class="string">'fav_id'</span>, <span class="string">'fav_type'</span>]</span><br><span class="line">    list_filter = [<span class="string">'user'</span>, <span class="string">'fav_id'</span>, <span class="string">'fav_type'</span>, <span class="string">'add_time'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将后台管理器与models进行关联注册。</span></span><br><span class="line">xadmin.site.register(UserAsk, UserAskAdmin)</span><br><span class="line">xadmin.site.register(UserCourse, UserCourseAdmin)</span><br><span class="line">xadmin.site.register(UserMessage, UserMessageAdmin)</span><br><span class="line">xadmin.site.register(CourseComments, CourseCommentsAdmin)</span><br><span class="line">xadmin.site.register(UserFavorite, UserFavoriteAdmin)</span><br></pre></td></tr></table></figure><blockquote><p>注意：对应后台显示英文的字段自行检查<code>verbosename</code>，自行加上。<br>注意: py2下重载<code>__unicode__</code>方法，py3下重载<code>__str__</code>方法</p></blockquote><p>如(注意缩进):</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">"[&#123;0&#125;]的教师: &#123;1&#125;"</span>.format(self.org, self.name)</span><br></pre></td></tr></table></figure><p>成功性验证:</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/E6il5E9j86.png?imageslim" alt="mark"></p><p>本小节结束对于commit:</p><blockquote><p>5:4 注册完成operation,机构，课程app。注意:自行重载str/unicode。补全verbosename。</p></blockquote><h2 id="xadmin全局配置"><a href="#xadmin全局配置" class="headerlink" title="xadmin全局配置"></a>xadmin全局配置</h2><p>将全局配置修改:</p><ul><li>如左上角：django Xadmin。下面的我的公司</li><li>主题修改，app名称汉化，菜单收叠。</li></ul><h3 id="使用Xadmin的主题功能。"><a href="#使用Xadmin的主题功能。" class="headerlink" title="使用Xadmin的主题功能。"></a>使用Xadmin的主题功能。</h3><p>把全站的配置放在users\adminx.py中:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> xadmin <span class="keyword">import</span> views</span><br><span class="line"><span class="comment"># 创建X admin的全局管理器并与view绑定。</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseSetting</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># 开启主题功能</span></span><br><span class="line">    enable_themes = <span class="keyword">True</span></span><br><span class="line">    use_bootswatch = <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将全局配置管理与view绑定注册</span></span><br><span class="line">xadmin.site.register(views.BaseAdminView, BaseSetting)</span><br></pre></td></tr></table></figure><h3 id="解决django1-9-python2-下Xadmin主题不生效问题。"><a href="#解决django1-9-python2-下Xadmin主题不生效问题。" class="headerlink" title="解决django1.9(python2)下Xadmin主题不生效问题。"></a>解决django1.9(python2)下Xadmin主题不生效问题。</h3><p><a href="https://my.oschina.net/u/2396236/blog/1083251" target="_blank" rel="noopener">https://my.oschina.net/u/2396236/blog/1083251</a></p><ul><li>安装requests</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install requests</span><br></pre></td></tr></table></figure><ul><li>/xadmin/plugins/themes.py 引入requests</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br></pre></td></tr></table></figure><ul><li>修改block_top_navmenu方法：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">def block_top_navmenu(self, context, nodes):</span><br><span class="line"></span><br><span class="line">       themes = [</span><br><span class="line">           &#123;&apos;name&apos;: _(u&quot;Default&quot;), &apos;description&apos;: _(u&quot;Default bootstrap theme&quot;), &apos;css&apos;: self.default_theme&#125;,</span><br><span class="line">           &#123;&apos;name&apos;: _(u&quot;Bootstrap2&quot;), &apos;description&apos;: _(u&quot;Bootstrap 2.x theme&quot;), &apos;css&apos;: self.bootstrap2_theme&#125;,</span><br><span class="line">           ]</span><br><span class="line">       select_css = context.get(&apos;site_theme&apos;, self.default_theme)</span><br><span class="line"></span><br><span class="line">       if self.user_themes:</span><br><span class="line">           themes.extend(self.user_themes)</span><br><span class="line"></span><br><span class="line">       if self.use_bootswatch:</span><br><span class="line">           ex_themes = cache.get(THEME_CACHE_KEY)</span><br><span class="line">           if ex_themes:</span><br><span class="line">               themes.extend(json.loads(ex_themes))</span><br><span class="line">           else:</span><br><span class="line">               ex_themes = []</span><br><span class="line">               try:</span><br><span class="line">                   flag = False#假如为True使用原来的代码，假如为Flase，使用requests库来访问</span><br><span class="line">                   if flag:</span><br><span class="line">                       h = httplib2.Http()</span><br><span class="line">                       resp, content = h.request(&quot;http://bootswatch.com/api/3.json&quot;, &apos;GET&apos;, &apos;&apos;,</span><br><span class="line">                           headers=&#123;&quot;Accept&quot;: &quot;application/json&quot;, &quot;User-Agent&quot;: self.request.META[&apos;HTTP_USER_AGENT&apos;]&#125;)</span><br><span class="line">                       if six.PY3:</span><br><span class="line">                           content = content.decode()</span><br><span class="line">                       watch_themes = json.loads(content)[&apos;themes&apos;]</span><br><span class="line">                   else:</span><br><span class="line">                       content = requests.get(&quot;https://bootswatch.com/api/3.json&quot;)</span><br><span class="line">                       if six.PY3:</span><br><span class="line">                           content = content.text.decode()</span><br><span class="line">                       watch_themes = json.loads(content.text)[&apos;themes&apos;]</span><br><span class="line"></span><br><span class="line">                   ex_themes.extend([</span><br><span class="line">                       &#123;&apos;name&apos;: t[&apos;name&apos;], &apos;description&apos;: t[&apos;description&apos;],</span><br><span class="line">                           &apos;css&apos;: t[&apos;cssMin&apos;], &apos;thumbnail&apos;: t[&apos;thumbnail&apos;]&#125;</span><br><span class="line">                       for t in watch_themes])</span><br><span class="line">               except Exception as e:</span><br><span class="line">                   print(e)</span><br><span class="line"></span><br><span class="line">               cache.set(THEME_CACHE_KEY, json.dumps(ex_themes), 24 * 3600)</span><br><span class="line">               themes.extend(ex_themes)</span><br><span class="line"></span><br><span class="line">       nodes.append(loader.render_to_string(&apos;xadmin/blocks/comm.top.theme.html&apos;, &#123;&apos;themes&apos;: themes, &apos;select_css&apos;: select_css&#125;))</span><br></pre></td></tr></table></figure><h3 id="修改django-admin-和下面的我的公司收起菜单"><a href="#修改django-admin-和下面的我的公司收起菜单" class="headerlink" title="修改django admin 和下面的我的公司收起菜单"></a>修改django admin 和下面的我的公司收起菜单</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># x admin 全局配置参数信息设置</span><br><span class="line">class GlobalSettings(object):</span><br><span class="line">    site_title = &quot;天涯明月笙: 慕课后台管理站&quot;</span><br><span class="line">    site_footer = &quot;mtianyan&apos;s mooc&quot;</span><br><span class="line">    # 收起菜单</span><br><span class="line">    menu_style = &quot;accordion&quot;</span><br><span class="line"># 将头部与脚部信息进行注册:</span><br><span class="line">xadmin.site.register(views.CommAdminView, GlobalSettings)</span><br></pre></td></tr></table></figure><h3 id="apps-py配置app的显示名称"><a href="#apps-py配置app的显示名称" class="headerlink" title="apps.py配置app的显示名称"></a>apps.py配置app的显示名称</h3><p>每个app下执行同样操作:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">from</span> django.apps <span class="keyword">import</span> AppConfig</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CoursesConfig</span><span class="params">(AppConfig)</span>:</span></span><br><span class="line">    name = <span class="string">'courses'</span></span><br><span class="line">    verbose_name = <span class="string">u"课程"</span></span><br></pre></td></tr></table></figure><p><strong>注意自行找猫画虎为每个app添加中文名</strong></p><blockquote><p>新建app时并没有引用apps的配置</p></blockquote><p>在app下的init.py中添加:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default_app_config = <span class="string">"operation.apps.OperationConfig"</span></span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180109/14kIeC7dbA.png?imageslim" alt="mark"></p><p>注意对应关系。</p><p><strong>注意为每个都添加对应的default_app_config</strong></p><p>最终大功告成：</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/KGcFbA85d9.png?imageslim" alt="mark"></p><h3 id="自定义导航菜单顺序"><a href="#自定义导航菜单顺序" class="headerlink" title="自定义导航菜单顺序"></a>自定义导航菜单顺序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">class GlobalSetting(object):</span><br><span class="line">     def get_site_menu(self):</span><br><span class="line">        return (</span><br><span class="line">            &#123;&apos;title&apos;: &apos;课程管理&apos;, &apos;menus&apos;: (</span><br><span class="line">                &#123;&apos;title&apos;: &apos;课程信息&apos;, &apos;url&apos;: self.get_model_url(Course, &apos;changelist&apos;)&#125;,</span><br><span class="line">                &#123;&apos;title&apos;: &apos;章节信息&apos;, &apos;url&apos;: self.get_model_url(Lesson, &apos;changelist&apos;)&#125;,</span><br><span class="line">                &#123;&apos;title&apos;: &apos;视频信息&apos;, &apos;url&apos;: self.get_model_url(Video, &apos;changelist&apos;)&#125;,</span><br><span class="line">                &#123;&apos;title&apos;: &apos;课程资源&apos;, &apos;url&apos;: self.get_model_url(CourseResource, &apos;changelist&apos;)&#125;,</span><br><span class="line">                &#123;&apos;title&apos;: &apos;课程评论&apos;, &apos;url&apos;: self.get_model_url(CourseComments, &apos;changelist&apos;)&#125;,</span><br><span class="line">            )&#125;,</span><br><span class="line">            &#123;&apos;title&apos;: &apos;机构管理&apos;, &apos;menus&apos;: (</span><br><span class="line">                &#123;&apos;title&apos;: &apos;所在城市&apos;, &apos;url&apos;: self.get_model_url(CityDict, &apos;changelist&apos;)&#125;,</span><br><span class="line">                &#123;&apos;title&apos;: &apos;机构讲师&apos;, &apos;url&apos;: self.get_model_url(Teacher, &apos;changelist&apos;)&#125;,</span><br><span class="line">                &#123;&apos;title&apos;: &apos;机构信息&apos;, &apos;url&apos;: self.get_model_url(CourseOrg, &apos;changelist&apos;)&#125;,</span><br><span class="line">            )&#125;,</span><br><span class="line">            &#123;&apos;title&apos;: &apos;用户管理&apos;, &apos;menus&apos;: (</span><br><span class="line">                &#123;&apos;title&apos;: &apos;用户信息&apos;, &apos;url&apos;: self.get_model_url(UserProfile, &apos;changelist&apos;)&#125;,</span><br><span class="line">                &#123;&apos;title&apos;: &apos;用户验证&apos;, &apos;url&apos;: self.get_model_url(EmailVerifyRecord, &apos;changelist&apos;)&#125;,</span><br><span class="line">                &#123;&apos;title&apos;: &apos;用户课程&apos;, &apos;url&apos;: self.get_model_url(UserCourse, &apos;changelist&apos;)&#125;,</span><br><span class="line">                &#123;&apos;title&apos;: &apos;用户收藏&apos;, &apos;url&apos;: self.get_model_url(UserFavorite, &apos;changelist&apos;)&#125;,</span><br><span class="line">                &#123;&apos;title&apos;: &apos;用户消息&apos;, &apos;url&apos;: self.get_model_url(UserMessage, &apos;changelist&apos;)&#125;,</span><br><span class="line">            )&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#123;&apos;title&apos;: &apos;系统管理&apos;, &apos;menus&apos;: (</span><br><span class="line">                &#123;&apos;title&apos;: &apos;用户咨询&apos;, &apos;url&apos;: self.get_model_url(UserAsk, &apos;changelist&apos;)&#125;,</span><br><span class="line">                &#123;&apos;title&apos;: &apos;首页轮播&apos;, &apos;url&apos;: self.get_model_url(Banner, &apos;changelist&apos;)&#125;,</span><br><span class="line">                &#123;&apos;title&apos;: &apos;用户分组&apos;, &apos;url&apos;: self.get_model_url(Group, &apos;changelist&apos;)&#125;,</span><br><span class="line">                &#123;&apos;title&apos;: &apos;用户权限&apos;, &apos;url&apos;: self.get_model_url(Permission, &apos;changelist&apos;)&#125;,</span><br><span class="line">                &#123;&apos;title&apos;: &apos;日志记录&apos;, &apos;url&apos;: self.get_model_url(Log, &apos;changelist&apos;)&#125;,</span><br><span class="line">            )&#125;,</span><br><span class="line"></span><br><span class="line">xadmin.site.register(views.CommAdminView, GlobalSetting)</span><br></pre></td></tr></table></figure><p>最终成型菜单:</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/314L2DdfGB.png?imageslim" alt="mark"></p><h3 id="日志记录的使用"><a href="#日志记录的使用" class="headerlink" title="日志记录的使用"></a>日志记录的使用</h3><blockquote><p>日志记录会记录下我们进行过什么操作。</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180110/34EdEDHgac.png?imageslim" alt="mark"></p><p>通过点击动作，进入当时修改的某条信息</p><p>第五章完结对应commit:</p><blockquote><p>5-5 (第五章完结),配置了页头页脚信息，修改了菜单的顺序，配置apps中文名，修复Python2下，xadmin主题不生效问题。 完结撒花。</p></blockquote></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/post/507fe3bf.html">强力Django+杀手级Xadmin打造在线教育平台(五)</a></p><p><span>文章作者:</span><a href="/" title="访问 mtianyan 的个人博客">mtianyan</a></p><p><span>发布时间:</span>2018年01月10日 - 22:01</p><p><span>最后更新:</span>2018年02月02日 - 20:02</p><p><span>原始链接:</span><a href="/post/507fe3bf.html" title="强力Django+杀手级Xadmin打造在线教育平台(五)">http://blog.mtianyan.cn/post/507fe3bf.html</a><span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://blog.mtianyan.cn/post/507fe3bf.html" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>请博主吃包辣条</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/images/wechatpay.png" alt="mtianyan 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/images/alipay.jpg" alt="mtianyan 支付宝"><p>支付宝</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a><a href="/tags/Django/" rel="tag"><i class="fa fa-tag"></i> Django</a><a href="/tags/在线教育平台/" rel="tag"><i class="fa fa-tag"></i> 在线教育平台</a></div><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/post/56d4b4c2.html" rel="next" title="强力Django+杀手级Xadmin打造在线教育平台(四)"><i class="fa fa-chevron-left"></i> 强力Django+杀手级Xadmin打造在线教育平台(四)</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/post/c970abcd.html" rel="prev" title="强力Django+杀手级Xadmin打造在线教育平台(六)">强力Django+杀手级Xadmin打造在线教育平台(六)<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"> <span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=2154292" charset="utf-8"></script></div></div></div><div class="comments" id="comments"><div id="SOHUCS"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="mtianyan"><p class="site-author-name" itemprop="name">mtianyan</p><p class="site-description motion-element" itemprop="description">爱分享，爱技术，爱生活。</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">37</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">23</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/mtianyan" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://www.jianshu.com/u/db9a7a0daa1f" target="_blank" title="简书"><i class="fa fa-fw fa-book"></i> 简书</a></span><span class="links-of-author-item"><a href="https://plus.google.com/u/0/114963812195952881148" target="_blank" title="Google"><i class="fa fa-fw fa-google"></i> Google</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://mtianyan.gitee.io/" title="本站孪生站(国内码云托管)" target="_blank">本站孪生站(国内码云托管)</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#django-admin介绍"><span class="nav-number">1.</span> <span class="nav-text">django admin介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#createsuperuser"><span class="nav-number">1.1.</span> <span class="nav-text">createsuperuser</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改setting中对应语言，时区，以及数据库写入时间。"><span class="nav-number">1.2.</span> <span class="nav-text">修改setting中对应语言，时区，以及数据库写入时间。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注册UserProfile进来"><span class="nav-number">1.3.</span> <span class="nav-text">注册UserProfile进来</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xadmin的安装"><span class="nav-number">2.</span> <span class="nav-text">xadmin的安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Python3-amp-Django2-0-1安装官方适配Django2-0的包"><span class="nav-number">2.1.</span> <span class="nav-text">Python3 &amp; Django2.0.1安装官方适配Django2.0的包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注册Xadmin-与-crispy-forms"><span class="nav-number">2.2.</span> <span class="nav-text">注册Xadmin 与 crispy-forms</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#源码安装："><span class="nav-number">2.3.</span> <span class="nav-text">源码安装：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Python3版本源码安装-与url配置不同"><span class="nav-number">2.3.1.</span> <span class="nav-text">Python3版本源码安装:与url配置不同</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#新建extra-apps，并在setting中注册地址"><span class="nav-number">2.4.</span> <span class="nav-text">新建extra_apps，并在setting中注册地址</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#users-app-的model注册"><span class="nav-number">3.</span> <span class="nav-text">users app 的model注册</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#遗留问题-django2-0-1使用xadmin时。如验证码等带dateTimefield区域出错。"><span class="nav-number">3.1.</span> <span class="nav-text">遗留问题: django2.0.1使用xadmin时。如验证码等带dateTimefield区域出错。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#真正开始"><span class="nav-number">3.2.</span> <span class="nav-text">真正开始</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#新建py文件的初始化模板"><span class="nav-number">3.3.</span> <span class="nav-text">新建py文件的初始化模板</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#解决后台部分英文显示"><span class="nav-number">3.3.1.</span> <span class="nav-text">解决后台部分英文显示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#解决EmailVerifyRecord-object显示"><span class="nav-number">3.3.2.</span> <span class="nav-text">解决EmailVerifyRecord object显示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置显示列"><span class="nav-number">3.3.3.</span> <span class="nav-text">配置显示列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置搜索searchfield"><span class="nav-number">3.3.4.</span> <span class="nav-text">配置搜索searchfield</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#xadmin导出csv中文乱码解决"><span class="nav-number">3.3.5.</span> <span class="nav-text">xadmin导出csv中文乱码解决</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#xadmin导出xml报错"><span class="nav-number">3.3.6.</span> <span class="nav-text">xadmin导出xml报错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#通过时间筛选字段。"><span class="nav-number">3.3.7.</span> <span class="nav-text">通过时间筛选字段。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Django的admin-Xadmin和其他系统区别"><span class="nav-number">3.4.</span> <span class="nav-text">Django的admin, Xadmin和其他系统区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#user-models的注册"><span class="nav-number">3.5.</span> <span class="nav-text">user/models的注册</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#剩余app-model注册"><span class="nav-number">4.</span> <span class="nav-text">剩余app model注册</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#courses注册"><span class="nav-number">4.1.</span> <span class="nav-text">courses注册</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注册机构app的adminx"><span class="nav-number">4.2.</span> <span class="nav-text">注册机构app的adminx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#operation-app注册xadmin"><span class="nav-number">4.3.</span> <span class="nav-text">operation app注册xadmin</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xadmin全局配置"><span class="nav-number">5.</span> <span class="nav-text">xadmin全局配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Xadmin的主题功能。"><span class="nav-number">5.1.</span> <span class="nav-text">使用Xadmin的主题功能。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解决django1-9-python2-下Xadmin主题不生效问题。"><span class="nav-number">5.2.</span> <span class="nav-text">解决django1.9(python2)下Xadmin主题不生效问题。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改django-admin-和下面的我的公司收起菜单"><span class="nav-number">5.3.</span> <span class="nav-text">修改django admin 和下面的我的公司收起菜单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#apps-py配置app的显示名称"><span class="nav-number">5.4.</span> <span class="nav-text">apps.py配置app的显示名称</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义导航菜单顺序"><span class="nav-number">5.5.</span> <span class="nav-text">自定义导航菜单顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#日志记录的使用"><span class="nav-number">5.6.</span> <span class="nav-text">日志记录的使用</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">mtianyan</span><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共182.8k字</span></div></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script> <span class="site-uv">本站访客数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人次</span> <span class="site-pv">本站总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script><script type="text/javascript">!function(){var t="1eb79150519fd9b791c77e8eef6f3632";if((window.innerWidth||document.documentElement.clientWidth)<960)window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=cyrJmJ3rL&conf='+t+'"><\/script>');else{!function(t,e){var n=document.getElementsByTagName("head")[0]||document.head||document.documentElement,a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("charset","UTF-8"),a.setAttribute("src",t),"function"==typeof e&&(window.attachEvent?a.onreadystatechange=function(){var t=a.readyState;"loaded"!==t&&"complete"!==t||(a.onreadystatechange=null,e())}:a.onload=e),n.appendChild(a)}("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:"cyrJmJ3rL",conf:t})})}}()</script><script type="text/javascript" src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script><script type="text/javascript">var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")};function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){var r=!1,s=0,a=0,i=n.title.trim(),c=i.toLowerCase(),l=n.content.trim().replace(/<[^>]+>/g,""),h=l.toLowerCase(),p=decodeURIComponent(n.url),u=[],f=[];if(""!=i&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}u=u.concat(e(t,c,!1)),f=f.concat(e(t,h,!1))}),(u.length>0||f.length>0)&&(r=!0,s=u.length+f.length)),r){[u,f].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});function d(e,o,n,r){for(var s=r[r.length-1],i=s.position,c=s.word,l=[],h=0;i+c.length<=n&&0!=r.length;){c===t&&h++,l.push({position:i,length:c.length});var p=i+c.length;for(r.pop();0!=r.length&&(i=(s=r[r.length-1]).position,c=s.word,p>i);)r.pop()}return a+=h,{hits:l,start:o,end:n,searchTextCount:h}}var g=[];0!=u.length&&g.push(d(0,0,i.length,u));for(var v=[];0!=f.length;){var $=f[f.length-1],C=$.position,m=$.word,x=C-20,w=C+80;x<0&&(x=0),w<C+m.length&&(w=C+m.length),w>l.length&&(w=l.length),v.push(d(0,x,w,f))}v.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var y=parseInt("1");y>=0&&(v=v.slice(0,y));function T(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var b="";0!=g.length?b+="<li><a href='"+p+"' class='search-result-title'>"+T(i,g[0])+"</a>":b+="<li><a href='"+p+"' class='search-result-title'>"+i+"</a>",v.forEach(function(t){b+="<a href='"+p+'\'><p class="search-result">'+T(l,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:a,hitCount:s,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("2uqmIjYredIvFy6tEXbKG4Fj-gzGzoHsz","CWl1rE8cQlIseOg2Cq3hzxYi")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0!==e.length){for(var i=0;i<e.length;i++){var s=e[i],r=s.get("url"),l=s.get("time"),c=document.getElementById(r);$(c).find(t).text(l)}for(i=0;i<n.length;i++){r=n[i],c=document.getElementById(r);var u=$(c).find(t);""==u.text()&&u.text(0)}}else o.find(t).text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var s=new e,r=new AV.ACL;r.setPublicReadAccess(!0),r.setPublicWriteAccess(!0),s.setACL(r),s.set("title",o),s.set("url",n),s.set("time",1),s.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={},pbOptions.iconStyle="default",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={},flOptions.iconStyle="default",flOptions.boxForm="horizontal",flOptions.position="middleRight",flOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-float",flOptions)</script><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script><script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><div id="hexo-helper-live2d"><canvas id="live2dcanvas" width="150" height="300"></canvas></div><style>#live2dcanvas{position:fixed;width:150px;height:300px;opacity:.7;right:-30px;z-index:999;pointer-events:none;bottom:40px}</style><script type="text/javascript" src="/live2d/device.min.js"></script><script type="text/javascript">
const loadScript = function loadScript(c,b){var a=document.createElement("script");a.type="text/javascript";"undefined"!=typeof b&&(a.readyState?a.onreadystatechange=function(){if("loaded"==a.readyState||"complete"==a.readyState)a.onreadystatechange=null,b()}:a.onload=function(){b()});a.src=c;document.body.appendChild(a)};
(function(){
  if((typeof(device) != 'undefined') && (device.mobile())){
    var trElement = document.getElementById('hexo-helper-live2d');
    trElement.parentNode.removeChild(trElement);
    return;
  }else
    if (typeof(device) === 'undefined') console.error('Cannot find current-device script.');
  loadScript("/live2d/script.js", function(){loadlive2d("live2dcanvas", "/live2d/assets/hijiki.model.json", 0.5);});
})();
</script></body></html><script type="text/javascript" src="/js/src/love.js"></script>