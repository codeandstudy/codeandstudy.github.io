<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script></script><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3"><link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222"><meta name="keywords" content="爬虫,搜索引擎,Scrapy,Python,Django,ElasticSearch,"><link rel="alternate" href="/atom.xml" title="mtianyan's blog" type="application/atom+xml"><meta name="description" content="请问您今天要来个引擎吗？ 打好基础好上路学习  最终项目上线演示地址: http://search.mtianyan.cn  第三节：我们搞搞基础知识，可谓爬虫居家必备基础。Github地址: https://github.com/mtianyan/ArticleSpider"><meta name="keywords" content="爬虫,搜索引擎,Scrapy,Python,Django,ElasticSearch"><meta property="og:type" content="article"><meta property="og:title" content="2018.2最新-Scrapy+elasticSearch+Django打造搜索引擎(三)"><meta property="og:url" content="http://blog.mtianyan.cn/post/855680b2.html"><meta property="og:site_name" content="mtianyan&#39;s blog"><meta property="og:description" content="请问您今天要来个引擎吗？ 打好基础好上路学习  最终项目上线演示地址: http://search.mtianyan.cn  第三节：我们搞搞基础知识，可谓爬虫居家必备基础。Github地址: https://github.com/mtianyan/ArticleSpider"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180117/H8bebf1CmK.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180117/7HB135kB60.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180117/Lh08c5F83h.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180117/0g1DgADH7c.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180117/36E2fEIGk0.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180117/IleD7g92Ej.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180117/k8IK9LIgmk.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180117/hIkchGf4cB.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180117/17KmkDlFf9.png?imageslim"><meta property="og:updated_time" content="2018-02-02T12:40:13.952Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="2018.2最新-Scrapy+elasticSearch+Django打造搜索引擎(三)"><meta name="twitter:description" content="请问您今天要来个引擎吗？ 打好基础好上路学习  最终项目上线演示地址: http://search.mtianyan.cn  第三节：我们搞搞基础知识，可谓爬虫居家必备基础。Github地址: https://github.com/mtianyan/ArticleSpider"><meta name="twitter:image" content="http://myphoto.mtianyan.cn/blog/180117/H8bebf1CmK.png?imageslim"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.3",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://blog.mtianyan.cn/post/855680b2.html"><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement("script"),n=t.getElementsByTagName("script")[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,0,("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/0f81ff2f.js","daovoice"),daovoice("init",{app_id:"e28768be"}),daovoice("update")</script><title>2018.2最新-Scrapy+elasticSearch+Django打造搜索引擎(三) | mtianyan's blog</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?415372bd35fec36f7558dd96b48ec03f";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/mtianyan" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">mtianyan's blog</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">天涯明月笙的博客小站(Github托管)</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br> 公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://blog.mtianyan.cn/post/855680b2.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="mtianyan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="mtianyan's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">2018.2最新-Scrapy+elasticSearch+Django打造搜索引擎(三)</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-02T20:36:40+08:00">2018-02-02</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Scrapy分布式爬虫打造搜索引擎/" itemprop="url" rel="index"><span itemprop="name">Scrapy分布式爬虫打造搜索引擎</span></a></span></span> <span id="/post/855680b2.html" class="leancloud_visitors" data-flag-title="2018.2最新-Scrapy+elasticSearch+Django打造搜索引擎(三)"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">热度&#58;</span><span class="leancloud-visitors-count"></span> <span>℃</span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">2,876</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">11</span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote class="blockquote-center"><p>请问您今天要来个引擎吗？ 打好基础好上路学习</p></blockquote><div class="note warning"><p>最终项目上线演示地址: <a href="http://search.mtianyan.cn" target="_blank" rel="noopener">http://search.mtianyan.cn</a></p><ul><li>第三节：我们搞搞基础知识，可谓爬虫居家必备基础。<br>Github地址: <a href="https://github.com/mtianyan/ArticleSpider" target="_blank" rel="noopener">https://github.com/mtianyan/ArticleSpider</a></li></ul></div><a id="more"></a><h1 id="爬虫基础知识"><a href="#爬虫基础知识" class="headerlink" title="爬虫基础知识"></a>爬虫基础知识</h1><ol><li>正则表达式</li><li>深度优先和广度优先遍历算法</li><li>url去重的常见策略</li></ol><h2 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h2><p><strong>scrapy vs requests+beautifulsoup</strong></p><ul><li>requests和beautifulsoup都只是库，scrapy是框架。</li><li>scrapy 可以加入requests和beautifulsoup</li><li>scrapy基于twisted(异步IO框架)，性能好</li><li>方便扩展,有很多内置功能</li><li>内置的<code>css</code>和<code>xpath selector</code>(lxml:c实现的框架)很方便，速度快</li></ul><blockquote><p>beautifulsoup最大的缺点就是慢。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install scrapy</span><br></pre></td></tr></table></figure><p>Failed building wheel for Twisted</p><p><a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#twisted" target="_blank" rel="noopener">http://www.lfd.uci.edu/~gohlke/pythonlibs/#twisted</a> 本地安装</p><h3 id="网页分类"><a href="#网页分类" class="headerlink" title="网页分类"></a>网页分类</h3><ol><li>静态网页</li><li>动态页面</li><li>webservice(restful api): 前台通过ajax与后台进行交互</li></ol><h3 id="爬虫能做什么？"><a href="#爬虫能做什么？" class="headerlink" title="爬虫能做什么？"></a>爬虫能做什么？</h3><ol><li>搜索引擎：百度 垂直领域搜索引擎(只爬某领域)</li><li>推荐引擎：今日头条</li><li>机器学习的数据样本</li><li>数据分析(金融数据分析) 舆情分析</li></ol><h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><p>为什么必须会正则表达式？</p><p>应用场景: <code>1天前</code>中提取出<code>1</code></p><h3 id="特殊字符"><a href="#特殊字符" class="headerlink" title="特殊字符:"></a>特殊字符:</h3><blockquote><p>可以判断是否匹配模式，字符串中提取指定字符</p></blockquote><ul><li><code>^</code>：代表以该字符为开头。如<code>^b</code>就是b为开头。</li><li><code>.</code>: 代表任意一个字符。如<code>^b.</code>就是b开头后面一个字母任意</li><li><code>*</code>: 代表前一个字符可以出现任意次（0个也可以）。如<code>^b.*</code>就是b开头后面可有任意数个任意字母</li><li><code>$</code>: 代表前一个字符为结尾符合。 如:<code>.*3$</code>就是以3为结尾的任意字符串</li><li><code>?</code>： 在限定次数词后加一个”?”，则表示匹配尽可能少的字符: 非贪婪匹配。<ul><li>一般情况从右往左匹配正则，非贪婪遇到符合最小条件就返回。</li><li><code>?</code>可以实现从左往右，非贪婪指遇到第一个就结束。<br><code>.*?(b.*?b).*</code>就是首先开始的b和找到的第一个b之间的字符串，不向后贪婪。</li></ul></li></ul><h3 id="Example-Code"><a href="#Example-Code" class="headerlink" title="Example Code"></a>Example Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line">__author__ = <span class="string">'mtianyan'</span></span><br><span class="line">__date__ = <span class="string">'2018/1/17 0017 16:20'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">line1 = <span class="string">"mtianyan123"</span></span><br><span class="line">line2 = <span class="string">"moooommtianyan123"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义正则表达式的字符串模式</span></span><br><span class="line"><span class="comment"># ^m代表以m开头；.代表任意字符；* 代表前面字符可以重复任意遍</span></span><br><span class="line"><span class="comment"># 3$代表以3为结尾</span></span><br><span class="line">regex_str1 = <span class="string">"^m.*3$"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 两个参数: 定义的字符串，以及我们要检验的字符串</span></span><br><span class="line"><span class="keyword">if</span> re.match(regex_str1, line1):</span><br><span class="line">    print(<span class="string">"yes"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认为贪婪模式: 反向由字符串模式从右向左匹配</span></span><br><span class="line"><span class="comment"># m前面无所谓啥，m和后一个m中间无所谓啥。后面也无所谓有啥。目标:moooom</span></span><br><span class="line"><span class="comment"># 括号括起来我们需要的字符串.也就是只提取这一部分。</span></span><br><span class="line">regex_str2 = <span class="string">".*(m.*m).*"</span></span><br><span class="line">match_obj = re.match(regex_str2, line2)</span><br><span class="line"><span class="keyword">if</span> match_obj:</span><br><span class="line">    <span class="comment"># 只取第一个括号东西。</span></span><br><span class="line">    <span class="keyword">print</span> (match_obj.group(<span class="number">1</span>))</span><br><span class="line"><span class="comment"># mm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用?使他从左边开始但是右边还是贪婪模式匹配。从右匹配到右起第一个</span></span><br><span class="line">regex_str3 = <span class="string">".*?(m.*m).*"</span></span><br><span class="line">match_obj = re.match(regex_str3, line2)</span><br><span class="line"><span class="keyword">if</span> match_obj:</span><br><span class="line">    <span class="comment"># 只取第一个括号东西。</span></span><br><span class="line">    <span class="keyword">print</span> (match_obj.group(<span class="number">1</span>))</span><br><span class="line"><span class="comment"># moooomm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用?使他从左边开始但是右边还是贪婪模式匹配。</span></span><br><span class="line"><span class="comment"># 在第二个m前也加问号。让它从左起开始。找这样的条件的b，不要继续向后贪婪</span></span><br><span class="line">regex_str4 = <span class="string">".*?(m.*?m).*"</span></span><br><span class="line">match_obj = re.match(regex_str4, line2)</span><br><span class="line"><span class="keyword">if</span> match_obj:</span><br><span class="line">    <span class="comment"># 只取第一个括号东西。</span></span><br><span class="line">    <span class="keyword">print</span> (match_obj.group(<span class="number">1</span>))</span><br><span class="line"><span class="comment"># moooom</span></span><br></pre></td></tr></table></figure><blockquote><ul><li>两个问号都不加: 默认从右开始找匹配模式的字符，找到即返回。</li><li>加前面一个问号: 从左开始，但是会一直贪婪到最长的符合字符。因为后面m还是从右开始的。</li><li>后面加一个问号: 第二个字符从左开始找。</li><li>两个问号都加：从左开始找字符m 和 m</li></ul></blockquote><ul><li><code>+</code>: 代表前面的字符至少出现一次: 如<code>b.+b</code>指两个b之间至少一个字符</li></ul><blockquote><p><code>+</code> 与<code>*</code> 与<code>{2}</code>都属于限定词限定前面出现多少次</p></blockquote><ul><li><code>{2}</code> <code>{2,5}</code> <code>{2, }</code>:<ul><li>代表前面的字符出现2次。</li><li>代表前面的字符出现2到5次.</li><li>代表前面字符出现2次及两次以上</li></ul></li><li><code>|</code>：代表<code>或</code>的意思 <code>b|c</code>，在模式字符串从左到右, 看先匹配到那个。先找b</li><li><code>()</code>: 代表子字符串。如((a|b)123)代表group(1)为外层括号里的a123|b123；group(2)为内层括号值 <code>a</code> <code>b</code></li><li><code>[]</code>: 代表[]内的字符满足任意一个都可以。<ul><li>[abcdefg]123代表以abcdefg中一个字母开头的,后面是123的都可以。</li></ul></li><li><code>[0-9]</code> <code>[a-z]</code><ul><li>代表可以为0-9范围内任意一个字符</li><li>代表a-z范围任意一个字符</li></ul></li><li><code>[^1]</code> <code>^</code>为取反，只要不等于1就可以</li></ul><blockquote><p>注: 进入[]的字符都不再具有特殊含义<code>[.*]</code>就指匹配到<code>.</code>或者<code>*</code></p></blockquote><ul><li><code>\s</code> <code>\S</code><ul><li><code>\s</code>代表匹配到一个空格。</li><li><code>\S</code>代表匹配到一个非空格</li></ul></li><li><code>\w</code> <code>\W</code><ul><li>匹配任意字符 等价: [a-zA-Z0-9_]</li><li>非单词字符</li></ul></li><li><code>[\u4E00-\u9FA5]</code>: 匹配中文汉字</li></ul><blockquote><p><code>&quot;study in 浙江大学&quot;</code> 匹配regex_str = <code>.*?[\u4E00-\u9FA5]+大学</code></p></blockquote><p>如果不加问号。则从右开始，只会匹配到江大学</p><ul><li><code>\d</code>: 匹配数字</li></ul><p>例子: <code>&quot;xxx出生于2001年&quot;</code> 匹配<code>.*?(\d+)年</code></p><blockquote><p>不加?会只匹配到1.因为它从右往左找第一个符合条件的。</p><ul><li>加上问号，从左往右，找到符合条件的。</li></ul></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line"></span><br><span class="line">line = &quot;XXX出生于2001年&quot;</span><br><span class="line"># line = &quot;XXX出生于2001/6/1&quot;</span><br><span class="line"># line = &quot;XXX出生于2001-6-1&quot;</span><br><span class="line"># line = &quot;XXX出生于2001-06-01&quot;</span><br><span class="line"># line = &quot;XXX出生于2001-06&quot;</span><br><span class="line"></span><br><span class="line">regex_str = &quot;.*出生于(\d&#123;4&#125;[年/-]\d&#123;1,2&#125;([月/-]\d&#123;1,2&#125;日|[月/-]\d&#123;1,2&#125;|[月/-]$|$))&quot;</span><br><span class="line"></span><br><span class="line">match_obj = re.match(regex_str, line)</span><br><span class="line">if match_obj:</span><br><span class="line">    print (match_obj.group(1))</span><br></pre></td></tr></table></figure><blockquote><p><code>([月/-]\d{1,2}日|[月/-]\d{1,2}|[月/-]$|$)</code>满足或的关系</p></blockquote><h2 id="深度优先和广度优先"><a href="#深度优先和广度优先" class="headerlink" title="深度优先和广度优先"></a>深度优先和广度优先</h2><ol><li>网站的树结构</li><li>深度优先算法和实现</li><li>广度优先算法和实现</li></ol><p>网站url树结构:</p><p>分层设计</p><blockquote><p>子域名：</p><ol><li>jobbole.com<br> 1.1 blog.bogbole.com<br> 1.2 python.bogbole.com<pre><code>1.1.1 python.bogbole.com/123
</code></pre></li></ol></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180117/H8bebf1CmK.png?imageslim" alt="mark"></p><p>上图为网站的实际url结构图,可以看到其中的环路链接:</p><blockquote><p>从首页到某个具体页面节点。<br>但是下面的链接节点又会有链接指向首页</p></blockquote><h3 id="去重-建立已爬取url列表"><a href="#去重-建立已爬取url列表" class="headerlink" title="去重, 建立已爬取url列表"></a>去重, 建立已爬取url列表</h3><ol><li>深度优先</li><li>广度优先</li></ol><blockquote><p>跳过已爬取的链接, 对于二叉树的遍历问题</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180117/7HB135kB60.png?imageslim" alt="mark"></p><p>深度优先(递归实现)：</p><blockquote><p>顺着一条路，走到最深处。然后回头。</p></blockquote><p>输出: A-&gt;B-&gt;D-&gt;E-&gt;I-&gt;C-&gt;F-&gt;G-H (scrapy默认使用)</p><p>广度优先(队列实现):</p><blockquote><p>分层遍历：遍历完儿子辈。然后遍历孙子辈</p></blockquote><p>输出: A-&gt;B-&gt;C-&gt;D-&gt;E-&gt;F-&gt;G-&gt;H-&gt;I</p><p>Python实现深度优先过程code:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">depth_tree</span><span class="params">(tree_node)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> tree_node <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">print</span> (tree_node._data)</span><br><span class="line">        <span class="keyword">if</span> tree_node._left <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> depth_tree(tree_node.left)</span><br><span class="line">        <span class="keyword">if</span> tree_node._right <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> depth_tree(tree_node,_right)</span><br></pre></td></tr></table></figure><p>递归太深没有跳出，会造成内存溢出。</p><p>Python实现广度优先过程code：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">level_queue</span><span class="params">(root)</span>:</span></span><br><span class="line">    <span class="comment">#利用队列实现树的广度优先遍历</span></span><br><span class="line">    <span class="keyword">if</span> root <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    my_queue = []</span><br><span class="line">    node = root</span><br><span class="line">    my_queue.append(node)</span><br><span class="line">    <span class="keyword">while</span> my_queue:</span><br><span class="line">        node = my_queue.pop(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">print</span> (node.elem)</span><br><span class="line">        <span class="keyword">if</span> node.lchild <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            my_queue.append(node.lchild)</span><br><span class="line">        <span class="keyword">if</span> node.rchild <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            my_queue.append(node.rchild)</span><br></pre></td></tr></table></figure><h2 id="爬虫去重策略"><a href="#爬虫去重策略" class="headerlink" title="爬虫去重策略"></a>爬虫去重策略</h2><ol><li>将访问过的url保存到<code>数据库</code>中,获取url时查询一下是否爬过了。</li><li>将url保存到<code>set</code>中。只需要<code>O(1)</code>的代价就可以查询到url</li><li>url经过<code>md5</code>等方法哈希后保存到set中，将<code>url压缩到固定长度</code>而且<code>不重复</code></li><li>用<code>bitmap</code>方法，将访问过的url通过<code>hash函数</code>映射到某一位.</li><li><code>bloomfilter</code>方法对bitmap进行改进，多重hash函数降低冲突可能性。</li></ol><blockquote><blockquote><p>方法2保守估计:<code>100000000*2byte*50</code>个字符/1024/1024/1024 = 9G,占用内存过大。</p></blockquote></blockquote><p>scrapy去重使用的是第三种方法:</p><blockquote><p>后面分布式scrapy-redis会讲解bloomfilter方法。hash函数会引起冲突，冲突解决。</p></blockquote><h2 id="Python字符串编码问题解决："><a href="#Python字符串编码问题解决：" class="headerlink" title="Python字符串编码问题解决："></a>Python字符串编码问题解决：</h2><ol><li>计算机只能处理数字，文本转换为数字才能处理，计算机中8个bit作为一个字节，<br>所以一个字节能表示的最大数字就是255。</li><li>计算机是美国人发明的，所以一个字节就可以标识所有单个字符<br>，所以ASCII(一个字节)编码就成为美国人的标准编码</li><li>但是ASCII处理中文明显不够，中文不止255个汉字，所以中国制定了GB2312编码<br>，用两个字节表示一个汉字。GB2312将ASCII也包含进去了。同理，日文，韩文，越来越多的国家为了解决这个问题就都发展了一套编码，标准越来越多，如果出现多种语言混合显示就一定会出现乱码</li><li>于是unicode出现了，通过16个bit, 32个bit.它将所有语言包含进去了。</li><li>看一下ASCII和unicode编码:<ul><li>字母A用ASCII编码十进制是65，二进制 0100 0001</li><li>汉字”中” 已近超出ASCII编码的范围，用unicode编码是20013二进制是01001110 00101101</li><li>A用unicode编码只需要前面补0二进制是 00000000 0100 0001</li></ul></li><li>乱码问题解决了，但是如果内容全是英文，unicode编码比ASCII编码需要多一倍的存储空间，传输也会变慢。</li><li>所以此时出现了可变长的编码”utf-8” ,把英文：1字节，汉字3字节，特别生僻的变成4-6字节，如果传输大量的英文，utf8作用就很明显。</li></ol><blockquote><p>Unicode编码虽然占用空间但是因为占用空间大小等额，在内存中处理会简单一些。</p></blockquote><p><strong>读取文件，进行操作时:转换为unicode编码进行处理</strong><br><strong>保存文件时，转换为utf-8编码。以便于传输</strong></p><p><img src="http://myphoto.mtianyan.cn/blog/180117/Lh08c5F83h.png?imageslim" alt="mark"></p><p>读文件进行decode(解码)操作转码为Unicode，但是decode必须指明原始编码方式。<br>Unicode编码 encode(编码) 操作转码为其他我们指定编码格式。</p><p>读文件的库都会自动将文件转换为Unicode编码，但需要我们指明编码。</p><p>Python3中将所有字符转换为Unicode。</p><p><strong>python2 默认编码格式为<code>ASCII</code>，Python3 默认编码为 <code>utf-8</code></strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.getdefaultencoding()</span><br><span class="line">s.encoding(<span class="string">'utf-8'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python2</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.getdefaultencoding()</span><br><span class="line">s = <span class="string">"我和你"</span></span><br><span class="line">su = <span class="string">u"我和你"</span></span><br><span class="line">~~s.encode(<span class="string">"utf-8"</span>)<span class="comment">#会报错~~</span></span><br><span class="line">s.decode(<span class="string">"gb2312"</span>).encode(<span class="string">"utf-8"</span>)</span><br><span class="line">su.encode(<span class="string">"utf-8"</span>)</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180117/0g1DgADH7c.png?imageslim" alt="mark"></p><blockquote><p>内存中是通过Unicode进行编码的, s 是一个非Unicode的编码。windows下是gb2312编码。Linux下是utf-8的编码。</p></blockquote><p>encode方法之前，必须确保前面的变量是Unicode。</p><p><img src="http://myphoto.mtianyan.cn/blog/180117/36E2fEIGk0.png?imageslim" alt="mark"></p><p>说明windows中s确实是gb2312保存的，而且decode方法并不会直接改变字符串本身。而是返回一个编码过后的字符串。</p><p><img src="http://myphoto.mtianyan.cn/blog/180117/IleD7g92Ej.png?imageslim" alt="mark"></p><p>说明Linux中s是以utf-8保存的。encode编码之前必须走中间路径: 转换为Unicode</p><p><img src="http://myphoto.mtianyan.cn/blog/180117/k8IK9LIgmk.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180117/hIkchGf4cB.png?imageslim" alt="mark"></p><p>可以看到windows和Linux的默认编码格式都是ascii、</p><p>Python2文件头添加utf-8编码说明。可以使得读文件的解释器指定decode的参数。<br>Python3已经不用加了，因为它把默认的s取消掉了。直接将字符串全部当unicode处理。<br>可以直接编码。</p><p><img src="http://myphoto.mtianyan.cn/blog/180117/17KmkDlFf9.png?imageslim" alt="mark"></p><p>可以看到windows,Linux中Python3的默认编码为utf-8.</p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/post/855680b2.html">2018.2最新-Scrapy+elasticSearch+Django打造搜索引擎(三)</a></p><p><span>文章作者:</span><a href="/" title="访问 mtianyan 的个人博客">mtianyan</a></p><p><span>发布时间:</span>2018年02月02日 - 20:02</p><p><span>最后更新:</span>2018年02月02日 - 20:02</p><p><span>原始链接:</span><a href="/post/855680b2.html" title="2018.2最新-Scrapy+elasticSearch+Django打造搜索引擎(三)">http://blog.mtianyan.cn/post/855680b2.html</a><span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://blog.mtianyan.cn/post/855680b2.html" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>请博主吃包辣条</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/images/wechatpay.png" alt="mtianyan 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/images/alipay.jpg" alt="mtianyan 支付宝"><p>支付宝</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/爬虫/" rel="tag"><i class="fa fa-tag"></i> 爬虫</a><a href="/tags/搜索引擎/" rel="tag"><i class="fa fa-tag"></i> 搜索引擎</a><a href="/tags/Scrapy/" rel="tag"><i class="fa fa-tag"></i> Scrapy</a><a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a><a href="/tags/Django/" rel="tag"><i class="fa fa-tag"></i> Django</a><a href="/tags/ElasticSearch/" rel="tag"><i class="fa fa-tag"></i> ElasticSearch</a></div><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/post/fba5a099.html" rel="next" title="2018.2最新-Scrapy+elasticSearch+Django打造搜索引擎(二)"><i class="fa fa-chevron-left"></i> 2018.2最新-Scrapy+elasticSearch+Django打造搜索引擎(二)</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"> <span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=2154292" charset="utf-8"></script></div></div></div><div class="comments" id="comments"><div id="SOHUCS"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="mtianyan"><p class="site-author-name" itemprop="name">mtianyan</p><p class="site-description motion-element" itemprop="description">爱分享，爱技术，爱生活。</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">37</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">23</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/mtianyan" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://www.jianshu.com/u/db9a7a0daa1f" target="_blank" title="简书"><i class="fa fa-fw fa-book"></i> 简书</a></span><span class="links-of-author-item"><a href="https://plus.google.com/u/0/114963812195952881148" target="_blank" title="Google"><i class="fa fa-fw fa-google"></i> Google</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://mtianyan.gitee.io/" title="本站孪生站(国内码云托管)" target="_blank">本站孪生站(国内码云托管)</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#爬虫基础知识"><span class="nav-number">1.</span> <span class="nav-text">爬虫基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#技术选型"><span class="nav-number">1.1.</span> <span class="nav-text">技术选型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#网页分类"><span class="nav-number">1.1.1.</span> <span class="nav-text">网页分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#爬虫能做什么？"><span class="nav-number">1.1.2.</span> <span class="nav-text">爬虫能做什么？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#正则表达式"><span class="nav-number">1.2.</span> <span class="nav-text">正则表达式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#特殊字符"><span class="nav-number">1.2.1.</span> <span class="nav-text">特殊字符:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Example-Code"><span class="nav-number">1.2.2.</span> <span class="nav-text">Example Code</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#深度优先和广度优先"><span class="nav-number">1.3.</span> <span class="nav-text">深度优先和广度优先</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#去重-建立已爬取url列表"><span class="nav-number">1.3.1.</span> <span class="nav-text">去重, 建立已爬取url列表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#爬虫去重策略"><span class="nav-number">1.4.</span> <span class="nav-text">爬虫去重策略</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python字符串编码问题解决："><span class="nav-number">1.5.</span> <span class="nav-text">Python字符串编码问题解决：</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">mtianyan</span><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共182.8k字</span></div></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script> <span class="site-uv">本站访客数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人次</span> <span class="site-pv">本站总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script><script type="text/javascript">!function(){var t="1eb79150519fd9b791c77e8eef6f3632";if((window.innerWidth||document.documentElement.clientWidth)<960)window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=cyrJmJ3rL&conf='+t+'"><\/script>');else{!function(t,e){var n=document.getElementsByTagName("head")[0]||document.head||document.documentElement,a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("charset","UTF-8"),a.setAttribute("src",t),"function"==typeof e&&(window.attachEvent?a.onreadystatechange=function(){var t=a.readyState;"loaded"!==t&&"complete"!==t||(a.onreadystatechange=null,e())}:a.onload=e),n.appendChild(a)}("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:"cyrJmJ3rL",conf:t})})}}()</script><script type="text/javascript" src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script><script type="text/javascript">var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")};function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){var r=!1,s=0,a=0,i=n.title.trim(),c=i.toLowerCase(),l=n.content.trim().replace(/<[^>]+>/g,""),h=l.toLowerCase(),p=decodeURIComponent(n.url),u=[],f=[];if(""!=i&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}u=u.concat(e(t,c,!1)),f=f.concat(e(t,h,!1))}),(u.length>0||f.length>0)&&(r=!0,s=u.length+f.length)),r){[u,f].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});function d(e,o,n,r){for(var s=r[r.length-1],i=s.position,c=s.word,l=[],h=0;i+c.length<=n&&0!=r.length;){c===t&&h++,l.push({position:i,length:c.length});var p=i+c.length;for(r.pop();0!=r.length&&(i=(s=r[r.length-1]).position,c=s.word,p>i);)r.pop()}return a+=h,{hits:l,start:o,end:n,searchTextCount:h}}var g=[];0!=u.length&&g.push(d(0,0,i.length,u));for(var v=[];0!=f.length;){var $=f[f.length-1],C=$.position,m=$.word,x=C-20,w=C+80;x<0&&(x=0),w<C+m.length&&(w=C+m.length),w>l.length&&(w=l.length),v.push(d(0,x,w,f))}v.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var y=parseInt("1");y>=0&&(v=v.slice(0,y));function T(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var b="";0!=g.length?b+="<li><a href='"+p+"' class='search-result-title'>"+T(i,g[0])+"</a>":b+="<li><a href='"+p+"' class='search-result-title'>"+i+"</a>",v.forEach(function(t){b+="<a href='"+p+'\'><p class="search-result">'+T(l,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:a,hitCount:s,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("2uqmIjYredIvFy6tEXbKG4Fj-gzGzoHsz","CWl1rE8cQlIseOg2Cq3hzxYi")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0!==e.length){for(var i=0;i<e.length;i++){var s=e[i],r=s.get("url"),l=s.get("time"),c=document.getElementById(r);$(c).find(t).text(l)}for(i=0;i<n.length;i++){r=n[i],c=document.getElementById(r);var u=$(c).find(t);""==u.text()&&u.text(0)}}else o.find(t).text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var s=new e,r=new AV.ACL;r.setPublicReadAccess(!0),r.setPublicWriteAccess(!0),s.setACL(r),s.set("title",o),s.set("url",n),s.set("time",1),s.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={},pbOptions.iconStyle="default",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={},flOptions.iconStyle="default",flOptions.boxForm="horizontal",flOptions.position="middleRight",flOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-float",flOptions)</script><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script><script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><div id="hexo-helper-live2d"><canvas id="live2dcanvas" width="150" height="300"></canvas></div><style>#live2dcanvas{position:fixed;width:150px;height:300px;opacity:.7;right:-30px;z-index:999;pointer-events:none;bottom:40px}</style><script type="text/javascript" src="/live2d/device.min.js"></script><script type="text/javascript">
const loadScript = function loadScript(c,b){var a=document.createElement("script");a.type="text/javascript";"undefined"!=typeof b&&(a.readyState?a.onreadystatechange=function(){if("loaded"==a.readyState||"complete"==a.readyState)a.onreadystatechange=null,b()}:a.onload=function(){b()});a.src=c;document.body.appendChild(a)};
(function(){
  if((typeof(device) != 'undefined') && (device.mobile())){
    var trElement = document.getElementById('hexo-helper-live2d');
    trElement.parentNode.removeChild(trElement);
    return;
  }else
    if (typeof(device) === 'undefined') console.error('Cannot find current-device script.');
  loadScript("/live2d/script.js", function(){loadlive2d("live2dcanvas", "/live2d/assets/hijiki.model.json", 0.5);});
})();
</script></body></html><script type="text/javascript" src="/js/src/love.js"></script>