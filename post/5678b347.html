<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script></script><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3"><link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222"><meta name="keywords" content="Python,Django,在线教育平台,"><link rel="alternate" href="/atom.xml" title="mtianyan's blog" type="application/atom+xml"><meta name="description" content="在绝望中寻找希望，人生终将辉煌 - 新东方   作为一个正经的教育网站，我们更是拥有正规的机构合作: 比如来自火星的星星优培。  完成授课机构的功能实现，"><meta name="keywords" content="Python,Django,在线教育平台"><meta property="og:type" content="article"><meta property="og:title" content="强力Django+杀手级Xadmin打造在线教育平台(七)"><meta property="og:url" content="http://blog.mtianyan.cn/post/5678b347.html"><meta property="og:site_name" content="mtianyan&#39;s blog"><meta property="og:description" content="在绝望中寻找希望，人生终将辉煌 - 新东方   作为一个正经的教育网站，我们更是拥有正规的机构合作: 比如来自火星的星星优培。  完成授课机构的功能实现，"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/Idbj8d04h5.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/4gb7aiICk7.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/3e96fGcGma.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/14mBAlhH8D.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/bBjf5DBLh2.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/IekmEbK9A8.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/hbhi9lBah2.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/9AL06C2hjh.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/BL8G2CkmGl.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/emCCcfGcEd.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/7KKbaGb97i.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/D5hBDAjHeA.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/CJG79b8JJ5.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/325Id7l954.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/EG198BJgi3.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/I4A16CDal5.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/lFLGKIH5fE.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/C6B1Hb7LKD.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/amEhg6kFbf.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/LcIB9jeKem.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/hg5g6Cc7f0.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/8D6a8Dl3h3.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/k1DG3bflLH.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/L7d5cE3D7h.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/6ejHjBFb9c.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/H0Gjeci29F.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/E18ecbCEEI.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/c2kA33KE9E.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/cKmHj6E9gi.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/cA22hF4fi7.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/8KAAL61KBk.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/jadkKHKkbI.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/fcae2A0E0c.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/8gcmfdHb4J.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/DmC94JAmh3.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/jIL4FAdjJb.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/59iFhGLaCD.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/aiKJL6kCKL.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/mmChH6l2j9.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/GJa43hh95F.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/Fgl4eHGJb8.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/me43dl1f0g.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/BiKdf066CL.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/dbFlbHIBmb.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/DJeKIb9cK1.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/cH5Dmm14Cj.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/FkaCFJ4B7h.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/BeIFlkf97m.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/DFHg4mGkFb.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/k09CHekje2.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/BBI8iLE97D.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/ECJ36kDclf.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/4j037g1DKj.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/90m2l2A0Dj.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/0ED5bcC9Jf.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/I83bFbddC3.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/mL08LkChhe.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/cLg8IFB1jA.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/G2ICdgdDgh.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/b7heml49dh.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/5gjFji2d25.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/Kd5ijhIAgK.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/3CFjke2B3C.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/2AdFE6He3D.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/4f7A1Ei2Fg.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/c8aa7f62L1.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/KelfeB7D2C.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/DI3GJKkJLI.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180112/3gBdC96Aij.png?imageslim"><meta property="og:updated_time" content="2018-02-02T12:40:13.960Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="强力Django+杀手级Xadmin打造在线教育平台(七)"><meta name="twitter:description" content="在绝望中寻找希望，人生终将辉煌 - 新东方   作为一个正经的教育网站，我们更是拥有正规的机构合作: 比如来自火星的星星优培。  完成授课机构的功能实现，"><meta name="twitter:image" content="http://myphoto.mtianyan.cn/blog/180111/Idbj8d04h5.png?imageslim"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.3",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://blog.mtianyan.cn/post/5678b347.html"><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement("script"),n=t.getElementsByTagName("script")[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,0,("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/0f81ff2f.js","daovoice"),daovoice("init",{app_id:"e28768be"}),daovoice("update")</script><title>强力Django+杀手级Xadmin打造在线教育平台(七) | mtianyan's blog</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?415372bd35fec36f7558dd96b48ec03f";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/mtianyan" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">mtianyan's blog</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">天涯明月笙的博客小站(Github托管)</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br> 公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://blog.mtianyan.cn/post/5678b347.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="mtianyan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="mtianyan's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">强力Django+杀手级Xadmin打造在线教育平台(七)</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-12T22:09:17+08:00">2018-01-12</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Django-Xadmin打造在线教育平台/" itemprop="url" rel="index"><span itemprop="name">Django+Xadmin打造在线教育平台</span></a></span></span> <span id="/post/5678b347.html" class="leancloud_visitors" data-flag-title="强力Django+杀手级Xadmin打造在线教育平台(七)"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">热度&#58;</span><span class="leancloud-visitors-count"></span> <span>℃</span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">5,292</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">23</span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote class="blockquote-center"><p>在绝望中寻找希望，人生终将辉煌 - 新东方</p></blockquote><div class="note default"><p>作为一个正经的教育网站，我们更是拥有正规的机构合作: 比如来自火星的星星优培。</p><ul><li>完成授课机构的功能实现，</li></ul></div><a id="more"></a><h2 id="7-1-django-templates模板继承1"><a href="#7-1-django-templates模板继承1" class="headerlink" title="7-1 django templates模板继承1"></a>7-1 django templates模板继承1</h2><ul><li>机构可以筛选类别</li><li>机构可以根据所在地区进行分类</li></ul><p>右侧我要学习功能: form表单提交<br>右下：授课机构排名</p><p>页面头部与底部为全局头和全局底部。</p><h3 id="Django-template-共用头部底部机制"><a href="#Django-template-共用头部底部机制" class="headerlink" title="Django template 共用头部底部机制"></a>Django template 共用头部底部机制</h3><p>将head和foot放在两个html中，然后在写其他需要这两个部分的页面时include进来。</p><p>Django也是支持include机制的。</p><h3 id="include的问题"><a href="#include的问题" class="headerlink" title="include的问题"></a>include的问题</h3><p>include的进来的死页面，这时候该怎么办？</p><p>解决这种问题：进行模板的继承机制。定义一个父类的框架，子类可以替换其中一部分block，子类只需要重写自己需要改变的block。</p><h3 id="template中新建base-html"><a href="#template中新建base-html" class="headerlink" title="template中新建base.html"></a>template中新建base.html</h3><p>将课程机构列表页。orglist拷贝进template目录</p><p>将orglist内容替换base内容。</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/Idbj8d04h5.png?imageslim" alt="mark"></p><p>将div收起来</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/4gb7aiICk7.png?imageslim" alt="mark"></p><p>loadstaticfiles &amp; 修改静态文件路径为static</p><blockquote><p>这个步骤做过太多遍了，自行完成。耐心就行了。</p></blockquote><h3 id="定义父模板-包含head-amp-footer"><a href="#定义父模板-包含head-amp-footer" class="headerlink" title="定义父模板: 包含head &amp; footer"></a>定义父模板: 包含head &amp; footer</h3><p>title应该是可以被子页面替换的所以要包起来。</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/3e96fGcGma.png?imageslim" alt="mark"></p><p>css有共用的部分，也有可以被子页面替换的部分。</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/14mBAlhH8D.png?imageslim" alt="mark"></p><p>js同理</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/bBjf5DBLh2.png?imageslim" alt="mark"></p><p>面包屑是需要被各个页面自己替换的。</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/IekmEbK9A8.png?imageslim" alt="mark"></p><p>将正文内容包起来；</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/hbhi9lBah2.png?imageslim" alt="mark"></p><p>此时base页面就制作好了</p><h2 id="7-2-开始orglist编写"><a href="#7-2-开始orglist编写" class="headerlink" title="7-2 开始orglist编写"></a>7-2 开始orglist编写</h2><p>第一步:清空所有内容</p><ul><li>继承base页面</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180111/9AL06C2hjh.png?imageslim" alt="mark"></p><ul><li>覆盖父类的title</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180111/BL8G2CkmGl.png?imageslim" alt="mark"></p><ul><li>书写课程机构view<br>organization/views.py</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># encoding: utf-8</span><br><span class="line">from django.views.generic.base import View</span><br><span class="line"># 处理课程机构列表的view</span><br><span class="line">class OrgView(View):</span><br><span class="line">    def get(self,request):</span><br><span class="line">        return render(request, &quot;org-list.html&quot;, &#123; &#125;)</span><br></pre></td></tr></table></figure><ul><li>Django2.0.1配置课程机构首页url</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 课程机构首页url</span><br><span class="line">path(&apos;org_list/&apos;, OrgView.as_view(), name=&quot;org_list&quot;),</span><br></pre></td></tr></table></figure><ul><li>Django1.9.8配置url：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 课程机构首页url</span><br><span class="line">url(r&apos;^org_list/$&apos;, OrgView.as_view(), name=&quot;org_list&quot;),</span><br></pre></td></tr></table></figure><h3 id="修改面包屑"><a href="#修改面包屑" class="headerlink" title="修改面包屑"></a>修改面包屑</h3><ul><li>base中只保留首页</li><li>org中重写block custom_bread</li><li><p>block之间没有先后顺序。</p></li><li><p>将base中block content拿到orglist重写</p></li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180111/emCCcfGcEd.png?imageslim" alt="mark"></p><ul><li>然后将base中block中间section删除掉</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180111/7KKbaGb97i.png?imageslim" alt="mark"></p><blockquote><p>orglist开始loadstaticfiles</p></blockquote><p><code>ctrl+d</code>快速删除</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/D5hBDAjHeA.png?imageslim" alt="mark"></p><p>页面的继承关系使得变量也可以直接用</p><blockquote><p>比如user中的form数据传递到register文件当中.如果register继承的是base页面。<br>base页面当中也是可以用这些数据的。<code>参数的向上传递</code></p></blockquote><p>每个request对象都会传递到html中来，如果继承了base，request也会向上传递到base。<br>base中就可以加入我们的逻辑: 用户是否登录等。</p><p>小节结束对应commit:</p><blockquote><p>完成Django templates的继承关系了解，机构列表展示页。对应7-1 &amp; 2</p></blockquote><h2 id="7-3-课程机构列表页数据展示1"><a href="#7-3-课程机构列表页数据展示1" class="headerlink" title="7-3 课程机构列表页数据展示1"></a>7-3 课程机构列表页数据展示1</h2><p>确定由后台传过来的动态数据:</p><p>授课机构列表本身， 授课机构的排名，所在地区(后台取出所有地区), 机构类别写成静态，因为一般不怎么变动。</p><p>在xadmin中添加城市信息，课程信息。</p><p>添加城市</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/CJG79b8JJ5.png?imageslim" alt="mark"></p><p>添加机构。</p><p>插播知识点：</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/325Id7l954.png?imageslim" alt="mark"></p><p>这里指定的路径是一个相对路径</p><p>setting中要配置我们把文件存放在哪个根目录之下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 设置我们上传文件的路径</span><br><span class="line"></span><br><span class="line">MEDIA_URL = &apos;/media/&apos;</span><br><span class="line">MEDIA_ROOT = os.path.join(BASE_DIR, &apos;media&apos;)</span><br></pre></td></tr></table></figure><p>在项目根目录创建media文件夹</p><p>在后台上传图片</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/EG198BJgi3.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180111/I4A16CDal5.png?imageslim" alt="mark"></p><p>修改机构信息中封面图为logo</p><p>自行添加十个课程机构</p><h3 id="models中添加机构类别"><a href="#models中添加机构类别" class="headerlink" title="models中添加机构类别"></a>models中添加机构类别</h3><p>organization/models.py：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseOrg</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    ORG_CHOICES =(</span><br><span class="line">        (<span class="string">"pxjg"</span>, <span class="string">u"培训机构"</span>),</span><br><span class="line">        (<span class="string">"gx"</span>, <span class="string">u"高校"</span>),</span><br><span class="line">        (<span class="string">"gr"</span>, <span class="string">u"个人"</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    name = models.CharField(max_length=<span class="number">50</span>, verbose_name=<span class="string">u"机构名称"</span>)</span><br><span class="line">    <span class="comment"># 机构描述，后面会替换为富文本展示</span></span><br><span class="line">    desc = models.TextField(verbose_name=<span class="string">u"机构描述"</span>)</span><br><span class="line">    <span class="comment"># 机构类别:</span></span><br><span class="line">    category = models.CharField(max_length=<span class="number">20</span>, choices=ORG_CHOICES, verbose_name=<span class="string">u"机构类别"</span>, default=<span class="string">"pxjg"</span>)</span><br></pre></td></tr></table></figure><p>修改了models之后做数据库的变动:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makemigrations organization</span><br><span class="line">migrate organization</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180111/lFLGKIH5fE.png?imageslim" alt="mark"></p><p>完成之后打开Navicat进行验证：</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/C6B1Hb7LKD.png?imageslim" alt="mark"></p><p>可以看到新增了。</p><h3 id="完善我们的view"><a href="#完善我们的view" class="headerlink" title="完善我们的view"></a>完善我们的view</h3><p>将列表里的静态数据变成后台获取的动态数据</p><p>organization/views.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> CourseOrg, CityDict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrgView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="comment"># 查找到所有的课程机构</span></span><br><span class="line">        all_orgs = CourseOrg.objects.all()</span><br><span class="line">        <span class="comment"># 取出所有的城市</span></span><br><span class="line">        all_citys = CityDict.objects.all()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">"org-list.html"</span>, &#123;</span><br><span class="line">            <span class="string">"all_orgs"</span>:all_orgs,</span><br><span class="line">            <span class="string">"all_citys"</span>: all_citys,</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><h2 id="7-4-课程机构列表页数据展示2"><a href="#7-4-课程机构列表页数据展示2" class="headerlink" title="7-4 课程机构列表页数据展示2"></a>7-4 课程机构列表页数据展示2</h2><h3 id="前去html中进行数据填充"><a href="#前去html中进行数据填充" class="headerlink" title="前去html中进行数据填充"></a>前去html中进行数据填充</h3><p><img src="http://myphoto.mtianyan.cn/blog/180111/amEhg6kFbf.png?imageslim" alt="mark"></p><blockquote><p>可以看到所有城市是通过a标签，当前选中城市为active。</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180111/LcIB9jeKem.png?imageslim" alt="mark"></p><p>之后把下面的写死的城市删除掉。</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/hg5g6Cc7f0.png?imageslim" alt="mark"></p><p>这时就是我们在后台添加的数据了</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/8D6a8Dl3h3.png?imageslim" alt="mark"></p><p>可以看到每个课程机构都是一个dl</p><p>同理使用for循环。</p><h3 id="如何将imageField转换为图片地址"><a href="#如何将imageField转换为图片地址" class="headerlink" title="如何将imageField转换为图片地址"></a>如何将imageField转换为图片地址</h3><p>数据库中img存放的是字符串：相对路径</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/k1DG3bflLH.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180111/L7d5cE3D7h.png?imageslim" alt="mark"></p><p>上图这种取法会取出一个相对地址。</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/6ejHjBFb9c.png?imageslim" alt="mark"></p><p>将setting中配置的mediaurl放在前面可以补全地址。</p><h3 id="设置media处理器"><a href="#设置media处理器" class="headerlink" title="设置media处理器"></a>设置media处理器</h3><p><img src="http://myphoto.mtianyan.cn/blog/180111/H0Gjeci29F.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180111/E18ecbCEEI.png?imageslim" alt="mark"></p><blockquote><p>注册之后，mediaurl将可以在html中使用</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180111/c2kA33KE9E.png?imageslim" alt="mark"></p><p>图片还是没有显示。因为url中没有处理图片相应路径的url</p><p>Django1.9.8 urls.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.static <span class="keyword">import</span> serve</span><br><span class="line">    <span class="comment"># 处理图片显示的url,使用Django自带serve,传入参数告诉它去哪个路径找，我们有配置好的路径MEDIAROOT</span></span><br><span class="line">    url(<span class="string">r'^media/(?P&lt;path&gt;.*)$'</span>, serve, &#123;<span class="string">"document_root"</span>: MEDIA_ROOT &#125;)</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180111/cKmHj6E9gi.png?imageslim" alt="mark"></p><p>Django2.0.1 urls.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.static <span class="keyword">import</span> serve</span><br><span class="line"><span class="comment"># 处理图片显示的url,使用Django自带serve,传入参数告诉它去哪个路径找，我们有配置好的路径MEDIAROOT</span></span><br><span class="line">    re_path(<span class="string">r'^media/(?P&lt;path&gt;.*)'</span>, serve, &#123;<span class="string">"document_root"</span>: MEDIA_ROOT &#125;)</span><br></pre></td></tr></table></figure><h3 id="完善xadmin的adminx为机构添加分类索引字段"><a href="#完善xadmin的adminx为机构添加分类索引字段" class="headerlink" title="完善xadmin的adminx为机构添加分类索引字段"></a>完善xadmin的adminx为机构添加分类索引字段</h3><p>organization/adminx.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 机构课程信息管理器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseOrgAdmin</span><span class="params">(object)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'name'</span>, <span class="string">'desc'</span>,<span class="string">'category'</span>, <span class="string">'click_nums'</span>, <span class="string">'fav_nums'</span>,<span class="string">'add_time'</span> ]</span><br><span class="line">    search_fields = [<span class="string">'name'</span>, <span class="string">'desc'</span>, <span class="string">'category'</span>,<span class="string">'click_nums'</span>, <span class="string">'fav_nums'</span>]</span><br><span class="line">    list_filter = [<span class="string">'name'</span>, <span class="string">'desc'</span>,<span class="string">'category'</span> ,<span class="string">'click_nums'</span>, <span class="string">'fav_nums'</span>,<span class="string">'city__name'</span>,<span class="string">'address'</span>,<span class="string">'add_time'</span>]</span><br></pre></td></tr></table></figure><h3 id="去除加载小圈圈"><a href="#去除加载小圈圈" class="headerlink" title="去除加载小圈圈"></a>去除加载小圈圈</h3><p>static/css/style.css中scrollLoading置为空:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.scrollLoading &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>完成后台数据添加，列表页数据展示。对应7-3&amp;7-4</p></blockquote><h2 id="7-5-列表分页功能"><a href="#7-5-列表分页功能" class="headerlink" title="7-5 列表分页功能"></a>7-5 列表分页功能</h2><p>github搜索django-pure-pagination</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-pure-pagination</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180111/cA22hF4fi7.png?imageslim" alt="mark"></p><p>install app中添加:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'pure_pagination'</span>,</span><br></pre></td></tr></table></figure><p>可设置参数；</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PAGINATION_SETTINGS = &#123;</span><br><span class="line">    &apos;PAGE_RANGE_DISPLAYED&apos;: 10,</span><br><span class="line">    &apos;MARGIN_PAGES_DISPLAYED&apos;: 2,</span><br><span class="line">    &apos;SHOW_FIRST_PAGE_WHEN_INVALID&apos;: True,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180111/8KAAL61KBk.png?imageslim" alt="mark"></p><p><code>PAGE_RANGE_DISPLAYED</code>是总共会显示多少个page。(包括省略号，包括两边和中间)<br><code>MARGIN_PAGES_DISPLAYED</code>是旁边会显示多少个。<br><code>SHOW_FIRST_PAGE_WHEN_INVALID</code>:当输入页数不合法是否要跳到第一页</p><p>官方实例；</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render_to_response</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pure_pagination <span class="keyword">import</span> Paginator, EmptyPage, PageNotAnInteger</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 尝试获取页数参数</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        page = request.GET.get(<span class="string">'page'</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> PageNotAnInteger:</span><br><span class="line">        page = <span class="number">1</span></span><br><span class="line">    <span class="comment"># objects是取到的数据</span></span><br><span class="line">    objects = [<span class="string">'john'</span>, <span class="string">'edward'</span>, <span class="string">'josh'</span>, <span class="string">'frank'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Provide Paginator with the request object for complete querystring generation</span></span><br><span class="line">    <span class="comment"># 对于取到的数据进行分页处理。</span></span><br><span class="line">    p = Paginator(objects, request=request)</span><br><span class="line">    <span class="comment"># 此时前台显示的就应该是我们此时获取的第几页的数据</span></span><br><span class="line">    people = p.page(page)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_to_response(<span class="string">'index.html'</span>, &#123;</span><br><span class="line">        <span class="string">'people'</span>: people,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>我们对照着的实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pure_pagination <span class="keyword">import</span> Paginator, EmptyPage, PageNotAnInteger</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrgView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="comment"># 查找到所有的课程机构</span></span><br><span class="line">        all_orgs = CourseOrg.objects.all()</span><br><span class="line">        <span class="comment"># 总共有多少家机构使用count进行统计</span></span><br><span class="line">        org_nums = all_orgs.count()</span><br><span class="line">        <span class="comment"># 取出所有的城市</span></span><br><span class="line">        all_city = CityDict.objects.all()</span><br><span class="line">        <span class="comment"># 对课程机构进行分页</span></span><br><span class="line">        <span class="comment"># 尝试获取前台get请求传递过来的page参数</span></span><br><span class="line">        <span class="comment"># 如果是不合法的配置参数默认返回第一页</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            page = request.GET.get(<span class="string">'page'</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> PageNotAnInteger:</span><br><span class="line">            page = <span class="number">1</span></span><br><span class="line">        <span class="comment"># 这里指从allorg中取五个出来，每页显示5个</span></span><br><span class="line">        p = Paginator(all_orgs, <span class="number">5</span>, request=request)</span><br><span class="line">        orgs = p.page(page)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">"org-list.html"</span>, &#123;</span><br><span class="line">            <span class="string">"all_orgs"</span>:orgs,</span><br><span class="line">            <span class="string">"all_city"</span>: all_city,</span><br><span class="line">            <span class="string">"org_nums"</span>: org_nums,</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><h3 id="对于html中分页进行配置"><a href="#对于html中分页进行配置" class="headerlink" title="对于html中分页进行配置"></a>对于html中分页进行配置</h3><blockquote><p>不再是objects，而是objectlist</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180111/jadkKHKkbI.png?imageslim" alt="mark"></p><blockquote><p>使用默认的render<br><img src="http://myphoto.mtianyan.cn/blog/180111/fcae2A0E0c.png?imageslim" alt="mark"></p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180111/8gcmfdHb4J.png?imageslim" alt="mark"></p><h3 id="自定义html的样式"><a href="#自定义html的样式" class="headerlink" title="自定义html的样式"></a>自定义html的样式</h3><p><img src="http://myphoto.mtianyan.cn/blog/180112/DmC94JAmh3.png?imageslim" alt="mark"></p><p>本小节完成对应commit:</p><blockquote><p>7-3, 4 &amp; 5:完成列表数据展示列表分页功能：使用pure_pagination</p></blockquote><h2 id="7-6-分类筛选功能"><a href="#7-6-分类筛选功能" class="headerlink" title="7-6 分类筛选功能"></a>7-6 分类筛选功能</h2><p><img src="http://myphoto.mtianyan.cn/blog/180112/jIL4FAdjJb.png?imageslim" alt="mark"></p><p>当用户点击某一个city时对应加上参数city的id</p><h3 id="在后台处理这个city"><a href="#在后台处理这个city" class="headerlink" title="在后台处理这个city"></a>在后台处理这个city</h3><p><img src="http://myphoto.mtianyan.cn/blog/180112/59iFhGLaCD.png?imageslim" alt="mark"></p><p>获取传入的参数进行进一步筛选。</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/aiKJL6kCKL.png?imageslim" alt="mark"></p><blockquote><p>将city_id传回html，使得可以知道哪个是选中的。</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180112/mmChH6l2j9.png?imageslim" alt="mark"></p><p>因为city.id是后端传回来的值是一个int。所以我们要做类型转换。</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/GJa43hh95F.png?imageslim" alt="mark"></p><p>当city_id为空的时候，显示全部。</p><h3 id="后台处理类别"><a href="#后台处理类别" class="headerlink" title="后台处理类别"></a>后台处理类别</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 类别筛选</span><br><span class="line">      category = request.GET.get(&apos;ct&apos;, &quot;&quot;)</span><br><span class="line">      if category:</span><br><span class="line">          # 我们就在机构中作进一步筛选类别</span><br><span class="line">          all_orgs = all_orgs.filter(category=category)</span><br></pre></td></tr></table></figure><p>返回前台类别值以active</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">return render(request, &quot;org-list.html&quot;, &#123;</span><br><span class="line">          &quot;all_orgs&quot;:orgs,</span><br><span class="line">          &quot;all_city&quot;: all_city,</span><br><span class="line">          &quot;org_nums&quot;: org_nums,</span><br><span class="line">          &quot;city_id&quot;:city_id,</span><br><span class="line">          &quot;category&quot;:category,</span><br><span class="line">      &#125;)</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180112/Fgl4eHGJb8.png?imageslim" alt="mark"></p><p>对于类别做同样的ifequal判断</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/me43dl1f0g.png?imageslim" alt="mark"></p><p>如上图所示进行城市与分类的联动:</p><p>当选择全部类别的时候，就只通过当前城市id。<br>当选择全部城市的时候，就只通过当前目录id。<br>当两者都选的时候使用&amp;连接。</p><p>刚才统计机构数目过早，应该移到后面后面已经筛选过后，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 总共有多少家机构使用count进行统计</span><br><span class="line">       org_nums = all_orgs.count()</span><br></pre></td></tr></table></figure><h3 id="课程机构排名"><a href="#课程机构排名" class="headerlink" title="课程机构排名"></a>课程机构排名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 热门机构,如果不加负号会是有小到大。</span><br><span class="line">     hot_orgs = all_orgs.order_by(&quot;-click_nums&quot;)[:3]</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180112/BiKdf066CL.png?imageslim" alt="mark"></p><p>循环时内置变量forloop.counter取当前循环到第几次</p><p>待完成:点击排名机构的连接</p><h3 id="课程机构排序。"><a href="#课程机构排序。" class="headerlink" title="课程机构排序。"></a>课程机构排序。</h3><p>学习人数，课程数</p><p>organization/models.py<br>CourseOrg</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当学生点击学习课程，找到所属机构，学习人数加1</span></span><br><span class="line">   students = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">u"学习人数"</span>)</span><br><span class="line">   <span class="comment"># 当发布课程就加1</span></span><br><span class="line">   course_nums =  models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">u"课程数"</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makemigrations organization</span><br><span class="line">migrate organization</span><br></pre></td></tr></table></figure><p>前端页面学习人数，添加参数sort</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/dbFlbHIBmb.png?imageslim" alt="mark"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进行排序</span></span><br><span class="line">       sort = request.GET.get(<span class="string">'sort'</span>, <span class="string">""</span>)</span><br><span class="line">       <span class="keyword">if</span> sort:</span><br><span class="line">           <span class="keyword">if</span> sort == <span class="string">"students"</span>:</span><br><span class="line">               all_orgs = all_orgs.order_by(<span class="string">"-students"</span>)</span><br><span class="line">           <span class="keyword">elif</span> sort == <span class="string">"courses"</span>:</span><br><span class="line">               all_orgs = all_orgs.order_by(<span class="string">"-course_nums"</span>)</span><br></pre></td></tr></table></figure><p>添加选择效果</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/DJeKIb9cK1.png?imageslim" alt="mark"></p><h2 id="7-7-modelform-提交我要学习咨询1"><a href="#7-7-modelform-提交我要学习咨询1" class="headerlink" title="7-7 modelform 提交我要学习咨询1"></a>7-7 modelform 提交我要学习咨询1</h2><p>对应表<code>userask</code></p><p><code>form</code>会对字段先做验证，然后保存到数据库中。</p><p>可以看到我们的forms和我们的model中有很多内容是一样的。我们如何让代码重复利用呢？</p><p>使用modelform解决这个问题。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> operation.models <span class="keyword">import</span> UserAsk</span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">'mtianyan'</span></span><br><span class="line">__date__ = <span class="string">'2018/1/12 0012 03:20'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 普通版本的form</span></span><br><span class="line"><span class="comment"># class UserAskForm(forms.Form):</span></span><br><span class="line"><span class="comment">#     name = forms.CharField(required=True, min_length=2, max_length=20)</span></span><br><span class="line"><span class="comment">#     phone = forms.CharField(required=True, max_length=11, min_length=11)</span></span><br><span class="line"><span class="comment">#     course_name = forms.CharField(required=True, min_length=5, max_length=50)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进阶版本的modelform：它可以向model一样save</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnotherUserForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">    <span class="comment"># 继承之余还可以新增字段</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 是由哪个model转换的</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = UserAsk</span><br><span class="line">        <span class="comment"># 我需要验证的字段</span></span><br><span class="line">        fields = [<span class="string">'name'</span>,<span class="string">'mobile'</span>,<span class="string">'course_name'</span>]</span><br></pre></td></tr></table></figure><h3 id="include的机制配置应用自己的url"><a href="#include的机制配置应用自己的url" class="headerlink" title="include的机制配置应用自己的url"></a>include的机制配置应用自己的url</h3><p>django1.9.8 创建organization/urls.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line">__author__ = <span class="string">'mtianyan'</span></span><br><span class="line">__date__ = <span class="string">'2018/1/12 0012 06:20'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">from</span> organization.views <span class="keyword">import</span> OrgView</span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 课程机构列表url</span></span><br><span class="line">    url(<span class="string">'list/&amp;'</span>, OrgView.as_view(), name=<span class="string">"org_list"</span>),</span><br></pre></td></tr></table></figure><p>django1.9.8 Mxonline2/urls.py:<br>删掉orglist,新增如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 课程机构app的url配置</span></span><br><span class="line">  url(<span class="string">r"^org/"</span>, include(<span class="string">'organization.urls'</span>,namespace=<span class="string">"org"</span>)),</span><br></pre></td></tr></table></figure><p>django2.0.1: 新建organization/urls.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">from</span> organization.views <span class="keyword">import</span> OrgView</span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">'mtianyan'</span></span><br><span class="line">__date__ = <span class="string">'2018/1/12 0012 03:28'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 课程机构列表url</span></span><br><span class="line">    path(<span class="string">'list/'</span>, OrgView.as_view(), name=<span class="string">"org_list"</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>django2.0.1: urls.py中:</p><p>删掉org_list，新增include</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 课程机构app的url配置</span><br><span class="line">path(&quot;org/&quot;, include(&apos;organization.urls&apos;,namespace=&quot;org&quot;)),</span><br></pre></td></tr></table></figure><p>使用命名空间防止重复</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/cH5Dmm14Cj.png?imageslim" alt="mark"></p><p>解决Django2.0.1报错:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   <span class="string">'Specifying a namespace in include() without providing an app_name '</span> </span><br><span class="line">django.core.exceptions.ImproperlyConfigured: Specifying a namespace <span class="keyword">in</span> </span><br><span class="line">include() without providing an app_name <span class="keyword">is</span> <span class="keyword">not</span> supported. Set the app_name </span><br><span class="line">attribute <span class="keyword">in</span> the included module, <span class="keyword">or</span> <span class="keyword">pass</span> a <span class="number">2</span>-tuple containing the list of </span><br><span class="line">patterns <span class="keyword">and</span> app_name instead.</span><br></pre></td></tr></table></figure><p>在自己的app下的urls中写上appname</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># encoding: utf-8</span><br><span class="line">from organization.views import OrgView</span><br><span class="line"></span><br><span class="line">__author__ = &apos;mtianyan&apos;</span><br><span class="line">__date__ = &apos;2018/1/12 0012 03:28&apos;</span><br><span class="line"></span><br><span class="line">from django.urls import path, re_path</span><br><span class="line"></span><br><span class="line">app_name = &quot;organization&quot;</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line"></span><br><span class="line">    # 课程机构列表url</span><br><span class="line">    path(&apos;list/&apos;, OrgView.as_view(), name=&quot;org_list&quot;),</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>html中使用命名空间方式:</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/FkaCFJ4B7h.png?imageslim" alt="mark"></p><h3 id="使用modelform做提交"><a href="#使用modelform做提交" class="headerlink" title="使用modelform做提交"></a>使用modelform做提交</h3><p>比较合理的操作是异步的，不会对整个页面进行刷新。<br>如果有错误，显示错误。一种ajax的异步操作。</p><p>因此我们此时不能直接render一个页面回来。<br>应该是给前端返回json数据，而不是页面</p><p><code>HttpResponse</code>类指明给用户返回哪种类型数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br></pre></td></tr></table></figure><p>配置一个modelform的view</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户添加我要学习</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddUserAskView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="comment"># 处理表单提交当然post</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        userask_form = UserAskForm(request.POST)</span><br><span class="line">        <span class="comment"># 判断该form是否有效</span></span><br><span class="line">        <span class="keyword">if</span> userask_form.is_valid():</span><br><span class="line">            <span class="comment"># 这里是modelform和form的区别</span></span><br><span class="line">            <span class="comment"># 它有model的属性</span></span><br><span class="line">            <span class="comment"># 当commit为true进行真正保存</span></span><br><span class="line">            user_ask = userask_form.save(commit=<span class="keyword">True</span>)</span><br><span class="line">            <span class="comment"># 这样就不需要把一个一个字段取出来然后存到model的对象中之后save</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 如果保存成功,返回json字符串,后面content type是告诉浏览器的,</span></span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">"&#123;'status': 'success'&#125;"</span>, content_type=<span class="string">'application/json'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果保存失败，返回json字符串,并将form的报错信息通过msg传递到前端</span></span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">"&#123;'status': 'fail', 'msg':&#123;0&#125;&#125;"</span>.format(userask_form.errors),  content_type=<span class="string">'application/json'</span>)</span><br></pre></td></tr></table></figure><h3 id="配置相应的url"><a href="#配置相应的url" class="headerlink" title="配置相应的url"></a>配置相应的url</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 添加我要学习</span><br><span class="line">path(&apos;add_ask/&apos;, AddUserAskView.as_view(), name=&quot;add_ask&quot;)</span><br></pre></td></tr></table></figure><h2 id="7-8-modelform-提交我要学习"><a href="#7-8-modelform-提交我要学习" class="headerlink" title="7-8 modelform 提交我要学习"></a>7-8 modelform 提交我要学习</h2><h3 id="分析ajax请求"><a href="#分析ajax请求" class="headerlink" title="分析ajax请求"></a>分析ajax请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $(function()&#123;</span><br><span class="line">        $(&apos;#jsStayBtn&apos;).on(&apos;click&apos;, function()&#123;</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                cache: false,</span><br><span class="line">                type: &quot;POST&quot;,</span><br><span class="line">  				url:&quot;&#123;% url &quot;org:add_ask&quot; %&#125;&quot;,</span><br><span class="line">                data:$(&apos;#jsStayForm&apos;).serialize(),</span><br><span class="line">                async: true,</span><br><span class="line">                success: function(data) &#123;</span><br><span class="line">                    if(data.status == &apos;success&apos;)&#123;</span><br><span class="line">                        $(&apos;#jsStayForm&apos;)[0].reset();</span><br><span class="line">                        alert(&quot;提交成功&quot;)</span><br><span class="line">                    &#125;else if(data.status == &apos;fail&apos;)&#123;</span><br><span class="line">                        $(&apos;#jsCompanyTips&apos;).html(data.msg)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p>监听这个button，用户如果点击了button。我们来向这个url进行post请求。<br>将我们的表单进行序列化。</p></blockquote><p>form表单添加crsf_token</p><p>如果后台返回的状态值为success，那么我们将弹出提交成功。<br>失败，就会在错误提示框中写入。</p><h3 id="手机号码正则表达式验证"><a href="#手机号码正则表达式验证" class="headerlink" title="手机号码正则表达式验证:"></a>手机号码正则表达式验证:</h3><p>organization/forms.py</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 手机号的正则表达式验证</span><br><span class="line">    def clean_mobile(self):</span><br><span class="line">        mobile = self.cleaned_data[&apos;mobile&apos;]</span><br><span class="line">        REGEX_MOBILE = &quot;^1[358]\d&#123;9&#125;$|^147\d&#123;8&#125;$|^176\d&#123;8&#125;$&quot;</span><br><span class="line">        p = re.compile(REGEX_MOBILE)</span><br><span class="line">        if p.match(mobile):</span><br><span class="line">            return mobile</span><br><span class="line">        else:</span><br><span class="line">            raise forms.ValidationError(u&quot;手机号码非法&quot;, code=&quot;mobile_invalid&quot;)</span><br></pre></td></tr></table></figure><p>本小节完毕对应提交commit:</p><blockquote><p>7-7&amp;8 使用modelform完成表单我要学习的异步提交</p></blockquote><h2 id="7-9-机构详情"><a href="#7-9-机构详情" class="headerlink" title="7-9 机构详情"></a>7-9 机构详情</h2><ul><li>机构首页</li><li>机构课程</li><li>机构介绍</li><li>机构讲师</li></ul><p>登录xadmin添加基础的必要数据。添加课程与讲师。</p><p>课程中应该有一个外键指向它是哪个机构的。</p><p>courses/models.py</p><p>Django1.9.8中:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> organization.models <span class="keyword">import</span> CourseOrg</span><br><span class="line"></span><br><span class="line">course_org = models.ForeignKey(CourseOrg, verbose_name=<span class="string">u"所属机构"</span>,null=<span class="keyword">True</span>,blank=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure><p>django2.0.1下；</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">course_org = models.ForeignKey(CourseOrg,on_delete=models.CASCADE, verbose_name=<span class="string">u"所属机构"</span>,null=<span class="keyword">True</span>,blank=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure><p>新增外键字段应该<code>null=true,blank=true。</code></p><blockquote><p>因为历史数据中没有这个外键字段</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makemigration course</span><br><span class="line">migrate course</span><br></pre></td></tr></table></figure><p>将前端给我们的org相关的四个页面拷进template</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/BeIFlkf97m.png?imageslim" alt="mark"></p><p>新建org_base页面</p><p>将org_home页面内容拿过去。</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/DFHg4mGkFb.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180112/k09CHekje2.png?imageslim" alt="mark"></p><ul><li>loadstaticfiles -&gt; 改css文件路径-&gt;改js文件路径-&gt;改图片路径</li><li>改已经实现的url。-&gt;将子页面继承后需要改得地方使用block包裹。</li></ul><p>将home页面清空</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/BBI8iLE97D.png?imageslim" alt="mark"></p><p>完成替换之后添加访问的view以及URl</p><p>organization/views.py:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class OrgHomeView(View):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">   机构首页</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    def get(self, request, org_id):</span><br><span class="line">        # 根据id取到课程机构</span><br><span class="line">        course_org = CourseOrg.objects.get(id= int(org_id))</span><br><span class="line">        # 通过课程机构找到课程。内建的变量，找到指向这个字段的外键引用</span><br><span class="line">        all_courses = course_org.course_set.all()[:4]</span><br><span class="line">        all_teacher = course_org.teacher_set.all()[:2]</span><br><span class="line"></span><br><span class="line">        return render(request, &apos;org-detail-homepage.html&apos;,&#123;</span><br><span class="line">           &apos;all_courses&apos;:all_courses,</span><br><span class="line">            &apos;all_teacher&apos;:all_teacher,</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><p>Django2.0.1下url</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   # home页面,取纯数字</span><br><span class="line">re_path(&apos;home/(?P&lt;org_id&gt;\d+)/&apos;, OrgHomeView.as_view(), name=&quot;org_home&quot;),</span><br></pre></td></tr></table></figure><p>django1.9.8下url:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># home页面,取纯数字</span><br><span class="line">url(r&apos;home/(?P&lt;org_id&gt;\d+)/$&apos;, OrgHomeView.as_view(), name=&quot;org_home&quot;)</span><br></pre></td></tr></table></figure><p>html中使用for循环遍历:</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/ECJ36kDclf.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180112/4j037g1DKj.png?imageslim" alt="mark"></p><blockquote><p>如上图可以直接通过外键字段再找到外键对象的字段</p></blockquote><p>templates/org-list.html</p><p>配置里面跳转到详情页的url</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/90m2l2A0Dj.png?imageslim" alt="mark"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> render(request, <span class="string">'org-detail-homepage.html'</span>,&#123;</span><br><span class="line">   <span class="string">'all_courses'</span>:all_courses,</span><br><span class="line">    <span class="string">'all_teacher'</span>:all_teacher,</span><br><span class="line">    <span class="string">'course_org'</span>: course_org,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>将<code>course_org</code>也return回来，就可以把网页里这部分值替换掉</p><p>templates/org_base.html</p><p>数值会随继承链向上传递。</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/0ED5bcC9Jf.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180112/I83bFbddC3.png?imageslim" alt="mark"></p><h3 id="为讲师增加头像字段"><a href="#为讲师增加头像字段" class="headerlink" title="为讲师增加头像字段"></a>为讲师增加头像字段</h3><p>organization/models.py</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">image = models.ImageField(</span><br><span class="line">    default= &apos;&apos;,</span><br><span class="line">    upload_to=&quot;teacher/%Y/%m&quot;,</span><br><span class="line">    verbose_name=u&quot;头像&quot;,</span><br><span class="line">    max_length=100)</span><br></pre></td></tr></table></figure><p>然后</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makemgration organization</span><br><span class="line">migrate organization</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180112/mL08LkChhe.png?imageslim" alt="mark"></p><p>使用for循环填充数据</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/cLg8IFB1jA.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180112/G2ICdgdDgh.png?imageslim" alt="mark"></p><p>同理可得，我们把机构课程页不同的部分拿出来即可</p><h3 id="配置访问的view和url"><a href="#配置访问的view和url" class="headerlink" title="配置访问的view和url"></a>配置访问的view和url</h3><p>organization/urls.py:</p><p>Django 2.0.1：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 访问课程</span><br><span class="line">re_path(&apos;course/(?P&lt;org_id&gt;\d+)/&apos;, OrgCourseView.as_view(), name=&quot;org_course&quot;),</span><br></pre></td></tr></table></figure><p>Django 1.9.8：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 访问课程</span><br><span class="line">url(r&apos;^course/(?P&lt;org_id&gt;\d+)/$&apos;, OrgCourseView.as_view(), name=&quot;org_course&quot;),</span><br></pre></td></tr></table></figure><p>organization/views.py<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class OrgCourseView(View):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">   机构课程列表页</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    def get(self, request, org_id):</span><br><span class="line">        # 根据id取到课程机构</span><br><span class="line">        course_org = CourseOrg.objects.get(id= int(org_id))</span><br><span class="line">        # 通过课程机构找到课程。内建的变量，找到指向这个字段的外键引用</span><br><span class="line">        all_courses = course_org.course_set.all()</span><br><span class="line"></span><br><span class="line">        return render(request, &apos;org-detail-course.html&apos;,&#123;</span><br><span class="line">           &apos;all_courses&apos;:all_courses,</span><br><span class="line">            &apos;course_org&apos;: course_org,</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><p></p><p>base页面的left链接修改</p><blockquote><p>这里能直接用到course_org.id。是因为子页面render时都向上传递了course_org对象</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180112/b7heml49dh.png?imageslim" alt="mark"></p><p>使用for循环，填充内容。</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/5gjFji2d25.png?imageslim" alt="mark"></p><h3 id="左侧active修改"><a href="#左侧active修改" class="headerlink" title="左侧active修改"></a>左侧active修改</h3><p>因为现在没有值能判断当前是哪个页面。所以在orghomeview中传值回来current page<br><img src="http://myphoto.mtianyan.cn/blog/180112/Kd5ijhIAgK.png?imageslim" alt="mark"><br><img src="http://myphoto.mtianyan.cn/blog/180112/3CFjke2B3C.png?imageslim" alt="mark"></p><p>写两个view</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">class OrgDescView(View):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">   机构描述详情页</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    def get(self, request, org_id):</span><br><span class="line">        # 向前端传值，表明现在在home页</span><br><span class="line">        current_page = &quot;desc&quot;</span><br><span class="line">        # 根据id取到课程机构</span><br><span class="line">        course_org = CourseOrg.objects.get(id= int(org_id))</span><br><span class="line">        # 通过课程机构找到课程。内建的变量，找到指向这个字段的外键引用</span><br><span class="line">        # 向前端传值说明用户是否收藏</span><br><span class="line">        has_fav = False</span><br><span class="line">        # 必须是用户已登录我们才需要判断。</span><br><span class="line">        if request.user.is_authenticated:</span><br><span class="line">            if UserFavorite.objects.filter(user=request.user, fav_id=course_org.id, fav_type=2):</span><br><span class="line">                has_fav = True</span><br><span class="line">        return render(request, &apos;org-detail-desc.html&apos;,&#123;</span><br><span class="line">            &apos;course_org&apos;: course_org,</span><br><span class="line">            &quot;current_page&quot;:current_page,</span><br><span class="line">            &quot;has_fav&quot;:has_fav,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">class OrgTeacherView(View):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">   机构讲师列表页</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    def get(self, request, org_id):</span><br><span class="line">        # 向前端传值，表明现在在home页</span><br><span class="line">        current_page = &quot;teacher&quot;</span><br><span class="line">        # 根据id取到课程机构</span><br><span class="line">        course_org = CourseOrg.objects.get(id= int(org_id))</span><br><span class="line">        # 通过课程机构找到课程。内建的变量，找到指向这个字段的外键引用</span><br><span class="line">        all_teachers = course_org.teacher_set.all()</span><br><span class="line">        # 向前端传值说明用户是否收藏</span><br><span class="line">        has_fav = False</span><br><span class="line">        # 必须是用户已登录我们才需要判断。</span><br><span class="line">        if request.user.is_authenticated:</span><br><span class="line">            if UserFavorite.objects.filter(user=request.user, fav_id=course_org.id, fav_type=2):</span><br><span class="line">                has_fav = True</span><br><span class="line">        return render(request, &apos;org-detail-teachers.html&apos;,&#123;</span><br><span class="line">           &apos;all_teachers&apos;:all_teachers,</span><br><span class="line">            &apos;course_org&apos;: course_org,</span><br><span class="line">            &quot;current_page&quot;:current_page,</span><br><span class="line">            &quot;has_fav&quot;:has_fav</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><p>加两个url</p><p>Django2.0.1下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 访问机构描述</span><br><span class="line">re_path(&apos;desc/(?P&lt;org_id&gt;\d+)/&apos;, OrgDescView.as_view(), name=&quot;org_desc&quot;),</span><br><span class="line"></span><br><span class="line"># 访问机构讲师</span><br><span class="line">re_path(&apos;teacher/(?P&lt;org_id&gt;\d+)/&apos;, OrgTeacherView.as_view(), name=&quot;org_teacher&quot;),</span><br></pre></td></tr></table></figure><p>Django1.9.8下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 访问机构描述</span><br><span class="line">url(r&apos;^desc/(?P&lt;org_id&gt;\d+)/$&apos;, OrgDescView.as_view(), name=&quot;org_desc&quot;),</span><br><span class="line"></span><br><span class="line"># 访问机构讲师</span><br><span class="line">url(r&apos;^teacher/(?P&lt;org_id&gt;\d+)/$&apos;, OrgTeacherView.as_view(), name=&quot;org_teacher&quot;),</span><br></pre></td></tr></table></figure><p>修改base页面相关跳转链接，注意点：加上course_org.id</p><p>重载我们的pagepath，使得面包屑动态显示</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/2AdFE6He3D.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180112/4f7A1Ei2Fg.png?imageslim" alt="mark"></p><h2 id="7-10-课程机构收藏功能"><a href="#7-10-课程机构收藏功能" class="headerlink" title="7-10 课程机构收藏功能"></a>7-10 课程机构收藏功能</h2><p>书写收藏的后台逻辑:</p><p>url配置</p><p>django2.0.1下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 机构收藏</span></span><br><span class="line">path(<span class="string">'add_fav/'</span>, AddFavView.as_view(), name=<span class="string">"add_fav"</span>),</span><br></pre></td></tr></table></figure><p>django1.9.8下；</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 机构收藏</span><br><span class="line">url(r&apos;^add_fav/$&apos;, AddFavView.as_view(), name=&quot;add_fav&quot;),</span><br></pre></td></tr></table></figure><p>配套的view；</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddFavView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    用户收藏与取消收藏功能</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="comment"># 表明你收藏的不管是课程，讲师，还是机构。他们的id</span></span><br><span class="line">        <span class="comment"># 默认值取0是因为空串转int报错</span></span><br><span class="line">        id = request.POST.get(<span class="string">'fav_id'</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="comment"># 取到你收藏的类别，从前台提交的ajax请求中取</span></span><br><span class="line">        type = request.POST.get(<span class="string">'fav_type'</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 收藏与已收藏取消收藏</span></span><br><span class="line">        <span class="comment"># 判断用户是否登录:即使没登录会有一个匿名的user</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> request.user.is_authenticated:</span><br><span class="line">            <span class="comment"># 未登录时返回json提示未登录，跳转到登录页面是在ajax中做的</span></span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">'&#123;"status":"fail", "msg":"用户未登录"&#125;'</span>, content_type=<span class="string">'application/json'</span>)</span><br><span class="line">        exist_records = UserFavorite.objects.filter(user=request.user, fav_id=int(id), fav_type=int(type))</span><br><span class="line">        <span class="keyword">if</span> exist_records:</span><br><span class="line">            <span class="comment"># 如果记录已经存在， 则表示用户取消收藏</span></span><br><span class="line">            exist_records.delete()</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">'&#123;"status":"success", "msg":"收藏"&#125;'</span>, content_type=<span class="string">'application/json'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            user_fav = UserFavorite()</span><br><span class="line">            <span class="comment"># 过滤掉未取到fav_id type的默认情况</span></span><br><span class="line">            <span class="keyword">if</span> int(type) &gt;<span class="number">0</span> <span class="keyword">and</span> int(id) &gt;<span class="number">0</span>:</span><br><span class="line">                user_fav.fav_id = int(id)</span><br><span class="line">                user_fav.fav_type = int(type)</span><br><span class="line">                user_fav.user = request.user</span><br><span class="line">                user_fav.save()</span><br><span class="line">                <span class="keyword">return</span> HttpResponse(<span class="string">'&#123;"status":"success", "msg":"已收藏"&#125;'</span>, content_type=<span class="string">'application/json'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> HttpResponse(<span class="string">'&#123;"status":"fail", "msg":"收藏出错"&#125;'</span>, content_type=<span class="string">'application/json'</span>)</span><br></pre></td></tr></table></figure><p>相关处理收藏的jQuery代码写在org base Html</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/c8aa7f62L1.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180112/KelfeB7D2C.png?imageslim" alt="mark"></p><p>添加返回页面的收藏值。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 向前端传值说明用户是否收藏</span><br><span class="line">       has_fav = False</span><br><span class="line">       # 必须是用户已登录我们才需要判断。</span><br><span class="line">       if request.user.is_authenticated:</span><br><span class="line">           if UserFavorite.objects.filter(user=request.user, fav_id=course_org.id, fav_type=2):</span><br><span class="line">               has_fav = True</span><br><span class="line"></span><br><span class="line"># return redener加上值</span><br><span class="line">            &quot;has_fav&quot;: has_fav</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180112/DI3GJKkJLI.png?imageslim" alt="mark"></p><p>前台 org_base.html中</p><p><img src="http://myphoto.mtianyan.cn/blog/180112/3gBdC96Aij.png?imageslim" alt="mark"></p><p>同理添加剩下的几个页面的。</p><p>第七章完结撒花。对应commit:</p><blockquote><p>7-9&amp;10&amp;11&amp;12将机构详情展示完毕，为课程机构添加了收藏功能。修复了index未登录状态下爆炸的错误</p></blockquote></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/post/5678b347.html">强力Django+杀手级Xadmin打造在线教育平台(七)</a></p><p><span>文章作者:</span><a href="/" title="访问 mtianyan 的个人博客">mtianyan</a></p><p><span>发布时间:</span>2018年01月12日 - 22:01</p><p><span>最后更新:</span>2018年02月02日 - 20:02</p><p><span>原始链接:</span><a href="/post/5678b347.html" title="强力Django+杀手级Xadmin打造在线教育平台(七)">http://blog.mtianyan.cn/post/5678b347.html</a><span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://blog.mtianyan.cn/post/5678b347.html" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>请博主吃包辣条</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/images/wechatpay.png" alt="mtianyan 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/images/alipay.jpg" alt="mtianyan 支付宝"><p>支付宝</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a><a href="/tags/Django/" rel="tag"><i class="fa fa-tag"></i> Django</a><a href="/tags/在线教育平台/" rel="tag"><i class="fa fa-tag"></i> 在线教育平台</a></div><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/post/c970abcd.html" rel="next" title="强力Django+杀手级Xadmin打造在线教育平台(六)"><i class="fa fa-chevron-left"></i> 强力Django+杀手级Xadmin打造在线教育平台(六)</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/post/9f2a0c4b.html" rel="prev" title="强力Django+杀手级Xadmin打造在线教育平台(八)">强力Django+杀手级Xadmin打造在线教育平台(八)<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"> <span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=2154292" charset="utf-8"></script></div></div></div><div class="comments" id="comments"><div id="SOHUCS"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="mtianyan"><p class="site-author-name" itemprop="name">mtianyan</p><p class="site-description motion-element" itemprop="description">爱分享，爱技术，爱生活。</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">37</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">23</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/mtianyan" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://www.jianshu.com/u/db9a7a0daa1f" target="_blank" title="简书"><i class="fa fa-fw fa-book"></i> 简书</a></span><span class="links-of-author-item"><a href="https://plus.google.com/u/0/114963812195952881148" target="_blank" title="Google"><i class="fa fa-fw fa-google"></i> Google</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://mtianyan.gitee.io/" title="本站孪生站(国内码云托管)" target="_blank">本站孪生站(国内码云托管)</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-django-templates模板继承1"><span class="nav-number">1.</span> <span class="nav-text">7-1 django templates模板继承1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Django-template-共用头部底部机制"><span class="nav-number">1.1.</span> <span class="nav-text">Django template 共用头部底部机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#include的问题"><span class="nav-number">1.2.</span> <span class="nav-text">include的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#template中新建base-html"><span class="nav-number">1.3.</span> <span class="nav-text">template中新建base.html</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义父模板-包含head-amp-footer"><span class="nav-number">1.4.</span> <span class="nav-text">定义父模板: 包含head &amp; footer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-开始orglist编写"><span class="nav-number">2.</span> <span class="nav-text">7-2 开始orglist编写</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#修改面包屑"><span class="nav-number">2.1.</span> <span class="nav-text">修改面包屑</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-课程机构列表页数据展示1"><span class="nav-number">3.</span> <span class="nav-text">7-3 课程机构列表页数据展示1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#models中添加机构类别"><span class="nav-number">3.1.</span> <span class="nav-text">models中添加机构类别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#完善我们的view"><span class="nav-number">3.2.</span> <span class="nav-text">完善我们的view</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-4-课程机构列表页数据展示2"><span class="nav-number">4.</span> <span class="nav-text">7-4 课程机构列表页数据展示2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#前去html中进行数据填充"><span class="nav-number">4.1.</span> <span class="nav-text">前去html中进行数据填充</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何将imageField转换为图片地址"><span class="nav-number">4.2.</span> <span class="nav-text">如何将imageField转换为图片地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置media处理器"><span class="nav-number">4.3.</span> <span class="nav-text">设置media处理器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#完善xadmin的adminx为机构添加分类索引字段"><span class="nav-number">4.4.</span> <span class="nav-text">完善xadmin的adminx为机构添加分类索引字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#去除加载小圈圈"><span class="nav-number">4.5.</span> <span class="nav-text">去除加载小圈圈</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-5-列表分页功能"><span class="nav-number">5.</span> <span class="nav-text">7-5 列表分页功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#对于html中分页进行配置"><span class="nav-number">5.1.</span> <span class="nav-text">对于html中分页进行配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义html的样式"><span class="nav-number">5.2.</span> <span class="nav-text">自定义html的样式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-6-分类筛选功能"><span class="nav-number">6.</span> <span class="nav-text">7-6 分类筛选功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#在后台处理这个city"><span class="nav-number">6.1.</span> <span class="nav-text">在后台处理这个city</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#后台处理类别"><span class="nav-number">6.2.</span> <span class="nav-text">后台处理类别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#课程机构排名"><span class="nav-number">6.3.</span> <span class="nav-text">课程机构排名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#课程机构排序。"><span class="nav-number">6.4.</span> <span class="nav-text">课程机构排序。</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-7-modelform-提交我要学习咨询1"><span class="nav-number">7.</span> <span class="nav-text">7-7 modelform 提交我要学习咨询1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#include的机制配置应用自己的url"><span class="nav-number">7.1.</span> <span class="nav-text">include的机制配置应用自己的url</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用modelform做提交"><span class="nav-number">7.2.</span> <span class="nav-text">使用modelform做提交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置相应的url"><span class="nav-number">7.3.</span> <span class="nav-text">配置相应的url</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-8-modelform-提交我要学习"><span class="nav-number">8.</span> <span class="nav-text">7-8 modelform 提交我要学习</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#分析ajax请求"><span class="nav-number">8.1.</span> <span class="nav-text">分析ajax请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#手机号码正则表达式验证"><span class="nav-number">8.2.</span> <span class="nav-text">手机号码正则表达式验证:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-9-机构详情"><span class="nav-number">9.</span> <span class="nav-text">7-9 机构详情</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#为讲师增加头像字段"><span class="nav-number">9.1.</span> <span class="nav-text">为讲师增加头像字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置访问的view和url"><span class="nav-number">9.2.</span> <span class="nav-text">配置访问的view和url</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#左侧active修改"><span class="nav-number">9.3.</span> <span class="nav-text">左侧active修改</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-10-课程机构收藏功能"><span class="nav-number">10.</span> <span class="nav-text">7-10 课程机构收藏功能</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">mtianyan</span><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共182.8k字</span></div></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script> <span class="site-uv">本站访客数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人次</span> <span class="site-pv">本站总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script><script type="text/javascript">!function(){var t="1eb79150519fd9b791c77e8eef6f3632";if((window.innerWidth||document.documentElement.clientWidth)<960)window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=cyrJmJ3rL&conf='+t+'"><\/script>');else{!function(t,e){var n=document.getElementsByTagName("head")[0]||document.head||document.documentElement,a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("charset","UTF-8"),a.setAttribute("src",t),"function"==typeof e&&(window.attachEvent?a.onreadystatechange=function(){var t=a.readyState;"loaded"!==t&&"complete"!==t||(a.onreadystatechange=null,e())}:a.onload=e),n.appendChild(a)}("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:"cyrJmJ3rL",conf:t})})}}()</script><script type="text/javascript" src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script><script type="text/javascript">var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")};function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){var r=!1,s=0,a=0,i=n.title.trim(),c=i.toLowerCase(),l=n.content.trim().replace(/<[^>]+>/g,""),h=l.toLowerCase(),p=decodeURIComponent(n.url),u=[],f=[];if(""!=i&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}u=u.concat(e(t,c,!1)),f=f.concat(e(t,h,!1))}),(u.length>0||f.length>0)&&(r=!0,s=u.length+f.length)),r){[u,f].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});function d(e,o,n,r){for(var s=r[r.length-1],i=s.position,c=s.word,l=[],h=0;i+c.length<=n&&0!=r.length;){c===t&&h++,l.push({position:i,length:c.length});var p=i+c.length;for(r.pop();0!=r.length&&(i=(s=r[r.length-1]).position,c=s.word,p>i);)r.pop()}return a+=h,{hits:l,start:o,end:n,searchTextCount:h}}var g=[];0!=u.length&&g.push(d(0,0,i.length,u));for(var v=[];0!=f.length;){var $=f[f.length-1],C=$.position,m=$.word,x=C-20,w=C+80;x<0&&(x=0),w<C+m.length&&(w=C+m.length),w>l.length&&(w=l.length),v.push(d(0,x,w,f))}v.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var y=parseInt("1");y>=0&&(v=v.slice(0,y));function T(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var b="";0!=g.length?b+="<li><a href='"+p+"' class='search-result-title'>"+T(i,g[0])+"</a>":b+="<li><a href='"+p+"' class='search-result-title'>"+i+"</a>",v.forEach(function(t){b+="<a href='"+p+'\'><p class="search-result">'+T(l,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:a,hitCount:s,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("2uqmIjYredIvFy6tEXbKG4Fj-gzGzoHsz","CWl1rE8cQlIseOg2Cq3hzxYi")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0!==e.length){for(var i=0;i<e.length;i++){var s=e[i],r=s.get("url"),l=s.get("time"),c=document.getElementById(r);$(c).find(t).text(l)}for(i=0;i<n.length;i++){r=n[i],c=document.getElementById(r);var u=$(c).find(t);""==u.text()&&u.text(0)}}else o.find(t).text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var s=new e,r=new AV.ACL;r.setPublicReadAccess(!0),r.setPublicWriteAccess(!0),s.setACL(r),s.set("title",o),s.set("url",n),s.set("time",1),s.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={},pbOptions.iconStyle="default",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={},flOptions.iconStyle="default",flOptions.boxForm="horizontal",flOptions.position="middleRight",flOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-float",flOptions)</script><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script><script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><div id="hexo-helper-live2d"><canvas id="live2dcanvas" width="150" height="300"></canvas></div><style>#live2dcanvas{position:fixed;width:150px;height:300px;opacity:.7;right:-30px;z-index:999;pointer-events:none;bottom:40px}</style><script type="text/javascript" src="/live2d/device.min.js"></script><script type="text/javascript">
const loadScript = function loadScript(c,b){var a=document.createElement("script");a.type="text/javascript";"undefined"!=typeof b&&(a.readyState?a.onreadystatechange=function(){if("loaded"==a.readyState||"complete"==a.readyState)a.onreadystatechange=null,b()}:a.onload=function(){b()});a.src=c;document.body.appendChild(a)};
(function(){
  if((typeof(device) != 'undefined') && (device.mobile())){
    var trElement = document.getElementById('hexo-helper-live2d');
    trElement.parentNode.removeChild(trElement);
    return;
  }else
    if (typeof(device) === 'undefined') console.error('Cannot find current-device script.');
  loadScript("/live2d/script.js", function(){loadlive2d("live2dcanvas", "/live2d/assets/hijiki.model.json", 0.5);});
})();
</script></body></html><script type="text/javascript" src="/js/src/love.js"></script>