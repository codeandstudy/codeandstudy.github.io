<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script></script><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3"><link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222"><meta name="keywords" content="Python,Django,在线教育平台,"><link rel="alternate" href="/atom.xml" title="mtianyan's blog" type="application/atom+xml"><meta name="description" content="矛盾的普遍性是指矛盾存在于一切事物的发展过程之中，矛盾存在于一切事物发展过程的始终。    我想只要是个系统，就少不了登录注册。这是我们需要首先处理的主要矛盾。  完成登录 注册 找回密码 激活 验证码集成"><meta name="keywords" content="Python,Django,在线教育平台"><meta property="og:type" content="article"><meta property="og:title" content="强力Django+杀手级Xadmin打造在线教育平台(六)"><meta property="og:url" content="http://blog.mtianyan.cn/post/c970abcd.html"><meta property="og:site_name" content="mtianyan&#39;s blog"><meta property="og:description" content="矛盾的普遍性是指矛盾存在于一切事物的发展过程之中，矛盾存在于一切事物发展过程的始终。    我想只要是个系统，就少不了登录注册。这是我们需要首先处理的主要矛盾。  完成登录 注册 找回密码 激活 验证码集成"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/fBkbi7968D.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/1EJD2hFc7E.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/ECL5dmKFkc.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/LflfkaA3Kj.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/cJ8c3l41H4.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/CBIAK2cjH0.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/ejcbBB0diJ.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/889BdI0a2g.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/lm6DF2CE02.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/5LiGiKh2ID.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/I2C4i7FFj4.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/IkkaFHhGAl.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/ddDBg58ek1.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/KAFII10hf9.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/mEjmk6c1j9.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/CgEm92B9Ig.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/4aBegCbaAk.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/cc82F1f1kE.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/F7JgIA41me.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/Gcia8G8fgG.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/AeBb1BJE9m.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/J4caJi44DG.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/741Ia99FLf.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/g1Hb79JKGK.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/l55JiK9Cmh.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/3i7BF5edj8.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/7I9gdJ5DLj.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/9mKFBk0Fc8.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/Ca0lhc68He.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/aelBLBFBG3.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/F86386mI15.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/EefmGb08e9.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/CKdB5L49dc.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/C6AajKcm51.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/G89gGl2G75.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/a3CjlEhC9B.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/4F22diHeF6.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/Bb6elgf96A.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/b3CH160G9h.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/F6d3AkdJB0.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/9L54Emf6md.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/kLdLLALGB1.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/2Hee7I5fIl.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/Gi40A0FFhB.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/BJl97lJ8bd.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/Hm54EJ7IH9.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/ackf2LaLJ8.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/3FDhdl2aiH.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/0KkhH7b8Bm.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/0Igb4IgB0F.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/JiI713cAdd.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/ac8KFHkCBc.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/d55glDI9E1.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/DL7ejk8EcF.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/01gC20eabk.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/ChgL88Ed76.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/547cdji7Gl.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/BKIjc06AF3.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/bA0KEd7bhc.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/ahg7KfbCAi.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/8leIJ2l6LD.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/6fDDI979Dk.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/FL04F47985.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/gmDlEB0L2G.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/e7a65cgj8D.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/ElHe2gdDAL.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180110/DGHbaLBkd3.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/i7DdIaB5bd.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/cgk66mgd35.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/Cf24GA16g0.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/4e60888a7F.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/fl8Dhg5B2H.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/KEmkdk9c3b.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/FI5fafG9a8.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/LFKlj0CLAb.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/BfaLgiG5k3.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180111/AiiGBEkJLj.png?imageslim"><meta property="og:updated_time" content="2018-02-02T12:40:13.960Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="强力Django+杀手级Xadmin打造在线教育平台(六)"><meta name="twitter:description" content="矛盾的普遍性是指矛盾存在于一切事物的发展过程之中，矛盾存在于一切事物发展过程的始终。    我想只要是个系统，就少不了登录注册。这是我们需要首先处理的主要矛盾。  完成登录 注册 找回密码 激活 验证码集成"><meta name="twitter:image" content="http://myphoto.mtianyan.cn/blog/180110/fBkbi7968D.png?imageslim"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.3",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://blog.mtianyan.cn/post/c970abcd.html"><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement("script"),n=t.getElementsByTagName("script")[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,0,("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/0f81ff2f.js","daovoice"),daovoice("init",{app_id:"e28768be"}),daovoice("update")</script><title>强力Django+杀手级Xadmin打造在线教育平台(六) | mtianyan's blog</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?415372bd35fec36f7558dd96b48ec03f";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/mtianyan" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">mtianyan's blog</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">天涯明月笙的博客小站(Github托管)</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br> 公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://blog.mtianyan.cn/post/c970abcd.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="mtianyan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="mtianyan's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">强力Django+杀手级Xadmin打造在线教育平台(六)</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-11T22:09:17+08:00">2018-01-11</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Django-Xadmin打造在线教育平台/" itemprop="url" rel="index"><span itemprop="name">Django+Xadmin打造在线教育平台</span></a></span></span> <span id="/post/c970abcd.html" class="leancloud_visitors" data-flag-title="强力Django+杀手级Xadmin打造在线教育平台(六)"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">热度&#58;</span><span class="leancloud-visitors-count"></span> <span>℃</span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">6,984</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">30</span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote class="blockquote-center"><p>矛盾的普遍性是指矛盾存在于一切事物的发展过程之中，矛盾存在于一切事物发展过程的始终。</p></blockquote><div class="note"><p> 我想只要是个系统，就少不了登录注册。这是我们需要首先处理的主要矛盾。</p><ul><li>完成登录 注册 找回密码 激活 验证码集成</li></ul></div><a id="more"></a><h2 id="6-1-首页和登录页面的配置"><a href="#6-1-首页和登录页面的配置" class="headerlink" title="6-1 首页和登录页面的配置"></a>6-1 首页和登录页面的配置</h2><p>用户访问我们的根目录，我们需要把html文件返回给用户。因此我们第一步把html文件放入template目录。</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/fBkbi7968D.png?imageslim" alt="mark"></p><p>在html中找到首页的html。拷贝到我们的template目录</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/1EJD2hFc7E.png?imageslim" alt="mark"></p><h3 id="新建static目录"><a href="#新建static目录" class="headerlink" title="新建static目录"></a>新建static目录</h3><blockquote><p>用来存放css, js等静态文件</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180110/ECL5dmKFkc.png?imageslim" alt="mark"></p><h4 id="配置处理静态文件的url。"><a href="#配置处理静态文件的url。" class="headerlink" title="配置处理静态文件的url。"></a>配置处理静态文件的url。</h4><p>Django2.0.1版本下:</p><p>Mxonline3/urls.py：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from django.views.generic import TemplateView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(&apos;xadmin/&apos;, xadmin.site.urls),</span><br><span class="line">    # TemplateView.as_view会将template转换为view</span><br><span class="line">    path(&apos;&apos;, TemplateView.as_view(template_name= &quot;index.html&quot;), name=  &quot;index&quot;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>Django1.9.8版本下:</p><p>Mxonline2/urls.py：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from django.views.generic import TemplateView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^xadmin/&apos;, xadmin.site.urls),</span><br><span class="line">    url(&apos;^$&apos;, TemplateView.as_view(template_name=&quot;index.html&quot;), name=&quot;index&quot;)</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>此时运行访问就可以访问到我们的index页面，不过会没有样式。</p><h3 id="设置static文件"><a href="#设置static文件" class="headerlink" title="设置static文件"></a>设置static文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 说明静态文件放在哪个目录</span></span><br><span class="line"></span><br><span class="line">STATIC_URL = <span class="string">'/static/'</span></span><br><span class="line"></span><br><span class="line">STATICFILES_DIRS = (</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">"static"</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="修改index页面中前端样式的引用地址"><a href="#修改index页面中前端样式的引用地址" class="headerlink" title="修改index页面中前端样式的引用地址"></a>修改index页面中前端样式的引用地址</h3><p><img src="http://myphoto.mtianyan.cn/blog/180110/LflfkaA3Kj.png?imageslim" alt="mark"></p><p>使用ctrl+f查找出所有<code>../</code>,全部替换为<code>/static/</code></p><p>然后点击运行，刷新页面可以看到我们的页面已经显示正常了。</p><h3 id="拷贝登录页面到template"><a href="#拷贝登录页面到template" class="headerlink" title="拷贝登录页面到template"></a>拷贝登录页面到template</h3><p><img src="http://myphoto.mtianyan.cn/blog/180110/cJ8c3l41H4.png?imageslim" alt="mark"></p><p>使用ctrl+f查找出所有<code>../</code>,全部替换为<code>/static/</code></p><blockquote><p>将css，js，图片全部替换完。</p></blockquote><h4 id="url配置跳转登录页面"><a href="#url配置跳转登录页面" class="headerlink" title="url配置跳转登录页面"></a>url配置跳转登录页面</h4><p>Mxonline2/urls.py：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录页面跳转url</span></span><br><span class="line">url(<span class="string">'^login/$'</span>, TemplateView.as_view(template_name=<span class="string">"login.html"</span>), name=<span class="string">"login"</span>)</span><br></pre></td></tr></table></figure><p>Mxonline3/urls.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TemplateView.as_view会将template转换为view</span></span><br><span class="line">path(<span class="string">''</span>, TemplateView.as_view(template_name= <span class="string">"index.html"</span>), name=  <span class="string">"index"</span>),</span><br><span class="line">path(<span class="string">'login/'</span>, TemplateView.as_view(template_name= <span class="string">"login.html"</span>), name=  <span class="string">"login"</span>)</span><br></pre></td></tr></table></figure><p>在index页面，ctrl+f找到登录。将a标签中地址替换为login的url。</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/CBIAK2cjH0.png?imageslim" alt="mark"></p><p>取消注释后，将login.html改为<code>/login/</code></p><p><img src="http://myphoto.mtianyan.cn/blog/180110/ejcbBB0diJ.png?imageslim" alt="mark"></p><p>点击左侧减号收起。然后使用<code>&lt;!--</code>与<code>--&gt;</code>将个人中心暂时注释。</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/889BdI0a2g.png?imageslim" alt="mark"></p><p>可以看到登录注册，点击登录。</p><blockquote><p>根路径下的所有url都不需要斜杠</p><p>此时我们的首页已经可以成功显示，通过首页点击登录也可以成功跳转登录页面</p></blockquote><p>本小节完成对应commit:</p><blockquote><p>6-1: 完成首页与登录页面配置，设置了STATICFILES_DIRS。注意：dirs是一个元组，不要少逗号。删除了前面上传头像等直接传到根目录的目录。</p></blockquote><h2 id="6-2-用户登录-1"><a href="#6-2-用户登录-1" class="headerlink" title="6-2 用户登录-1"></a>6-2 用户登录-1</h2><blockquote><p>配置url之前我们要书写好对应处理的view</p></blockquote><p>Django的view实际就是一个函数，接收request请求对象，处理后返回response对象。</p><p>users/views.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="comment"># 当我们配置url被这个view处理时，自动传入request对象.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 前端向后端发送的请求方式: get 或post</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 登录提交表单为post</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="comment"># 获取登录页面为get</span></span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        <span class="comment"># render就是渲染html返回用户</span></span><br><span class="line">        <span class="comment"># render三变量: request 模板名称 一个字典写明传给前端的值</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">"login.html"</span>, &#123;&#125;)</span><br></pre></td></tr></table></figure><p>django1.9.8/urls.py<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> users.views <span class="keyword">import</span> user_login</span><br><span class="line">    <span class="comment"># 登录页面跳转url login不要直接调用。而只是指向这个函数对象。</span></span><br><span class="line">    url(<span class="string">'^login/$'</span>,login, name=<span class="string">"login"</span>)</span><br></pre></td></tr></table></figure><p></p><p>django2.0.1/urls.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> users.views <span class="keyword">import</span> login</span><br><span class="line">    path(<span class="string">'login/'</span>, login, name=<span class="string">"login"</span>)</span><br></pre></td></tr></table></figure><p>在两行返回语句的位置打上断点:</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/lm6DF2CE02.png?imageslim" alt="mark"></p><p>点击debug，进入首页后点击登录。可以看到</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/5LiGiKh2ID.png?imageslim" alt="mark"></p><p>说明确实是通过get请求请求页面的。</p><p>通过值浏览器窗口可以看到这是一个<code>&lt;WSGIRequest: GET &#39;/login/&#39;&gt;</code>对象</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/I2C4i7FFj4.png?imageslim" alt="mark"></p><p><code>path:</code>是指向的地址。</p><p><code>f8</code>继续运行。跳转到登录页面。</p><h2 id="6-3-用户登录2"><a href="#6-3-用户登录2" class="headerlink" title="6-3 用户登录2"></a>6-3 用户登录2</h2><h3 id="html-form基础知识"><a href="#html-form基础知识" class="headerlink" title="html form基础知识"></a>html form基础知识</h3><p>templates/login.html:</p><blockquote><p>可以看到form表单中有input。点击提交会把值提交到后台。我们需要修改action让它指向我们的后台相应地址。</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180110/IkkaFHhGAl.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180110/ddDBg58ek1.png?imageslim" alt="mark"></p><blockquote><p>input中的name值会被传递到后台。回组成键值对形式。</p></blockquote><p>submit类型的input</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/KAFII10hf9.png?imageslim" alt="mark"></p><p>只保留post这里的断点。输入用户名密码。查看debug情况</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/mEjmk6c1j9.png?imageslim" alt="mark"></p><p><code>403禁止访问</code>错误: html页面内必须加上<code>crsf token</code> 才能传值到后台。</p><blockquote><p>我会随机的给前端发一串符号，你必须把这串符号带回来，我才允许你post。</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180110/CgEm92B9Ig.png?imageslim" alt="mark"></p><p>from表单之前写上<code>crsf token</code></p><p>此时我们查看前端页面：</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/4aBegCbaAk.png?imageslim" alt="mark"></p><p>可以看到html中登录下面有一个隐藏着的值：crsf token, 不会显示。</p><p>此时点击登录跳转到pass位置。</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/cc82F1f1kE.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180110/F7JgIA41me.png?imageslim" alt="mark"></p><p>可以看到request中的POST中是一个queryset的对象。我们可以把它当成一个字典来用。<br>来取到前端的数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">    <span class="comment"># 取不到时为空，username，password为前端页面name值</span></span><br><span class="line">    user_name = request.POST.get(<span class="string">"username"</span>, <span class="string">""</span>)</span><br><span class="line">    pass_word = request.POST.get(<span class="string">"password"</span>, <span class="string">""</span>)</span><br></pre></td></tr></table></figure><p>取到用户名和密码我们就要开始进行验证登录。使用Django自带的<code>auth</code>方法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate, login</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 登录提交表单为post</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        <span class="comment"># 取不到时为空，username，password为前端页面name值</span></span><br><span class="line">        user_name = request.POST.get(<span class="string">"username"</span>, <span class="string">""</span>)</span><br><span class="line">        pass_word = request.POST.get(<span class="string">"password"</span>, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 成功返回user对象,失败返回null</span></span><br><span class="line">        user = authenticate(username= user_name, password= pass_word)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果不是null说明验证成功</span></span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="comment"># login_in 两参数：request, user</span></span><br><span class="line">            <span class="comment"># 实际是对request写了一部分东西进去，然后在render的时候：</span></span><br><span class="line">            <span class="comment"># request是要render回去的。这些信息也就随着返回浏览器。完成登录</span></span><br><span class="line">            login(request, user)</span><br><span class="line">            <span class="comment"># 跳转到首页 user request会被带回到首页</span></span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">"index.html"</span>)</span><br><span class="line">        <span class="comment"># 没有成功说明里面的值是None，并再次跳转回主页面</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">"login.html"</span>, &#123;&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>authenticate调用只需要传入用户名和密码。成功会返回user对象，失败返回null</p></blockquote><p>html中通过</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/Gcia8G8fgG.png?imageslim" alt="mark"></p><blockquote><p>设置成如果登录显示个人中心那段，未登录显示登录注册</p></blockquote><p>打上断点</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/AeBb1BJE9m.png?imageslim" alt="mark"></p><p>点击debug后可以看到</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/J4caJi44DG.png?imageslim" alt="mark"></p><blockquote><p>我们成功的取到了值。</p></blockquote><p>Django默认我们使用用户名和密码来登录</p><p>成功的登录user值如下</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/741Ia99FLf.png?imageslim" alt="mark"></p><p>但是继续执行报错:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login() takes exactly 1 argument (2 given)</span><br></pre></td></tr></table></figure><p>这时因为我们处理登录的自定义函数也叫login。就直接调用了自身，而不是调用Django提供的login。<strong>所以我们一定不要把自定义view函数命名与Django提供的冲突</strong></p><blockquote><p>解决方案：将我们的login改为<code>def user_login(request):</code></p></blockquote><p>并且前往urls.py中将login也一并改了</p><p>此时运行可以看到我们的个人中心已经出来了。</p><h3 id="改造为使用邮箱用户名均可。Setting中重载变量"><a href="#改造为使用邮箱用户名均可。Setting中重载变量" class="headerlink" title="改造为使用邮箱用户名均可。Setting中重载变量"></a>改造为使用邮箱用户名均可。Setting中重载变量</h3><blockquote><p>自定义authenticate方法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.backends <span class="keyword">import</span> ModelBackend</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> UserProfile</span><br><span class="line"><span class="comment"># 并集运算</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实现用户名邮箱均可登录</span></span><br><span class="line"><span class="comment"># 继承ModelBackend类，因为它有方法authenticate，可点进源码查看</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomBackend</span><span class="params">(ModelBackend)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">authenticate</span><span class="params">(self, username=None, password=None, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 不希望用户存在两个，get只能有一个。两个是get失败的一种原因 Q为使用并集查询</span></span><br><span class="line"></span><br><span class="line">            user = UserProfile.objects.get(Q(username=username)|Q(email=username))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># django的后台中密码加密：所以不能password==password</span></span><br><span class="line">            <span class="comment"># UserProfile继承的AbstractUser中有def check_password(self, raw_password):</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> user.check_password(password):</span><br><span class="line">                <span class="keyword">return</span> user</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">None</span></span><br></pre></td></tr></table></figure><p>Mxonline2/settings.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置邮箱和用户名均可登录</span></span><br><span class="line">AUTHENTICATION_BACKENDS = (</span><br><span class="line">    <span class="string">'users.views.CustomBackend'</span>,</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180110/g1Hb79JKGK.png?imageslim" alt="mark"></p><blockquote><p>使用xadmin的退出，注销当前用户的退出。</p></blockquote><p>此时我们可以通过邮箱和用户名都可以完成登录。</p><h3 id="用户提示：return页面时提供它的错误信息"><a href="#用户提示：return页面时提供它的错误信息" class="headerlink" title="用户提示：return页面时提供它的错误信息"></a>用户提示：return页面时提供它的错误信息</h3><p><img src="http://myphoto.mtianyan.cn/blog/180110/l55JiK9Cmh.png?imageslim" alt="mark"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> render(request, <span class="string">"login.html"</span>, &#123;<span class="string">"msg"</span>:<span class="string">"用户名或密码错误! "</span>&#125;)</span><br></pre></td></tr></table></figure><p>Html中如何取到这个值;</p><p>login html中这段是用来做错误提示的。</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/3i7BF5edj8.png?imageslim" alt="mark"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;error btns login-form-tips&quot; id=&quot;jsLoginTips&quot;&gt;&#123;&#123; msg &#125;&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>验证：</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/7I9gdJ5DLj.png?imageslim" alt="mark"></p><p>本小节结束对应commit:</p><blockquote><p>6-2&amp;3 完成了用户登录，登录验证自定义：邮箱用户名均可。错误信息返回前端。设置登录显示个人中心判断，注意不要把自定义方法写成login。</p></blockquote><h2 id="6-4-用form实现登录-1"><a href="#6-4-用form实现登录-1" class="headerlink" title="6-4 用form实现登录-1"></a>6-4 用form实现登录-1</h2><p>上面我们的用户登录的方法是基于函数来做的。本节我们做一个基于类方法的版本。<br>要求对类的继承有了解。</p><p>基础教程中基本上都是基于函数来做的，其实更推荐基于类来做。基于类可以带来不少好处</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于类实现需要继承的view</span></span><br><span class="line"><span class="keyword">from</span> django.views.generic.base <span class="keyword">import</span> View</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="comment"># 直接调用get方法免去判断</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="comment"># render就是渲染html返回用户</span></span><br><span class="line">        <span class="comment"># render三变量: request 模板名称 一个字典写明传给前端的值</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">"login.html"</span>, &#123;&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="comment"># 取不到时为空，username，password为前端页面name值</span></span><br><span class="line">        user_name = request.POST.get(<span class="string">"username"</span>, <span class="string">""</span>)</span><br><span class="line">        pass_word = request.POST.get(<span class="string">"password"</span>, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 成功返回user对象,失败返回null</span></span><br><span class="line">        user = authenticate(username=user_name, password=pass_word)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果不是null说明验证成功</span></span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="comment"># login_in 两参数：request, user</span></span><br><span class="line">            <span class="comment"># 实际是对request写了一部分东西进去，然后在render的时候：</span></span><br><span class="line">            <span class="comment"># request是要render回去的。这些信息也就随着返回浏览器。完成登录</span></span><br><span class="line">            login(request, user)</span><br><span class="line">            <span class="comment"># 跳转到首页 user request会被带回到首页</span></span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">"index.html"</span>)</span><br><span class="line">        <span class="comment"># 没有成功说明里面的值是None，并再次跳转回主页面</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">"login.html"</span>, &#123;<span class="string">"msg"</span>: <span class="string">"用户名或密码错误! "</span>&#125;)</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180110/9mKFBk0Fc8.png?imageslim" alt="mark"></p><blockquote><p>继承的view中的方法。</p></blockquote><p>django1.9.8 urls中的配置:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 换用类实现</span></span><br><span class="line"><span class="keyword">from</span> users.views <span class="keyword">import</span> LoginView</span><br><span class="line">    <span class="comment"># 基于类方法实现登录,这里是调用它的方法</span></span><br><span class="line">    url(<span class="string">'^login/$'</span>, LoginView.as_view(), name=<span class="string">"login"</span>)</span><br></pre></td></tr></table></figure><p>Django2.0.1 urls配置:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于类方法实现登录,这里是调用它的方法</span></span><br><span class="line">path(<span class="string">'login/'</span>, LoginView.as_view(), name=<span class="string">"login"</span>)</span><br></pre></td></tr></table></figure><h2 id="6-5-form字段验证"><a href="#6-5-form字段验证" class="headerlink" title="6-5 form字段验证"></a>6-5 form字段验证</h2><p>验证最大长度，是否为空等一系列。</p><p>users下新建forms文件。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line">__author__ = <span class="string">'mtianyan'</span></span><br><span class="line">__date__ = <span class="string">'2018/1/10 0010 04:44'</span></span><br><span class="line"><span class="comment"># 引入Django表单</span></span><br><span class="line"><span class="keyword">from</span>  django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录表单验证</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    <span class="comment"># 用户名密码不能为空</span></span><br><span class="line">    username = forms.CharField(required=<span class="keyword">True</span>)</span><br><span class="line">    password = forms.CharField(required=<span class="keyword">True</span>, min_length=<span class="number">5</span>)</span><br></pre></td></tr></table></figure><p>定义好forms之后我们来使用它做验证。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="comment"># 类实例化需要一个字典参数dict:request.POST就是一个QueryDict所以直接传入</span></span><br><span class="line">        <span class="comment"># POST中的usernamepassword，会对应到form中</span></span><br><span class="line">        login_form = LoginForm(request.POST)</span><br><span class="line">		<span class="comment">#is_valid判断我们字段是否有错执行我们原有逻辑，验证失败跳回login页面</span></span><br><span class="line">        <span class="keyword">if</span> login_form.is_valid():</span><br><span class="line">            <span class="comment"># 取不到时为空，username，password为前端页面name值</span></span><br><span class="line">            user_name = request.POST.get(<span class="string">"username"</span>, <span class="string">""</span>)</span><br><span class="line">            pass_word = request.POST.get(<span class="string">"password"</span>, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 成功返回user对象,失败返回null</span></span><br><span class="line">            user = authenticate(username=user_name, password=pass_word)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 如果不是null说明验证成功</span></span><br><span class="line">            <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">                <span class="comment"># login_in 两参数：request, user</span></span><br><span class="line">                <span class="comment"># 实际是对request写了一部分东西进去，然后在render的时候：</span></span><br><span class="line">                <span class="comment"># request是要render回去的。这些信息也就随着返回浏览器。完成登录</span></span><br><span class="line">                login(request, user)</span><br><span class="line">                <span class="comment"># 跳转到首页 user request会被带回到首页</span></span><br><span class="line">                <span class="keyword">return</span> render(request, <span class="string">"index.html"</span>)</span><br><span class="line">        <span class="comment"># 验证不成功跳回登录页面</span></span><br><span class="line">        <span class="comment"># 没有成功说明里面的值是None，并再次跳转回主页面</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">"login.html"</span>, &#123;<span class="string">"msg"</span>: <span class="string">"用户名或密码错误! "</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="完善错误提示"><a href="#完善错误提示" class="headerlink" title="完善错误提示"></a>完善错误提示</h3><p>比如：既然表单都验证失败了，就不用显示密码出错了</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/Ca0lhc68He.png?imageslim" alt="mark"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仅当用户真的密码出错时</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> render(request, <span class="string">"login.html"</span>,&#123;<span class="string">"msg"</span>:<span class="string">"用户名或密码错误!"</span>&#125;)</span><br><span class="line">        <span class="comment"># 验证不成功跳回登录页面</span></span><br><span class="line">        <span class="comment"># 没有成功说明里面的值是None，并再次跳转回主页面</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render(</span><br><span class="line">                request, <span class="string">"login.html"</span>, &#123;</span><br><span class="line">                    <span class="string">"login_form"</span>: login_form &#125;)</span><br></pre></td></tr></table></figure><p>forms中的名称username和password必须和html中的一致。毕竟他是使用的request.POST<br>而request是从前面传过来的。</p><p>实例化<code>LoginView</code>时已经对于我们的字段进行了验证。</p><p>打上断点:</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/aelBLBFBG3.png?imageslim" alt="mark"></p><p><code>debug</code>后<code>f6</code>运行到</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/F86386mI15.png?imageslim" alt="mark"></p><p>此时可以看到<code>errors(ErrorDict)</code>中的错误</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/EefmGb08e9.png?imageslim" alt="mark"></p><p>将form传回前端:</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/CKdB5L49dc.png?imageslim" alt="mark"></p><p>前端中取值：</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/C6AajKcm51.png?imageslim" alt="mark"></p><p>给这个class加上errorput会显示红色外框。</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/G89gGl2G75.png?imageslim" alt="mark"></p><blockquote><p>注意:写在class里面</p></blockquote><h3 id="将forms错误信息显示出来"><a href="#将forms错误信息显示出来" class="headerlink" title="将forms错误信息显示出来"></a>将forms错误信息显示出来</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class="error btns login-form-tips" id="jsLoginTips"&gt;</span><br><span class="line">&#123;% <span class="keyword">for</span> key, error <span class="keyword">in</span> login_form.errors.items %&#125;</span><br><span class="line">&#123;&#123; error &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&#123;&#123; msg &#125;&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180110/a3CjlEhC9B.png?imageslim" alt="mark"></p><ul><li>写了一个类继承Django的view，然后写了get post方法(get/post的if是Django替我们完成的)</li><li>在url中调用Loginview的as_view方法需要加上括号，进行调用。</li><li>Django的form进行表单验证并把error值传到前台。</li><li>is_valid方法，验证表单</li></ul><p>本小节完毕对应commit:</p><blockquote><p>6-4 &amp; 5 登录换用类继承view实现,使用Django form进行表单验证并把错误信息提示到前台。</p></blockquote><h2 id="6-6-session和cookie自动登录机制"><a href="#6-6-session和cookie自动登录机制" class="headerlink" title="6-6 session和cookie自动登录机制"></a>6-6 session和cookie自动登录机制</h2><blockquote><p>我们本节来讲session和cookie</p></blockquote><p>User1如何实现登录的。</p><h3 id="cookie的存储"><a href="#cookie的存储" class="headerlink" title="cookie的存储"></a>cookie的存储</h3><p>cookie是浏览器支持的一种本地存储方式。以dict，键值对方式存储。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;sessionkey&quot;: &quot;123&quot;&#125;</span><br></pre></td></tr></table></figure><p>浏览器会自动对于它进行解析。</p><h3 id="http请求是一种无状态的请求"><a href="#http请求是一种无状态的请求" class="headerlink" title="http请求是一种无状态的请求"></a>http请求是一种无状态的请求</h3><p>用户向服务器发起的两次请求之间是没有状态的。也就是服务器并不知道这是同一个用户发的。</p><p>做到记住用户:</p><blockquote><p>浏览器a在向服务器发起请求，服务器会自动给浏览器a回复一个id，浏览器a把id放到cookie当中，在下一次请求时带上这个cookie里的id值向浏览器请求，服务器就知道你是哪个浏览器发过来的了。</p></blockquote><h3 id="有状态请求-cookie"><a href="#有状态请求-cookie" class="headerlink" title="有状态请求(cookie)"></a>有状态请求(cookie)</h3><p><img src="http://myphoto.mtianyan.cn/blog/180110/4F22diHeF6.png?imageslim" alt="mark"></p><p>服务器<code>a</code>发回来的<code>id</code>会放到服务器<code>a</code>的域之下。<strong>不能跨域访问cookie。</strong></p><p>使用浏览器随便打开一个网页，然后<code>f12</code>打开。</p><p>比如我使用的<code>Chrome</code>浏览器</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/Bb6elgf96A.png?imageslim" alt="mark"></p><p>会找到存储在浏览器本地的cookie值</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/b3CH160G9h.png?imageslim" alt="mark"></p><p>点击<code>clear all</code>清空所有的<code>cookie</code> <code>f5</code>刷新页面，会发现又把这些cookie值进来。</p><p>如果将用户名和密码直接保存在cookie，可以实现<strong>最垃圾最简略版本的</strong>自动登录。</p><h3 id="解决cookie放在本地不安全的问题-session"><a href="#解决cookie放在本地不安全的问题-session" class="headerlink" title="解决cookie放在本地不安全的问题(session)"></a>解决cookie放在本地不安全的问题(session)</h3><blockquote><p>用户在第一次请求后，浏览器回复的id既可以是用户的user id。<br>也可以一段任意的字符串，我们把它叫做session id</p></blockquote><p>根据用户名和密码，服务器会采用自己的规则生成<code>session id</code>。这个<code>session id</code>保存在本地cookie。浏览器请求服务器会携带。</p><ul><li>输入用户名 &amp; 密码</li><li>调用 login(), 后端程序会根据用户名密码生成session id。保存在数据库中。</li><li>用户登录之后，需要通过这个<code>session id</code>取出这些基本信息。</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180110/F6d3AkdJB0.png?imageslim" alt="mark"></p><p>Django的默认表中的<code>session</code>表就记录了用户登录时，后端我们Django为用户生成的<code>sessionid</code>。</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/9L54Emf6md.png?imageslim" alt="mark"></p><p>可以看到<code>session key value</code> 和过期时间。</p><p>我们可以清空这张表的数据。运行项目进行登录。</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/kLdLLALGB1.png?imageslim" alt="mark"></p><blockquote><p>可以看到我们刚刚生成的session id。</p></blockquote><p>此时通过<code>f12</code>查看浏览器在本地存储的<code>session id</code>。可以看到如下图和我们数据库中的一致。</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/2Hee7I5fIl.png?imageslim" alt="mark"></p><blockquote><p><strong>session_key 发到浏览器叫做session id</strong></p></blockquote><p>通过session id 用户访问任何一个页面都会携带，服务器就会认识。</p><p>Setting.py中，</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/Gi40A0FFhB.png?imageslim" alt="mark"></p><p>这个app会拦截我们每次的request请求，在<code>request</code>中找到session id，然后去数据表中进行查询。<br>然后通过<code>session key</code> 去找到<code>session data</code>。此时直接为我们取出了user。</p><p>在服务器返回浏览器的<code>response</code>中也会直接加上<code>session id</code></p><blockquote><p>cookie是浏览器本地存储机制，存在域名之下，存储不安全。<br>服务器在返回id时通过规则生成一串字符，并设置了过期时间。存储在服务器端(数据库)</p></blockquote><p>文章: <a href="http://projectsedu.com/2016/10/17/django%E4%BB%8E%E8%AF%B7%E6%B1%82%E5%88%B0%E8%BF%94%E5%9B%9E%E9%83%BD%E7%BB%8F%E5%8E%86%E4%BA%86%E4%BB%80%E4%B9%88/" target="_blank" rel="noopener">http://projectsedu.com/2016/10/17/django%E4%BB%8E%E8%AF%B7%E6%B1%82%E5%88%B0%E8%BF%94%E5%9B%9E%E9%83%BD%E7%BB%8F%E5%8E%86%E4%BA%86%E4%BB%80%E4%B9%88/</a></p><h2 id="6-7-用户注册"><a href="#6-7-用户注册" class="headerlink" title="6-7 用户注册"></a>6-7 用户注册</h2><h3 id="拷贝注册页面进入template目录"><a href="#拷贝注册页面进入template目录" class="headerlink" title="拷贝注册页面进入template目录"></a>拷贝注册页面进入template目录</h3><h3 id="书写我们对应要处理的view-RegisterView"><a href="#书写我们对应要处理的view-RegisterView" class="headerlink" title="书写我们对应要处理的view(RegisterView)"></a>书写我们对应要处理的view(RegisterView)</h3><p>users/views.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注册功能的view</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegisterView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="comment"># get方法直接返回页面</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">"register.html"</span>, &#123;&#125;)</span><br></pre></td></tr></table></figure><h3 id="配置对应的url"><a href="#配置对应的url" class="headerlink" title="配置对应的url"></a>配置对应的url</h3><p>Django1.9.8 url配置如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> users.views <span class="keyword">import</span> RegisterView</span><br><span class="line">    <span class="comment"># 注册url</span></span><br><span class="line">    url(<span class="string">"^register/"</span>, RegisterView.as_view(), name=<span class="string">"register"</span>),</span><br></pre></td></tr></table></figure><p>Django2.0.1 url配置如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> users.views <span class="keyword">import</span> RegisterView</span><br><span class="line">    <span class="comment"># 注册url</span></span><br><span class="line">    path(<span class="string">"register/"</span>, RegisterView.as_view(), name = <span class="string">"register"</span> )</span><br></pre></td></tr></table></figure><h3 id="修改index页面中注册url"><a href="#修改index页面中注册url" class="headerlink" title="修改index页面中注册url"></a>修改index页面中注册url</h3><p><img src="http://myphoto.mtianyan.cn/blog/180110/BJl97lJ8bd.png?imageslim" alt="mark"></p><p>此时访问首页发现可以成功跳转到注册页面</p><h3 id="修改静态文件中static目录引用"><a href="#修改静态文件中static目录引用" class="headerlink" title="修改静态文件中static目录引用"></a>修改静态文件中static目录引用</h3><h4 id="关键步骤load-staticfile"><a href="#关键步骤load-staticfile" class="headerlink" title="关键步骤load staticfile"></a>关键步骤load staticfile</h4><p><img src="http://myphoto.mtianyan.cn/blog/180110/Hm54EJ7IH9.png?imageslim" alt="mark"></p><h4 id="然后修改路径为一个相对于static的相对路径"><a href="#然后修改路径为一个相对于static的相对路径" class="headerlink" title="然后修改路径为一个相对于static的相对路径"></a>然后修改路径为一个相对于static的相对路径</h4><p><img src="http://myphoto.mtianyan.cn/blog/180110/ackf2LaLJ8.png?imageslim" alt="mark"></p><blockquote><p>他会自动根据setting中配置，为我们加上前缀</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180110/3FDhdl2aiH.png?imageslim" alt="mark"></p><blockquote><p>如果我们把目录在setting中改到mystatic。url中会自动添加指定的前缀</p></blockquote><p>可以看到可以访问成功。</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/0KkhH7b8Bm.png?imageslim" alt="mark"></p><h4 id="将目前的三个html中的静态文件全部修改目录"><a href="#将目前的三个html中的静态文件全部修改目录" class="headerlink" title="将目前的三个html中的静态文件全部修改目录"></a>将目前的三个html中的静态文件全部修改目录</h4><blockquote><p>枯燥但是要有耐心。</p></blockquote><p>这时候访问三个页面，查看样式是否完好。</p><h3 id="验证码库实现验证码"><a href="#验证码库实现验证码" class="headerlink" title="验证码库实现验证码"></a>验证码库实现验证码</h3><p><a href="https://github.com/mbi/django-simple-captcha" target="_blank" rel="noopener">https://github.com/mbi/django-simple-captcha</a></p><h4 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">workon mxonline3</span><br><span class="line">pip install  django-simple-captcha</span><br><span class="line">workon mxonline2</span><br><span class="line">pip install  django-simple-captcha==0.4.6</span><br></pre></td></tr></table></figure><ul><li><p>Add <code>captcha</code> to the <code>INSTALLED_APPS</code> in your <code>settings.py</code></p></li><li><p>Add an entry to your <code>urls.py</code>:</p></li></ul><p>django1.9.8如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include</span><br><span class="line">urlpatterns += [</span><br><span class="line">    url(<span class="string">r'^captcha/'</span>, include(<span class="string">'captcha.urls'</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>django2.0.1如下；</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 验证码url</span><br><span class="line">path(&quot;captcha/&quot;, include(&apos;captcha.urls&apos;))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makemigrations</span><br><span class="line">migrate</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180110/0Igb4IgB0F.png?imageslim" alt="mark"></p><p>进入数据库查看生成的表</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/JiI713cAdd.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180111/ac8KFHkCBc.png?imageslim" alt="mark"></p><h3 id="将验证码展示到页面"><a href="#将验证码展示到页面" class="headerlink" title="将验证码展示到页面"></a>将验证码展示到页面</h3><p>users/forms.py:</p><h4 id="定义我们的register-form"><a href="#定义我们的register-form" class="headerlink" title="定义我们的register form:"></a>定义我们的register form:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 引入验证码field</span></span><br><span class="line"><span class="keyword">from</span> captcha.fields <span class="keyword">import</span> CaptchaField</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证码form &amp; 注册表单form</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegisterForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    <span class="comment"># 此处email与前端name需保持一致。</span></span><br><span class="line">    email = forms.EmailField(required=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># 密码不能小于5位</span></span><br><span class="line">    password = forms.CharField(required=<span class="keyword">True</span>, min_length=<span class="number">5</span>)</span><br><span class="line">    <span class="comment"># 应用验证码</span></span><br><span class="line">    captcha = CaptchaField()</span><br></pre></td></tr></table></figure><p>users/views.py</p><h4 id="在我们的registerform中实例化并传送到前端"><a href="#在我们的registerform中实例化并传送到前端" class="headerlink" title="在我们的registerform中实例化并传送到前端:"></a>在我们的registerform中实例化并传送到前端:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># form表单验证 &amp; 验证码</span><br><span class="line">from .forms import LoginForm, RegisterForm</span><br><span class="line"></span><br><span class="line"># 注册功能的view</span><br><span class="line">class RegisterView(View):</span><br><span class="line">    # get方法直接返回页面</span><br><span class="line">    def get(self, request):</span><br><span class="line">        # 添加验证码</span><br><span class="line">        register_form = RegisterForm()</span><br><span class="line">        return render(request, &quot;register.html&quot;, &#123;&apos;register_form&apos;:register_form&#125;)</span><br></pre></td></tr></table></figure><h4 id="前端获取验证码值"><a href="#前端获取验证码值" class="headerlink" title="前端获取验证码值"></a>前端获取验证码值</h4><p><img src="http://myphoto.mtianyan.cn/blog/180110/d55glDI9E1.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180110/DL7ejk8EcF.png?imageslim" alt="mark"></p><p>找到上图验证码部分。修改为下图</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/01gC20eabk.png?imageslim" alt="mark"></p><p>Forms中的field会生成不同的框。</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/ChgL88Ed76.png?imageslim" alt="mark"></p><p>我们只有label但是前端可以查看到input框等，也就是Registerform会为我们生成输入框+验证码。</p><blockquote><p>隐藏的字符串的框会被带到后台，由Django为我们进行验证。验证该验证码是否保存过。</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180110/547cdji7Gl.png?imageslim" alt="mark"></p><blockquote><p>可以看得我们数据库中将这个hashkey进行了保存。这个key与验证码内容对应。</p></blockquote><p>后台会把验证码值 和 hashkey进行联合查询。</p><h3 id="编写register-view的后台逻辑-RegisterView"><a href="#编写register-view的后台逻辑-RegisterView" class="headerlink" title="编写register view的后台逻辑(RegisterView)"></a>编写register view的后台逻辑(RegisterView)</h3><p>users/views.py的RegisterView中添加post方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def post(self, request):</span><br><span class="line">    # 实例化form</span><br><span class="line">    register_form = RegisterForm(request.POST)</span><br><span class="line">    if register_form.is_valid():</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180110/BKIjc06AF3.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180110/bA0KEd7bhc.png?imageslim" alt="mark"></p><p>修改form表单提交方式与提交到哪个url</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/ahg7KfbCAi.png?imageslim" alt="mark"></p><p>前端的form提交加上对应的crsf token</p><p>刷新验证码是前端帮我们完成的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//刷新验证码</span><br><span class="line">function refresh_captcha(event)&#123;</span><br><span class="line">    $.get(&quot;/captcha/refresh/?&quot;+Math.random(), function(result)&#123;</span><br><span class="line">        $(&apos;#&apos;+event.data.form_id+&apos; .captcha&apos;).attr(&quot;src&quot;,result.image_url);</span><br><span class="line">        $(&apos;#id_captcha_0&apos;).attr(&quot;value&quot;,result.key);</span><br><span class="line">    &#125;);</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="获取前端页面值并封装成一个user-profile对象，保存到数据库。"><a href="#获取前端页面值并封装成一个user-profile对象，保存到数据库。" class="headerlink" title="获取前端页面值并封装成一个user_profile对象，保存到数据库。"></a>获取前端页面值并封装成一个user_profile对象，保存到数据库。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib.auth.hashers import make_password</span><br><span class="line"></span><br><span class="line">        if register_form.is_valid():</span><br><span class="line">            user_name = request.POST.get(&quot;email&quot;, &quot;&quot;)</span><br><span class="line">            pass_word = request.POST.get(&quot;password&quot;, &quot;&quot;)</span><br><span class="line"></span><br><span class="line">            # 实例化一个user_profile对象，将前台值存入</span><br><span class="line">            user_profile = UserProfile()</span><br><span class="line">            user_profile.username = user_name</span><br><span class="line">            user_profile.email = user_name</span><br><span class="line"></span><br><span class="line">            # 加密password进行保存</span><br><span class="line">            user_profile.password = make_password(pass_word)</span><br><span class="line">            user_profile.save()</span><br><span class="line">            pass</span><br></pre></td></tr></table></figure><h4 id="发送邮件实现"><a href="#发送邮件实现" class="headerlink" title="发送邮件实现"></a>发送邮件实现</h4><p>setting中配置；</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发送邮件的setting设置</span></span><br><span class="line"></span><br><span class="line">EMAIL_HOST = <span class="string">"smtp.qq.com"</span></span><br><span class="line">EMAIL_PORT = <span class="number">25</span></span><br><span class="line">EMAIL_HOST_USER = <span class="string">"mxonline.mtianyan.cn"</span></span><br><span class="line">EMAIL_HOST_PASSWORD = <span class="string">" "</span></span><br><span class="line">EMAIL_USE_TLS= <span class="keyword">True</span></span><br><span class="line">EMAIL_FROM = <span class="string">"mxonline.mtianyan.cn"</span></span><br></pre></td></tr></table></figure><p>新建package后新建文件。</p><p><code>apps：utils/email_send.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random</span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">'mtianyan'</span></span><br><span class="line">__date__ = <span class="string">'2018/1/10 0010 20:47'</span></span><br><span class="line"><span class="keyword">from</span>  users.models <span class="keyword">import</span> EmailVerifyRecord</span><br><span class="line"><span class="comment"># 导入Django自带的邮件模块</span></span><br><span class="line"><span class="keyword">from</span> django.core.mail <span class="keyword">import</span> send_mail</span><br><span class="line"><span class="comment"># 导入setting中发送邮件的配置</span></span><br><span class="line"><span class="keyword">from</span> Mxonline2.settings <span class="keyword">import</span> EMAIL_FROM</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成随机字符串</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_str</span><span class="params">(random_length=<span class="number">8</span>)</span>:</span></span><br><span class="line">    str = <span class="string">''</span></span><br><span class="line">    <span class="comment"># 生成字符串的可选字符串</span></span><br><span class="line">    chars = <span class="string">'AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0123456789'</span></span><br><span class="line">    length = len(chars) - <span class="number">1</span></span><br><span class="line">    random = Random()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(random_length):</span><br><span class="line">        str += chars[random.randint(<span class="number">0</span>, length)]</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送注册邮件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_register_eamil</span><span class="params">(email, send_type=<span class="string">"register"</span>)</span>:</span></span><br><span class="line">    <span class="comment"># 发送之前先保存到数据库，到时候查询链接是否存在</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实例化一个EmailVerifyRecord对象</span></span><br><span class="line">    email_record = EmailVerifyRecord()</span><br><span class="line">    <span class="comment"># 生成随机的code放入链接</span></span><br><span class="line">    code = random_str(<span class="number">16</span>)</span><br><span class="line">    email_record.code = code</span><br><span class="line">    email_record.email = email</span><br><span class="line">    email_record.send_type = send_type</span><br><span class="line"></span><br><span class="line">    email_record.save()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义邮件内容:</span></span><br><span class="line">    email_title = <span class="string">""</span></span><br><span class="line">    email_body = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> send_type == <span class="string">"register"</span>:</span><br><span class="line">        email_title = <span class="string">"mtianyan慕课小站 注册激活链接"</span></span><br><span class="line">        email_body = <span class="string">"请点击下面的链接激活你的账号: http://127.0.0.1:8000/active/&#123;0&#125;"</span>.format(code)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 使用Django内置函数完成邮件发送。四个参数：主题，邮件内容，从哪里发，接受者list</span></span><br><span class="line">        send_status = send_mail(email_title, email_body, EMAIL_FROM, [email])</span><br><span class="line">        <span class="comment"># 如果发送成功</span></span><br><span class="line">        <span class="keyword">if</span> send_status:</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180110/8leIJ2l6LD.png?imageslim" alt="mark"></p><p>上图为qq邮箱开启smtp服务</p><p>点击生成授权码</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/6fDDI979Dk.png?imageslim" alt="mark"></p><p>def post中加上发送邮件</p><p><code>users/views.py</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 发送邮件</span><br><span class="line">from utils.email_send import send_register_eamil</span><br><span class="line">            # 发送注册激活邮件</span><br><span class="line">            send_register_eamil(user_name, &quot;register&quot;)</span><br></pre></td></tr></table></figure><p>点击注册提交，因为我们没有return。一直在转圈圈。</p><p>但是数据库中已经添加了字段。</p><p><img src="http://myphoto.mtianyan.cn/blog/180110/FL04F47985.png?imageslim" alt="mark"></p><p>可以看到我们的邮件已经被发送到邮箱中。</p><p>如果注册成功返回login页面:不成功，返回register页面并报错。</p><h4 id="完善错误提示。"><a href="#完善错误提示。" class="headerlink" title="完善错误提示。"></a>完善错误提示。</h4><blockquote><p>找猫画虎：将login中的错误提示搬运到register中来。</p></blockquote><ul><li>register_form的报错信息。</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180110/gmDlEB0L2G.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180110/e7a65cgj8D.png?imageslim" alt="mark"></p><ul><li>邮箱 &amp; 密码 form验证</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180110/ElHe2gdDAL.png?imageslim" alt="mark"></p><h4 id="完善用户值回填逻辑"><a href="#完善用户值回填逻辑" class="headerlink" title="完善用户值回填逻辑"></a>完善用户值回填逻辑</h4><p><img src="http://myphoto.mtianyan.cn/blog/180110/DGHbaLBkd3.png?imageslim" alt="mark"></p><p>如果传回的有值则，显示传回来值。</p><p>密码也做同样操作</p><h4 id="修改默认的激活状态为false"><a href="#修改默认的激活状态为false" class="headerlink" title="修改默认的激活状态为false"></a>修改默认的激活状态为false</h4><p>post方法中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 默认激活状态为false</span><br><span class="line">user_profile.is_active = False</span><br></pre></td></tr></table></figure><p>书写处理激活的view。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 激活用户的view</span><br><span class="line">class ActiveUserView(View):</span><br><span class="line">    def get(self, request, active_code):</span><br><span class="line">        # 查询邮箱验证记录是否存在</span><br><span class="line">        all_record = EmailVerifyRecord.objects.filter(code = active_code)</span><br><span class="line">        # 激活form负责给激活跳转进来的人加验证码</span><br><span class="line">        active_form = ActiveForm(request.GET)</span><br><span class="line">        # 如果不为空也就是有用户</span><br><span class="line">        if all_record:</span><br><span class="line">            for record in all_record:</span><br><span class="line">                # 获取到对应的邮箱</span><br><span class="line">                email = record.email</span><br><span class="line">                # 查找到邮箱对应的user</span><br><span class="line">                user = UserProfile.objects.get(email=email)</span><br><span class="line">                user.is_active = True</span><br><span class="line">                user.save()</span><br><span class="line">                # 激活成功跳转到登录页面</span><br><span class="line">                return render(request, &quot;login.html&quot;, )</span><br><span class="line">        # 自己瞎输的验证码</span><br><span class="line">        else:</span><br><span class="line">            return render(request, &quot;register.html&quot;, &#123;&quot;msg&quot;: &quot;您的激活链接无效&quot;,&quot;active_form&quot;: active_form&#125;)</span><br></pre></td></tr></table></figure><p>配置用户激活的url并通过url提取到变量:</p><p>django1.9.8:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 激活用户url</span><br><span class="line">url(r&apos;^active/(?P&lt;active_code&gt;.*)/$&apos;,ActiveUserView.as_view(), name= &quot;user_active&quot;)</span><br></pre></td></tr></table></figure><p>django2.0.1：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 激活用户url</span><br><span class="line">re_path(&apos;active/(?P&lt;active_code&gt;.*)/&apos;, ActiveUserView.as_view(), name= &quot;user_active&quot;)</span><br></pre></td></tr></table></figure><p>这里通过<code>?p</code>将后面<code>.*</code>代表全部提取的正则，符合的内容传入参数active_code中<code>/$</code>代表以<code>/$</code>为结尾</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/i7DdIaB5bd.png?imageslim" alt="mark"></p><blockquote><p>其他细节根据自己需要进行优化。</p></blockquote><p>注册功能制作完毕。对应commit:</p><blockquote><p>注册功能实现完毕，流程:注册，发邮件，激活，登录。对应6-6,7,8,9,10</p></blockquote><h2 id="6-8-找回密码"><a href="#6-8-找回密码" class="headerlink" title="6-8 找回密码"></a>6-8 找回密码</h2><blockquote><p>这个6-8对应对应6-11,6-12</p></blockquote><h3 id="拷入forgetpassword页面"><a href="#拷入forgetpassword页面" class="headerlink" title="拷入forgetpassword页面"></a>拷入forgetpassword页面</h3><h3 id="书写处理忘记密码的view"><a href="#书写处理忘记密码的view" class="headerlink" title="书写处理忘记密码的view"></a>书写处理忘记密码的view</h3><p>users/views.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户忘记密码的处理view</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForgetPwdView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="comment"># get方法直接返回页面</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">"forgetpwd.html"</span>, &#123; &#125;)</span><br></pre></td></tr></table></figure><p>django2.0.1 urls中配置:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 忘记密码</span><br><span class="line">path(&apos;forget/&apos;, ForgetPwdView.as_view(), name= &quot;forget_pwd&quot;),</span><br></pre></td></tr></table></figure><p>Django1.9.8 urls中配置:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 忘记密码</span><br><span class="line">url(&apos;forget/$&apos;, ForgetPwdView.as_view(), name=&quot;forget_pwd&quot;),</span><br></pre></td></tr></table></figure><h4 id="login-html中忘记密码"><a href="#login-html中忘记密码" class="headerlink" title="login html中忘记密码"></a>login html中忘记密码</h4><p><img src="http://myphoto.mtianyan.cn/blog/180111/cgk66mgd35.png?imageslim" alt="mark"></p><h4 id="配置忘记密码页面中静态文件。"><a href="#配置忘记密码页面中静态文件。" class="headerlink" title="配置忘记密码页面中静态文件。"></a>配置忘记密码页面中静态文件。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">load static</span><br><span class="line">修改static的目录</span><br><span class="line">修改其中的url</span><br></pre></td></tr></table></figure><h4 id="定义一个给forget的form"><a href="#定义一个给forget的form" class="headerlink" title="定义一个给forget的form"></a>定义一个给forget的form</h4><p>users/forms.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注册验证码实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForgetForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    <span class="comment"># 此处email与前端name需保持一致。</span></span><br><span class="line">    email = forms.EmailField(required=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># 应用验证码 自定义错误输出key必须与异常一样</span></span><br><span class="line">    captcha = CaptchaField(error_messages=&#123;<span class="string">"invalid"</span>: <span class="string">u"验证码错误"</span>&#125;)</span><br></pre></td></tr></table></figure><h4 id="添加验证码"><a href="#添加验证码" class="headerlink" title="添加验证码"></a>添加验证码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 用户忘记密码的处理view</span><br><span class="line">class ForgetPwdView(View):</span><br><span class="line">    # get方法直接返回页面</span><br><span class="line">    def get(self, request):</span><br><span class="line">        forget_from = ForgetForm()</span><br><span class="line">        return render(request, &quot;forgetpwd.html&quot;, &#123;&quot;forget_from&quot;:forget_from &#125;)</span><br></pre></td></tr></table></figure><h4 id="html中加上验证码"><a href="#html中加上验证码" class="headerlink" title="html中加上验证码"></a>html中加上验证码</h4><p><img src="http://myphoto.mtianyan.cn/blog/180111/Cf24GA16g0.png?imageslim" alt="mark"></p><h4 id="post中逻辑"><a href="#post中逻辑" class="headerlink" title="post中逻辑"></a>post中逻辑</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># post方法实现</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">    forget_form = ForgetForm(request.POST)</span><br><span class="line">    <span class="comment"># form验证合法情况下取出email</span></span><br><span class="line">    <span class="keyword">if</span> forget_form.is_valid():</span><br><span class="line">        email = request.POST.get(<span class="string">"email"</span>,<span class="string">""</span>)</span><br><span class="line">        <span class="comment"># 发送找回密码邮件</span></span><br><span class="line">        send_register_eamil(email, <span class="string">"forget"</span>)</span><br><span class="line">        <span class="comment"># 发送完毕返回登录页面并显示发送邮件成功。</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">"login.html"</span>, &#123;<span class="string">"msg"</span>:<span class="string">"重置密码邮件已发送,请注意查收"</span>&#125;)</span><br><span class="line">    <span class="comment"># 如果表单验证失败也就是他验证码输错等。</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">"forgetpwd.html"</span>, &#123;<span class="string">"forget_from"</span>: forget_form &#125;)</span><br></pre></td></tr></table></figure><h4 id="邮箱重置密码邮件发送"><a href="#邮箱重置密码邮件发送" class="headerlink" title="邮箱重置密码邮件发送"></a>邮箱重置密码邮件发送</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">elif send_type == &quot;forget&quot;:</span><br><span class="line">       email_title = &quot;mtianyan慕课小站 找回密码链接&quot;</span><br><span class="line">       email_body = loader.render_to_string(</span><br><span class="line">           &quot;email_forget.html&quot;,  # 需要渲染的html模板</span><br><span class="line">           &#123;</span><br><span class="line">               &quot;active_code&quot;: code  # 参数</span><br><span class="line">           &#125;</span><br><span class="line">       )</span><br><span class="line">       msg = EmailMessage(email_title, email_body, EMAIL_FROM, [email])</span><br><span class="line">       msg.content_subtype = &quot;html&quot;</span><br><span class="line">       send_status = msg.send()</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180111/4e60888a7F.png?imageslim" alt="mark"></p><h4 id="前端页面添加错误信息"><a href="#前端页面添加错误信息" class="headerlink" title="前端页面添加错误信息"></a>前端页面添加错误信息</h4><p>已经重复很多遍这个操作了。</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/fl8Dhg5B2H.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180111/KEmkdk9c3b.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180111/FI5fafG9a8.png?imageslim" alt="mark"></p><blockquote><p>上述三图进行改正，不一一列举</p></blockquote><h4 id="书写重置密码view"><a href="#书写重置密码view" class="headerlink" title="书写重置密码view"></a>书写重置密码view</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重置密码的view</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResetView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, active_code)</span>:</span></span><br><span class="line">        <span class="comment"># 查询邮箱验证记录是否存在</span></span><br><span class="line">        all_record = EmailVerifyRecord.objects.filter(code=active_code)</span><br><span class="line">        <span class="comment"># 如果不为空也就是有用户</span></span><br><span class="line">        active_form = ActiveForm(request.GET)</span><br><span class="line">        <span class="keyword">if</span> all_record:</span><br><span class="line">            <span class="keyword">for</span> record <span class="keyword">in</span> all_record:</span><br><span class="line">                <span class="comment"># 获取到对应的邮箱</span></span><br><span class="line">                email = record.email</span><br><span class="line">                <span class="comment"># 将email传回来</span></span><br><span class="line">                <span class="keyword">return</span> render(request, <span class="string">"password_reset.html"</span>, &#123;<span class="string">"email"</span>:email&#125;)</span><br><span class="line">        <span class="comment"># 自己瞎输的验证码</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render(</span><br><span class="line">                request, <span class="string">"forgetpwd.html"</span>, &#123;</span><br><span class="line">                    <span class="string">"msg"</span>: <span class="string">"您的重置密码链接无效,请重新请求"</span>, <span class="string">"active_form"</span>: active_form&#125;)</span><br></pre></td></tr></table></figure><h4 id="配置重置密码url"><a href="#配置重置密码url" class="headerlink" title="配置重置密码url"></a>配置重置密码url</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Django1.9.8:</span></span><br><span class="line">    <span class="comment"># 重置密码urlc ：用来接收来自邮箱的重置链接</span></span><br><span class="line">    url(<span class="string">'reset/(?P&lt;active_code&gt;.*)/$'</span>, ResetView.as_view(), name=<span class="string">"reset_pwd"</span>),</span><br><span class="line"><span class="comment"># django2.0.1:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 重置密码urlc ：用来接收来自邮箱的重置链接</span></span><br><span class="line">    re_path(<span class="string">'reset/(?P&lt;active_code&gt;.*)/'</span>, ResetView.as_view(), name=<span class="string">"reset_pwd"</span>),</span><br></pre></td></tr></table></figure><h4 id="拷贝进来password-reset页面"><a href="#拷贝进来password-reset页面" class="headerlink" title="拷贝进来password reset页面"></a>拷贝进来password reset页面</h4><p><img src="http://myphoto.mtianyan.cn/blog/180111/LFKlj0CLAb.png?imageslim" alt="mark"></p><blockquote><p>添加一个隐藏的input框，以便于我们知道到底是哪个用户在重置密码</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180111/BfaLgiG5k3.png?imageslim" alt="mark"></p><p>配置html中三大变化加url配置。</p><p><img src="http://myphoto.mtianyan.cn/blog/180111/AiiGBEkJLj.png?imageslim" alt="mark"></p><p><code>reset</code>的<code>url</code>需要我们传参进来,但是<code>modify</code>的不需要。<br>所以url配置和view都得分开。</p><h4 id="创建改变密码的forms"><a href="#创建改变密码的forms" class="headerlink" title="创建改变密码的forms:"></a>创建改变密码的forms:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重置密码form实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModifyPwdForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    <span class="comment"># 密码不能小于5位</span></span><br><span class="line">    password1 = forms.CharField(required=<span class="keyword">True</span>, min_length=<span class="number">5</span>)</span><br><span class="line">    <span class="comment"># 密码不能小于5位</span></span><br><span class="line">    password2 = forms.CharField(required=<span class="keyword">True</span>, min_length=<span class="number">5</span>)</span><br></pre></td></tr></table></figure><h4 id="书写改变密码的view；"><a href="#书写改变密码的view；" class="headerlink" title="书写改变密码的view；"></a>书写改变密码的view；</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 改变密码的view</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModifyPwdView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        modiypwd_form = ModifyPwdForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> modiypwd_form.is_valid():</span><br><span class="line">            pwd1 = request.POST.get(<span class="string">"password1"</span>, <span class="string">""</span>)</span><br><span class="line">            pwd2 = request.POST.get(<span class="string">"password2"</span>, <span class="string">""</span>)</span><br><span class="line">            email = request.POST.get(<span class="string">"email"</span>, <span class="string">""</span>)</span><br><span class="line">            <span class="comment"># 如果两次密码不相等，返回错误信息</span></span><br><span class="line">            <span class="keyword">if</span> pwd1 != pwd2:</span><br><span class="line">                <span class="keyword">return</span> render(request, <span class="string">"password_reset.html"</span>, &#123;<span class="string">"email"</span>: email, <span class="string">"msg"</span>: <span class="string">"密码不一致"</span>&#125;)</span><br><span class="line">            <span class="comment"># 如果密码一致</span></span><br><span class="line">            user = UserProfile.objects.get(email=email)</span><br><span class="line">            <span class="comment"># 加密成密文</span></span><br><span class="line">            user.password = make_password(pwd2)</span><br><span class="line">            <span class="comment"># save保存到数据库</span></span><br><span class="line">            user.save()</span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">"login.html"</span>, &#123;<span class="string">"msg"</span>: <span class="string">"密码修改成功，请登录"</span>&#125;)</span><br><span class="line">        <span class="comment"># 验证失败说明密码位数不够。</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            email = request.POST.get(<span class="string">"email"</span>, <span class="string">""</span>)</span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">"password_reset.html"</span>, &#123;<span class="string">"email"</span>: email, <span class="string">"modiypwd_form"</span>:modiypwd_form&#125;)</span><br></pre></td></tr></table></figure><h4 id="配置modify的url。"><a href="#配置modify的url。" class="headerlink" title="配置modify的url。"></a>配置modify的url。</h4><p>django2.0.1:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改密码url; 用于passwordreset页面提交表单</span></span><br><span class="line">path(<span class="string">'modify_pwd/'</span>, ModifyPwdView.as_view(), name=<span class="string">"modify_pwd"</span>),</span><br></pre></td></tr></table></figure><p>django1.9.8:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改密码url; 用于passwordreset页面提交表单</span></span><br><span class="line">url(<span class="string">r'^modify_pwd/$'</span>, ModifyPwdView.as_view(), name=<span class="string">"modify_pwd"</span>),</span><br></pre></td></tr></table></figure><p>建议自行走一遍注册，登录，忘记密码。重置密码。<br>错误的激活链接，错误的重置链接。值回填，form报错</p><p>更多: 重置密码链接是否被点击过，过期时间。</p><blockquote><p>对应commit忘记密码重置功能实现完毕，并进行了必要的测试。对应6-11,6-12</p></blockquote></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/post/c970abcd.html">强力Django+杀手级Xadmin打造在线教育平台(六)</a></p><p><span>文章作者:</span><a href="/" title="访问 mtianyan 的个人博客">mtianyan</a></p><p><span>发布时间:</span>2018年01月11日 - 22:01</p><p><span>最后更新:</span>2018年02月02日 - 20:02</p><p><span>原始链接:</span><a href="/post/c970abcd.html" title="强力Django+杀手级Xadmin打造在线教育平台(六)">http://blog.mtianyan.cn/post/c970abcd.html</a><span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://blog.mtianyan.cn/post/c970abcd.html" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>请博主吃包辣条</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/images/wechatpay.png" alt="mtianyan 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/images/alipay.jpg" alt="mtianyan 支付宝"><p>支付宝</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a><a href="/tags/Django/" rel="tag"><i class="fa fa-tag"></i> Django</a><a href="/tags/在线教育平台/" rel="tag"><i class="fa fa-tag"></i> 在线教育平台</a></div><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/post/507fe3bf.html" rel="next" title="强力Django+杀手级Xadmin打造在线教育平台(五)"><i class="fa fa-chevron-left"></i> 强力Django+杀手级Xadmin打造在线教育平台(五)</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/post/5678b347.html" rel="prev" title="强力Django+杀手级Xadmin打造在线教育平台(七)">强力Django+杀手级Xadmin打造在线教育平台(七)<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"> <span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=2154292" charset="utf-8"></script></div></div></div><div class="comments" id="comments"><div id="SOHUCS"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="mtianyan"><p class="site-author-name" itemprop="name">mtianyan</p><p class="site-description motion-element" itemprop="description">爱分享，爱技术，爱生活。</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">37</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">23</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/mtianyan" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://www.jianshu.com/u/db9a7a0daa1f" target="_blank" title="简书"><i class="fa fa-fw fa-book"></i> 简书</a></span><span class="links-of-author-item"><a href="https://plus.google.com/u/0/114963812195952881148" target="_blank" title="Google"><i class="fa fa-fw fa-google"></i> Google</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://mtianyan.gitee.io/" title="本站孪生站(国内码云托管)" target="_blank">本站孪生站(国内码云托管)</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-首页和登录页面的配置"><span class="nav-number">1.</span> <span class="nav-text">6-1 首页和登录页面的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#新建static目录"><span class="nav-number">1.1.</span> <span class="nav-text">新建static目录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#配置处理静态文件的url。"><span class="nav-number">1.1.1.</span> <span class="nav-text">配置处理静态文件的url。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置static文件"><span class="nav-number">1.2.</span> <span class="nav-text">设置static文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改index页面中前端样式的引用地址"><span class="nav-number">1.3.</span> <span class="nav-text">修改index页面中前端样式的引用地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#拷贝登录页面到template"><span class="nav-number">1.4.</span> <span class="nav-text">拷贝登录页面到template</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#url配置跳转登录页面"><span class="nav-number">1.4.1.</span> <span class="nav-text">url配置跳转登录页面</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-用户登录-1"><span class="nav-number">2.</span> <span class="nav-text">6-2 用户登录-1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-用户登录2"><span class="nav-number">3.</span> <span class="nav-text">6-3 用户登录2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#html-form基础知识"><span class="nav-number">3.1.</span> <span class="nav-text">html form基础知识</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#改造为使用邮箱用户名均可。Setting中重载变量"><span class="nav-number">3.2.</span> <span class="nav-text">改造为使用邮箱用户名均可。Setting中重载变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用户提示：return页面时提供它的错误信息"><span class="nav-number">3.3.</span> <span class="nav-text">用户提示：return页面时提供它的错误信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-4-用form实现登录-1"><span class="nav-number">4.</span> <span class="nav-text">6-4 用form实现登录-1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-5-form字段验证"><span class="nav-number">5.</span> <span class="nav-text">6-5 form字段验证</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#完善错误提示"><span class="nav-number">5.1.</span> <span class="nav-text">完善错误提示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将forms错误信息显示出来"><span class="nav-number">5.2.</span> <span class="nav-text">将forms错误信息显示出来</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-6-session和cookie自动登录机制"><span class="nav-number">6.</span> <span class="nav-text">6-6 session和cookie自动登录机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cookie的存储"><span class="nav-number">6.1.</span> <span class="nav-text">cookie的存储</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#http请求是一种无状态的请求"><span class="nav-number">6.2.</span> <span class="nav-text">http请求是一种无状态的请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#有状态请求-cookie"><span class="nav-number">6.3.</span> <span class="nav-text">有状态请求(cookie)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解决cookie放在本地不安全的问题-session"><span class="nav-number">6.4.</span> <span class="nav-text">解决cookie放在本地不安全的问题(session)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-7-用户注册"><span class="nav-number">7.</span> <span class="nav-text">6-7 用户注册</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#拷贝注册页面进入template目录"><span class="nav-number">7.1.</span> <span class="nav-text">拷贝注册页面进入template目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#书写我们对应要处理的view-RegisterView"><span class="nav-number">7.2.</span> <span class="nav-text">书写我们对应要处理的view(RegisterView)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置对应的url"><span class="nav-number">7.3.</span> <span class="nav-text">配置对应的url</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改index页面中注册url"><span class="nav-number">7.4.</span> <span class="nav-text">修改index页面中注册url</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改静态文件中static目录引用"><span class="nav-number">7.5.</span> <span class="nav-text">修改静态文件中static目录引用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#关键步骤load-staticfile"><span class="nav-number">7.5.1.</span> <span class="nav-text">关键步骤load staticfile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#然后修改路径为一个相对于static的相对路径"><span class="nav-number">7.5.2.</span> <span class="nav-text">然后修改路径为一个相对于static的相对路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#将目前的三个html中的静态文件全部修改目录"><span class="nav-number">7.5.3.</span> <span class="nav-text">将目前的三个html中的静态文件全部修改目录</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证码库实现验证码"><span class="nav-number">7.6.</span> <span class="nav-text">验证码库实现验证码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装配置"><span class="nav-number">7.6.1.</span> <span class="nav-text">安装配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将验证码展示到页面"><span class="nav-number">7.7.</span> <span class="nav-text">将验证码展示到页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#定义我们的register-form"><span class="nav-number">7.7.1.</span> <span class="nav-text">定义我们的register form:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在我们的registerform中实例化并传送到前端"><span class="nav-number">7.7.2.</span> <span class="nav-text">在我们的registerform中实例化并传送到前端:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#前端获取验证码值"><span class="nav-number">7.7.3.</span> <span class="nav-text">前端获取验证码值</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编写register-view的后台逻辑-RegisterView"><span class="nav-number">7.8.</span> <span class="nav-text">编写register view的后台逻辑(RegisterView)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#获取前端页面值并封装成一个user-profile对象，保存到数据库。"><span class="nav-number">7.8.1.</span> <span class="nav-text">获取前端页面值并封装成一个user_profile对象，保存到数据库。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#发送邮件实现"><span class="nav-number">7.8.2.</span> <span class="nav-text">发送邮件实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#完善错误提示。"><span class="nav-number">7.8.3.</span> <span class="nav-text">完善错误提示。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#完善用户值回填逻辑"><span class="nav-number">7.8.4.</span> <span class="nav-text">完善用户值回填逻辑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#修改默认的激活状态为false"><span class="nav-number">7.8.5.</span> <span class="nav-text">修改默认的激活状态为false</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-8-找回密码"><span class="nav-number">8.</span> <span class="nav-text">6-8 找回密码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#拷入forgetpassword页面"><span class="nav-number">8.1.</span> <span class="nav-text">拷入forgetpassword页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#书写处理忘记密码的view"><span class="nav-number">8.2.</span> <span class="nav-text">书写处理忘记密码的view</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#login-html中忘记密码"><span class="nav-number">8.2.1.</span> <span class="nav-text">login html中忘记密码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置忘记密码页面中静态文件。"><span class="nav-number">8.2.2.</span> <span class="nav-text">配置忘记密码页面中静态文件。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#定义一个给forget的form"><span class="nav-number">8.2.3.</span> <span class="nav-text">定义一个给forget的form</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加验证码"><span class="nav-number">8.2.4.</span> <span class="nav-text">添加验证码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#html中加上验证码"><span class="nav-number">8.2.5.</span> <span class="nav-text">html中加上验证码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#post中逻辑"><span class="nav-number">8.2.6.</span> <span class="nav-text">post中逻辑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#邮箱重置密码邮件发送"><span class="nav-number">8.2.7.</span> <span class="nav-text">邮箱重置密码邮件发送</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#前端页面添加错误信息"><span class="nav-number">8.2.8.</span> <span class="nav-text">前端页面添加错误信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#书写重置密码view"><span class="nav-number">8.2.9.</span> <span class="nav-text">书写重置密码view</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置重置密码url"><span class="nav-number">8.2.10.</span> <span class="nav-text">配置重置密码url</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#拷贝进来password-reset页面"><span class="nav-number">8.2.11.</span> <span class="nav-text">拷贝进来password reset页面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建改变密码的forms"><span class="nav-number">8.2.12.</span> <span class="nav-text">创建改变密码的forms:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#书写改变密码的view；"><span class="nav-number">8.2.13.</span> <span class="nav-text">书写改变密码的view；</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置modify的url。"><span class="nav-number">8.2.14.</span> <span class="nav-text">配置modify的url。</span></a></li></ol></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">mtianyan</span><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共182.8k字</span></div></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script> <span class="site-uv">本站访客数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人次</span> <span class="site-pv">本站总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script><script type="text/javascript">!function(){var t="1eb79150519fd9b791c77e8eef6f3632";if((window.innerWidth||document.documentElement.clientWidth)<960)window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=cyrJmJ3rL&conf='+t+'"><\/script>');else{!function(t,e){var n=document.getElementsByTagName("head")[0]||document.head||document.documentElement,a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("charset","UTF-8"),a.setAttribute("src",t),"function"==typeof e&&(window.attachEvent?a.onreadystatechange=function(){var t=a.readyState;"loaded"!==t&&"complete"!==t||(a.onreadystatechange=null,e())}:a.onload=e),n.appendChild(a)}("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:"cyrJmJ3rL",conf:t})})}}()</script><script type="text/javascript" src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script><script type="text/javascript">var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")};function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){var r=!1,s=0,a=0,i=n.title.trim(),c=i.toLowerCase(),l=n.content.trim().replace(/<[^>]+>/g,""),h=l.toLowerCase(),p=decodeURIComponent(n.url),u=[],f=[];if(""!=i&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}u=u.concat(e(t,c,!1)),f=f.concat(e(t,h,!1))}),(u.length>0||f.length>0)&&(r=!0,s=u.length+f.length)),r){[u,f].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});function d(e,o,n,r){for(var s=r[r.length-1],i=s.position,c=s.word,l=[],h=0;i+c.length<=n&&0!=r.length;){c===t&&h++,l.push({position:i,length:c.length});var p=i+c.length;for(r.pop();0!=r.length&&(i=(s=r[r.length-1]).position,c=s.word,p>i);)r.pop()}return a+=h,{hits:l,start:o,end:n,searchTextCount:h}}var g=[];0!=u.length&&g.push(d(0,0,i.length,u));for(var v=[];0!=f.length;){var $=f[f.length-1],C=$.position,m=$.word,x=C-20,w=C+80;x<0&&(x=0),w<C+m.length&&(w=C+m.length),w>l.length&&(w=l.length),v.push(d(0,x,w,f))}v.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var y=parseInt("1");y>=0&&(v=v.slice(0,y));function T(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var b="";0!=g.length?b+="<li><a href='"+p+"' class='search-result-title'>"+T(i,g[0])+"</a>":b+="<li><a href='"+p+"' class='search-result-title'>"+i+"</a>",v.forEach(function(t){b+="<a href='"+p+'\'><p class="search-result">'+T(l,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:a,hitCount:s,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("2uqmIjYredIvFy6tEXbKG4Fj-gzGzoHsz","CWl1rE8cQlIseOg2Cq3hzxYi")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0!==e.length){for(var i=0;i<e.length;i++){var s=e[i],r=s.get("url"),l=s.get("time"),c=document.getElementById(r);$(c).find(t).text(l)}for(i=0;i<n.length;i++){r=n[i],c=document.getElementById(r);var u=$(c).find(t);""==u.text()&&u.text(0)}}else o.find(t).text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var s=new e,r=new AV.ACL;r.setPublicReadAccess(!0),r.setPublicWriteAccess(!0),s.setACL(r),s.set("title",o),s.set("url",n),s.set("time",1),s.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={},pbOptions.iconStyle="default",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={},flOptions.iconStyle="default",flOptions.boxForm="horizontal",flOptions.position="middleRight",flOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-float",flOptions)</script><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script><script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><div id="hexo-helper-live2d"><canvas id="live2dcanvas" width="150" height="300"></canvas></div><style>#live2dcanvas{position:fixed;width:150px;height:300px;opacity:.7;right:-30px;z-index:999;pointer-events:none;bottom:40px}</style><script type="text/javascript" src="/live2d/device.min.js"></script><script type="text/javascript">
const loadScript = function loadScript(c,b){var a=document.createElement("script");a.type="text/javascript";"undefined"!=typeof b&&(a.readyState?a.onreadystatechange=function(){if("loaded"==a.readyState||"complete"==a.readyState)a.onreadystatechange=null,b()}:a.onload=function(){b()});a.src=c;document.body.appendChild(a)};
(function(){
  if((typeof(device) != 'undefined') && (device.mobile())){
    var trElement = document.getElementById('hexo-helper-live2d');
    trElement.parentNode.removeChild(trElement);
    return;
  }else
    if (typeof(device) === 'undefined') console.error('Cannot find current-device script.');
  loadScript("/live2d/script.js", function(){loadlive2d("live2dcanvas", "/live2d/assets/hijiki.model.json", 0.5);});
})();
</script></body></html><script type="text/javascript" src="/js/src/love.js"></script>